<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Dj-Stripe Team" /><link rel="canonical" href="https://dj-stripe.github.io/dj-stripe/2.7/reference/models/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Models - Dj-Stripe</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Models";
        var mkdocs_page_input_path = "reference/models.md";
        var mkdocs_page_url = "/dj-stripe/2.7/reference/models/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Dj-Stripe
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../project/sponsors/">Sponsors</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api_keys/">Managing Stripe API Keys</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api_versions/">A note on Stripe API Versions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../stripe_elements_js/">Integrating Stripe Elements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Release notes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_7_0/">dj-stripe 2.7 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_6_0/">dj-stripe 2.6 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_5_0/">dj-stripe 2.5 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_4_x/">dj-stripe 2.4.1 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_4_0/">dj-stripe 2.4 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_x/">dj-stripe 2.0 ~ 2.3 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/1_x/">dj-stripe 1.x release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/0_x/">dj-stripe 0.x release notes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/webhooks/">Using Stripe Webhooks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/subscribing_customers/">Subscribing a customer to a plan</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/managing_subscriptions/">Managing subscriptions and payment sources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/manually_syncing_with_stripe/">Manually syncing data with Stripe</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/creating_individual_charges/">Creating individual charges</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/creating_usage_record/">Creating Usage Records</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/using_stripe_checkout/">Using Stripe Checkout</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/using_with_docker/">Using with Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/local_webhook_testing/">Development with local webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/contributing/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/test_fixtures/">Test Fixtures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/authors/">Credits</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/support/">Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/release_process/">Release Process</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../context_managers/">Context Managers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../enums/">Enumerations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../managers/">Managers</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Models</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#core-resources">Core Resources</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.core">djstripe.models.core</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.core-attributes">Attributes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.FileUpload">FileUpload</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.core-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.BalanceTransaction">BalanceTransaction</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.BalanceTransaction-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.BalanceTransaction-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Charge">Charge</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Charge-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Charge-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Customer">Customer</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Customer-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Customer-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Customer-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Dispute">Dispute</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Dispute-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Dispute-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Event">Event</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Event-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Event-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.File">File</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.File-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.File-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.FileLink">FileLink</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.FileLink-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.FileLink-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Mandate">Mandate</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Mandate-attributes">Attributes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.PaymentIntent">PaymentIntent</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.PaymentIntent-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.PaymentIntent-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Payout">Payout</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Payout-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Payout-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Price">Price</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Price-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Price-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Price-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Product">Product</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Product-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Product-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.Refund">Refund</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Refund-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.Refund-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.core.SetupIntent">SetupIntent</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.SetupIntent-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.core.SetupIntent-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.core-functions">Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#payment-methods">Payment Methods</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.payment_methods">djstripe.models.payment_methods</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.payment_methods-attributes">Attributes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.payment_methods-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.payment_methods.BankAccount">BankAccount</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.BankAccount-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.BankAccount-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.payment_methods.Card">Card</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.Card-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.Card-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.payment_methods.PaymentMethod">PaymentMethod</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.PaymentMethod-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.PaymentMethod-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.payment_methods.Source">Source</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.Source-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.payment_methods.Source-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.payment_methods-functions">Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#billing">Billing</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.billing">djstripe.models.billing</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.billing-attributes">Attributes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.billing-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.Coupon">Coupon</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Coupon-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Coupon-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Coupon-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.Invoice">Invoice</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Invoice-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Invoice-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.InvoiceItem">InvoiceItem</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.InvoiceItem-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.InvoiceItem-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.Plan">Plan</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Plan-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Plan-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Plan-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.ShippingRate">ShippingRate</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.ShippingRate-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.ShippingRate-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.ShippingRate-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.Subscription">Subscription</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Subscription-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.Subscription-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.SubscriptionItem">SubscriptionItem</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.SubscriptionItem-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.SubscriptionItem-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.SubscriptionSchedule">SubscriptionSchedule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.SubscriptionSchedule-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.SubscriptionSchedule-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.TaxCode">TaxCode</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxCode-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxCode-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxCode-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.TaxId">TaxId</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxId-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxId-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxId-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.TaxRate">TaxRate</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxRate-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxRate-classes">Classes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.TaxRate-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.UpcomingInvoice">UpcomingInvoice</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.UpcomingInvoice-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.UpcomingInvoice-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.UsageRecord">UsageRecord</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.UsageRecord-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.UsageRecord-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.billing.UsageRecordSummary">UsageRecordSummary</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.UsageRecordSummary-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.billing.UsageRecordSummary-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.billing-functions">Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#connect">Connect</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.account">djstripe.models.account</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.account-attributes">Attributes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.account-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.account.Account">Account</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.account.Account-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.account.Account-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.account-functions">Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.connect">djstripe.models.connect</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.connect-attributes">Attributes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.connect-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.connect.ApplicationFee">ApplicationFee</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.ApplicationFee-attributes">Attributes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.connect.ApplicationFeeRefund">ApplicationFeeRefund</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.ApplicationFeeRefund-attributes">Attributes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.connect.CountrySpec">CountrySpec</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.CountrySpec-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.CountrySpec-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.connect.Transfer">Transfer</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.Transfer-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.Transfer-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.connect.TransferReversal">TransferReversal</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.TransferReversal-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.connect.TransferReversal-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.connect-functions">Functions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fraud">Fraud</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.fraud">djstripe.models.fraud</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#orders">Orders</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.orders">djstripe.models.orders</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.orders-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.orders.Order">Order</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.orders.Order-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.orders.Order-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sigma">Sigma</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.sigma">djstripe.models.sigma</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.sigma-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.sigma.ScheduledQueryRun">ScheduledQueryRun</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.sigma.ScheduledQueryRun-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.sigma.ScheduledQueryRun-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#webhooks">Webhooks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.webhooks">djstripe.models.webhooks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.webhooks-attributes">Attributes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.webhooks-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.webhooks.WebhookEndpoint">WebhookEndpoint</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.webhooks.WebhookEndpoint-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.webhooks.WebhookEndpoint-functions">Functions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.webhooks.WebhookEventTrigger">WebhookEventTrigger</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.webhooks.WebhookEventTrigger-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.models.webhooks.WebhookEventTrigger-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.models.webhooks-functions">Functions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.models.webhooks.get_remote_ip">get_remote_ip()</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utils/">Utilities</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Dj-Stripe</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Reference &raquo;</li>
      <li>Models</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/dj-stripe/dj-stripe/edit/master/docs/reference/models.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="models">Models</h1>
<p>Models hold the bulk of the functionality included in the dj-stripe
package. Each model is tied closely to its corresponding object in the
stripe dashboard. Fields that are not implemented for each model have a
short reason behind the decision in the docstring for each model.</p>
<h2 id="core-resources">Core Resources</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.models.core"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h2 id="djstripe.models.core-attributes">Attributes</h2>

<div class="doc doc-object doc-attribute">



<h3 id="djstripe.models.core.FileUpload" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FileUpload</span> <span class="o">=</span> <span class="n">File</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  </div>

</div>
<h2 id="djstripe.models.core-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.BalanceTransaction" class="doc doc-heading">
        <code>djstripe.models.core.BalanceTransaction</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A single transaction that updates the Stripe balance.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#balance_transaction_object</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BalanceTransaction</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single transaction that updates the Stripe balance.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#balance_transaction_object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">BalanceTransaction</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Gross amount of the transaction, in cents.&quot;</span>
    <span class="p">)</span>
    <span class="n">available_on</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The date the transaction&#39;s net funds &quot;</span>
            <span class="s2">&quot;will become available in the Stripe balance.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">exchange_rate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">fee</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Fee (in cents) paid for this transaction.&quot;</span>
    <span class="p">)</span>
    <span class="n">fee_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Net amount of the transaction, in cents.&quot;</span>
    <span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">()</span>
    <span class="n">reporting_category</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionReportingCategory</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;More information: https://stripe.com/docs/reports/reporting-categories&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionStatus</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionType</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">get_source_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;djstripe&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">get_source_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source_instance</span><span class="p">()</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.BalanceTransaction-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Gross amount of the transaction, in cents.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.available_on" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">available_on</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The date the transaction&#39;s net funds will become available in the Stripe balance.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.exchange_rate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">exchange_rate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.fee" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">fee</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Fee (in cents) paid for this transaction.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.fee_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">fee_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.net" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Net amount of the transaction, in cents.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.reporting_category" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">reporting_category</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionReportingCategory</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;More information: https://stripe.com/docs/reports/reporting-categories&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionStatus</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">BalanceTransaction</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.BalanceTransaction.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionType</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.BalanceTransaction-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.BalanceTransaction.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">BalanceTransactionStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.BalanceTransaction.get_source_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">get_source_class</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_source_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;djstripe&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.BalanceTransaction.get_source_instance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">get_source_instance</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_source_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source_class</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.BalanceTransaction.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source_instance</span><span class="p">()</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Charge" class="doc doc-heading">
        <code>djstripe.models.core.Charge</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>To charge a credit or a debit card, you create a charge object. You can
retrieve and refund individual charges as well as list all charges. Charges
are identified by a unique random ID.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#charges</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Charge</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To charge a credit or a debit card, you create a charge object. You can</span>
<span class="sd">    retrieve and refund individual charges as well as list all charges. Charges</span>
<span class="sd">    are identified by a unique random ID.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#charges</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Charge</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;balance_transaction&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;payments&quot;</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount charged (as decimal).&quot;</span><span class="p">)</span>
    <span class="n">amount_captured</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Amount (as decimal) captured (can be less than the amount attribute &quot;</span>
            <span class="s2">&quot;on the charge if a partial capture was issued).&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">amount_refunded</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Amount (as decimal) refunded (can be less than the amount attribute on &quot;</span>
            <span class="s2">&quot;the charge if a partial refund was issued).&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the Connect application that created the charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">application_fee</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;ApplicationFee&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;fee_for_charge&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The application fee (if any) for the charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">application_fee_amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The amount (as decimal) of the application fee (if any) &quot;</span>
        <span class="s2">&quot;requested for the charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The balance transaction that describes the impact of this charge &quot;</span>
            <span class="s2">&quot;on your account balance (not including refunds or disputes).&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">billing_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Billing information associated with the PaymentMethod at the &quot;</span>
        <span class="s2">&quot;time of the transaction.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">calculated_statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The full statement descriptor that is passed to card networks, &quot;</span>
        <span class="s2">&quot;and that is displayed on your customers&#39; credit card and bank statements. &quot;</span>
        <span class="s2">&quot;Allows you to see what the statement descriptor looks like after the &quot;</span>
        <span class="s2">&quot;static and dynamic portions are combined.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the charge was created without capturing, this boolean &quot;</span>
        <span class="s2">&quot;represents whether or not it is still uncaptured or has since been captured.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The currency in which the charge was made.&quot;</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer associated with this charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">dispute</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Dispute&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Details about the dispute if the charge has been disputed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">disputed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether the charge has been disputed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">failure_code</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ApiErrorCode</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Error code explaining reason for charge failure if available.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">failure_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Message to user further explaining reason &quot;</span>
        <span class="s2">&quot;for charge failure if available.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fraud_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Hash with information on fraud assessments for the charge.&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Invoice&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The invoice this charge is for if one exists.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># TODO: order (requires Order model)</span>
    <span class="n">on_behalf_of</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The account (if any) the charge was made on behalf of &quot;</span>
        <span class="s2">&quot;without triggering an automatic transfer.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Details about whether or not the payment was accepted, and why.&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">paid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;True if the charge succeeded, &quot;</span>
        <span class="s2">&quot;or was successfully authorized for later capture, False otherwise.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentIntent&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;PaymentIntent associated with this charge, if one exists.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;PaymentMethod used in this charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_method_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Details about the payment method at the time of the transaction.&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">receipt_email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>  <span class="c1"># yup, 800.</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The email address that the receipt for this charge was sent to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">receipt_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The transaction number that appears &quot;</span>
        <span class="s2">&quot;on email receipts sent for this charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">receipt_url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;This is the URL to view the receipt for this charge. &quot;</span>
        <span class="s2">&quot;The receipt is kept up-to-date to the latest state of the charge, &quot;</span>
        <span class="s2">&quot;including any refunds. If the charge is for an Invoice, &quot;</span>
        <span class="s2">&quot;the receipt will be stylized as an Invoice receipt.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">refunded</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the charge has been fully refunded. &quot;</span>
        <span class="s2">&quot;If the charge is only partially refunded, &quot;</span>
        <span class="s2">&quot;this attribute will still be false.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># TODO: review (requires Review model)</span>
    <span class="n">shipping</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Shipping information for the charge&quot;</span>
    <span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The source used for this charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">source_transfer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Transfer&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The transfer which created this charge. Only present if the &quot;</span>
        <span class="s2">&quot;charge came from another Stripe account.&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;For card charges, use statement_descriptor_suffix instead. &quot;</span>
        <span class="s2">&quot;Otherwise, you can use this value as the complete description of a &quot;</span>
        <span class="s2">&quot;charge on your customers&#39; statements. Must contain at least one letter, &quot;</span>
        <span class="s2">&quot;maximum 22 characters.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">statement_descriptor_suffix</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Provides information about the charge that customers see on &quot;</span>
        <span class="s2">&quot;their statements. Concatenated with the prefix (shortened descriptor) &quot;</span>
        <span class="s2">&quot;or statement descriptor that&#39;s set on the account to form the &quot;</span>
        <span class="s2">&quot;complete statement descriptor. &quot;</span>
        <span class="s2">&quot;Maximum 22 characters for the concatenated descriptor.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ChargeStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of the payment.&quot;</span>
    <span class="p">)</span>
    <span class="n">transfer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Transfer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The transfer to the `destination` account (only applicable if &quot;</span>
            <span class="s2">&quot;the charge was created using the `destination` parameter).&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">transfer_data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;An optional dictionary including the account to automatically &quot;</span>
        <span class="s2">&quot;transfer to as part of a destination charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">transfer_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A string that identifies this transaction as part of a group.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">ChargeManager</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_status</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fee</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="o">.</span><span class="n">fee</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">human_readable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Uncaptured&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">disputed</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Disputed&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">refunded</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Refunded&quot;</span>
        <span class="k">return</span> <span class="n">enums</span><span class="o">.</span><span class="n">ChargeStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fraudulent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fraud_details</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraud_details</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fraudulent&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_refund_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Decimal</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the amount that can be refunded (in cents)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eligible_to_refund</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount_refunded</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">amount_to_refund</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">eligible_to_refund</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="k">if</span> <span class="n">amount</span> <span class="k">else</span> <span class="n">eligible_to_refund</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount_to_refund</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">refund</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Charge&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiate a refund. Returns the charge object.</span>

<span class="sd">        :param amount: A positive decimal amount representing how much of this charge</span>
<span class="sd">            to refund. If amount is not provided, then this will be a full refund.</span>
<span class="sd">            Can only refund up to the unrefunded amount remaining of the charge.</span>
<span class="sd">        :param reason: String indicating the reason for the refund.</span>
<span class="sd">            If set, possible values are ``duplicate``, ``fraudulent``,</span>
<span class="sd">            and ``requested_by_customer``. Specifying ``fraudulent`` as the reason</span>
<span class="sd">            when you believe the charge to be fraudulent will</span>
<span class="sd">            help Stripe improve their fraud detection algorithms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">charge_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span><span class="o">.</span><span class="n">refund</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_refund_amount</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="n">reason</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="n">charge_obj</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Charge&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture the payment of an existing, uncaptured, charge.</span>
<span class="sd">        This is the second half of the two-step payment flow, where first you</span>
<span class="sd">        created a charge with the capture option set to False.</span>

<span class="sd">        See https://stripe.com/docs/api#capture_charge</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">captured_charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="n">captured_charge</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_refunds</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">Refund</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Charge-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount charged (as decimal).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.amount_captured" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">amount_captured</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (as decimal) captured (can be less than the amount attribute on the charge if a partial capture was issued).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.amount_refunded" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">amount_refunded</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (as decimal) refunded (can be less than the amount attribute on the charge if a partial refund was issued).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.application" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the Connect application that created the charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.application_fee" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">application_fee</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;ApplicationFee&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;fee_for_charge&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The application fee (if any) for the charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.application_fee_amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">application_fee_amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The amount (as decimal) of the application fee (if any) requested for the charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The balance transaction that describes the impact of this charge on your account balance (not including refunds or disputes).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.billing_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">billing_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Billing information associated with the PaymentMethod at the time of the transaction.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.calculated_statement_descriptor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">calculated_statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The full statement descriptor that is passed to card networks, and that is displayed on your customers&#39; credit card and bank statements. Allows you to see what the statement descriptor looks like after the static and dynamic portions are combined.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.captured" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">captured</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the charge was created without capturing, this boolean represents whether or not it is still uncaptured or has since been captured.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The currency in which the charge was made.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The customer associated with this charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.dispute" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">dispute</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Dispute&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Details about the dispute if the charge has been disputed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.disputed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">disputed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the charge has been disputed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;balance_transaction&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.failure_code" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">failure_code</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ApiErrorCode</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Error code explaining reason for charge failure if available.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.failure_message" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">failure_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Message to user further explaining reason for charge failure if available.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.fraud_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">fraud_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Hash with information on fraud assessments for the charge.&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Invoice&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The invoice this charge is for if one exists.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.objects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">ChargeManager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.on_behalf_of" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">on_behalf_of</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The account (if any) the charge was made on behalf of without triggering an automatic transfer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.outcome" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">outcome</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Details about whether or not the payment was accepted, and why.&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.paid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">paid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;True if the charge succeeded, or was successfully authorized for later capture, False otherwise.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.payment_intent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">payment_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentIntent&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;PaymentIntent associated with this charge, if one exists.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentMethod&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;PaymentMethod used in this charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.payment_method_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">payment_method_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Details about the payment method at the time of the transaction.&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.receipt_email" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">receipt_email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The email address that the receipt for this charge was sent to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.receipt_number" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">receipt_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The transaction number that appears on email receipts sent for this charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.receipt_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">receipt_url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;This is the URL to view the receipt for this charge. The receipt is kept up-to-date to the latest state of the charge, including any refunds. If the charge is for an Invoice, the receipt will be stylized as an Invoice receipt.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.refunded" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">refunded</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether or not the charge has been fully refunded. If the charge is only partially refunded, this attribute will still be false.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.shipping" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">shipping</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Shipping information for the charge&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;charges&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The source used for this charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.source_transfer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">source_transfer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Transfer&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The transfer which created this charge. Only present if the charge came from another Stripe account.&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.statement_descriptor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;For card charges, use statement_descriptor_suffix instead. Otherwise, you can use this value as the complete description of a charge on your customers&#39; statements. Must contain at least one letter, maximum 22 characters.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.statement_descriptor_suffix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">statement_descriptor_suffix</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Provides information about the charge that customers see on their statements. Concatenated with the prefix (shortened descriptor) or statement descriptor that&#39;s set on the account to form the complete statement descriptor. Maximum 22 characters for the concatenated descriptor.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ChargeStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of the payment.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Charge</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;payments&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.transfer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">transfer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Transfer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The transfer to the `destination` account (only applicable if the charge was created using the `destination` parameter).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.transfer_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">transfer_data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;An optional dictionary including the account to automatically transfer to as part of a destination charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Charge.transfer_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">transfer_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A string that identifies this transaction as part of a group.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.Charge-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Charge.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Charge.capture" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Capture the payment of an existing, uncaptured, charge.
This is the second half of the two-step payment flow, where first you
created a charge with the capture option set to False.</p>
<p>See https://stripe.com/docs/api#capture_charge</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Charge&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Capture the payment of an existing, uncaptured, charge.</span>
<span class="sd">    This is the second half of the two-step payment flow, where first you</span>
<span class="sd">    created a charge with the capture option set to False.</span>

<span class="sd">    See https://stripe.com/docs/api#capture_charge</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">captured_charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
        <span class="n">captured_charge</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Charge.fee" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">fee</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">fee</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="o">.</span><span class="n">fee</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Charge.fraudulent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">fraudulent</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">fraudulent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraud_details</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraud_details</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fraudulent&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Charge.human_readable_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">human_readable_status</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">human_readable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">captured</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Uncaptured&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">disputed</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Disputed&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">refunded</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Refunded&quot;</span>
    <span class="k">return</span> <span class="n">enums</span><span class="o">.</span><span class="n">ChargeStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Charge.refund" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Charge</span><span class="o">.</span><span class="n">refund</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Initiate a refund. Returns the charge object.</p>
<p>:param amount: A positive decimal amount representing how much of this charge
    to refund. If amount is not provided, then this will be a full refund.
    Can only refund up to the unrefunded amount remaining of the charge.
:param reason: String indicating the reason for the refund.
    If set, possible values are <code>duplicate</code>, <code>fraudulent</code>,
    and <code>requested_by_customer</code>. Specifying <code>fraudulent</code> as the reason
    when you believe the charge to be fraudulent will
    help Stripe improve their fraud detection algorithms.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">refund</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Charge&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initiate a refund. Returns the charge object.</span>

<span class="sd">    :param amount: A positive decimal amount representing how much of this charge</span>
<span class="sd">        to refund. If amount is not provided, then this will be a full refund.</span>
<span class="sd">        Can only refund up to the unrefunded amount remaining of the charge.</span>
<span class="sd">    :param reason: String indicating the reason for the refund.</span>
<span class="sd">        If set, possible values are ``duplicate``, ``fraudulent``,</span>
<span class="sd">        and ``requested_by_customer``. Specifying ``fraudulent`` as the reason</span>
<span class="sd">        when you believe the charge to be fraudulent will</span>
<span class="sd">        help Stripe improve their fraud detection algorithms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">charge_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span><span class="o">.</span><span class="n">refund</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_refund_amount</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">),</span> <span class="n">reason</span><span class="o">=</span><span class="n">reason</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
        <span class="n">charge_obj</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Customer" class="doc doc-heading">
        <code>djstripe.models.core.Customer</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Customer objects allow you to perform recurring charges and track multiple
charges that are associated with the same customer.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#customers</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Customer objects allow you to perform recurring charges and track multiple</span>
<span class="sd">    charges that are associated with the same customer.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#customers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;default_source&quot;</span><span class="p">,</span> <span class="s2">&quot;sources&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;customers&quot;</span>

    <span class="n">address</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s address.&quot;</span><span class="p">)</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Current balance (in cents), if any, being stored on the customer&#39;s &quot;</span>
            <span class="s2">&quot;account. &quot;</span>
            <span class="s2">&quot;If negative, the customer has credit to apply to the next invoice. &quot;</span>
            <span class="s2">&quot;If positive, the customer has an amount owed that will be added to the &quot;</span>
            <span class="s2">&quot;next invoice. The balance does not refer to any unpaid invoices; it &quot;</span>
            <span class="s2">&quot;solely takes into account amounts that have yet to be successfully &quot;</span>
            <span class="s2">&quot;applied to any invoice. This balance is only taken into account for &quot;</span>
            <span class="s2">&quot;recurring billing purposes (i.e., subscriptions, invoices, invoice items).&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The currency the customer can be charged in for &quot;</span>
        <span class="s2">&quot;recurring billing purposes&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;customers&quot;</span>
    <span class="p">)</span>
    <span class="n">delinquent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the latest charge for the customer&#39;s &quot;</span>
        <span class="s2">&quot;latest invoice has failed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Stripe API returns deleted customers like so:</span>
    <span class="c1"># {</span>
    <span class="c1">#   &quot;id&quot;: &quot;cus_KX439W5dKrpi22&quot;,</span>
    <span class="c1">#   &quot;object&quot;: &quot;customer&quot;,</span>
    <span class="c1">#   &quot;deleted&quot;: true,</span>
    <span class="c1"># }</span>
    <span class="n">deleted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether the Customer instance has been deleted upstream in Stripe or not.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># &lt;discount&gt;</span>
    <span class="n">coupon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Coupon&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span>
    <span class="p">)</span>
    <span class="n">coupon_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If a coupon is present, the date at which it was applied.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">coupon_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If a coupon is present and has a limited duration, &quot;</span>
        <span class="s2">&quot;the date that the discount will end.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># &lt;/discount&gt;</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">invoice_prefix</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The prefix for the customer used to generate unique invoice numbers.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">invoice_settings</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s default invoice settings.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># default_payment_method is actually nested inside invoice_settings</span>
    <span class="c1"># this field is a convenience to provide the foreign key</span>
    <span class="n">default_payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;default payment method used for subscriptions and invoices &quot;</span>
        <span class="s2">&quot;for the customer.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s full name or business name.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s phone number.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">preferred_locales</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The customer&#39;s preferred locales (languages), ordered by preference.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">shipping</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Shipping information associated with the customer.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tax_exempt</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CustomerTaxExempt</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Describes the customer&#39;s tax exemption status. When set to reverse, &quot;</span>
        <span class="s1">&#39;invoice and receipt PDFs include the text &quot;Reverse charge&quot;.&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># dj-stripe fields</span>
    <span class="n">subscriber</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_subscriber_model_string</span><span class="p">(),</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;djstripe_customers&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">date_purged</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;subscriber&quot;</span><span class="p">,</span> <span class="s2">&quot;livemode&quot;</span><span class="p">,</span> <span class="s2">&quot;djstripe_owner_account&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>

        <span class="c1"># stripe adds a deleted attribute if the Customer has been deleted upstream</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;deleted&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;This customer (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">) has been deleted upstream, in Stripe&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># set &quot;deleted&quot; key to False (default)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;deleted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">discount</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;discount&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">discount</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;coupon_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">discount</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;coupon_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">discount</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

        <span class="c1"># Populate the object id for our default_payment_method field (or set it None)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;default_payment_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;invoice_settings&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;default_payment_method&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">subscriber</span><span class="p">,</span>
        <span class="n">livemode</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_LIVE_MODE</span><span class="p">,</span>
        <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or create a dj-stripe customer.</span>

<span class="sd">        :param subscriber: The subscriber model instance for which to get or</span>
<span class="sd">            create a customer.</span>
<span class="sd">        :type subscriber: User</span>

<span class="sd">        :param livemode: Whether to get the subscriber in live or test mode.</span>
<span class="sd">        :type livemode: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subscriber</span><span class="o">=</span><span class="n">subscriber</span><span class="p">,</span> <span class="n">livemode</span><span class="o">=</span><span class="n">livemode</span><span class="p">),</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">Customer</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;create:</span><span class="si">{</span><span class="n">subscriber</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">idempotency_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_idempotency_key</span><span class="p">(</span>
                <span class="s2">&quot;customer&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">livemode</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">subscriber</span><span class="p">,</span>
                    <span class="n">idempotency_key</span><span class="o">=</span><span class="n">idempotency_key</span><span class="p">,</span>
                    <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subscriber</span><span class="p">,</span> <span class="n">idempotency_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">subscriber_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">SUBSCRIBER_CUSTOMER_KEY</span>
        <span class="k">if</span> <span class="n">subscriber_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">subscriber_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriber</span><span class="o">.</span><span class="n">pk</span>

        <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
            <span class="n">email</span><span class="o">=</span><span class="n">subscriber</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="n">idempotency_key</span><span class="o">=</span><span class="n">idempotency_key</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">customer</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">defaults</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;subscriber&quot;</span><span class="p">:</span> <span class="n">subscriber</span><span class="p">,</span>
                <span class="s2">&quot;livemode&quot;</span><span class="p">:</span> <span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;livemode&quot;</span><span class="p">],</span>
                <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="n">stripe_customer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;delinquent&quot;</span><span class="p">:</span> <span class="n">stripe_customer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delinquent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">customer</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">credits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The customer is considered to have credits if their balance is below 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">customer_payment_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An iterable of all of the customer&#39;s payment methods</span>
<span class="sd">        (sources, then legacy cards)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">source</span>

        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_cards</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">card</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pending_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The customer is considered to have pending charges if their balance is above 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subscribes this customer to all the prices or plans in the items dict (Recommended).</span>

<span class="sd">        :param items: A list of up to 20 subscription items, each with an attached price</span>
<span class="sd">        :type list:</span>
<span class="sd">            :param items: A dictionary of Plan (or Plan ID) or Price (or Price ID)</span>
<span class="sd">            :type dict:  The price or plan to which to subscribe the customer.</span>

<span class="sd">        :param price: The price to which to subscribe the customer.</span>
<span class="sd">        :type price: Price or string (price ID)</span>

<span class="sd">        :param plan: The plan to which to subscribe the customer.</span>
<span class="sd">        :type plan: Plan or string (plan ID)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Subscription</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">items</span> <span class="ow">and</span> <span class="n">price</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">items</span> <span class="ow">and</span> <span class="n">plan</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">price</span> <span class="ow">and</span> <span class="n">plan</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please define only one of items, price or plan arguments.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_items</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">}]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">plan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plan&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">price</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_sanitise_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">plan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;price&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">})</span>
                <span class="k">if</span> <span class="s2">&quot;plan&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;plan&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">})</span>

        <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
            <span class="n">items</span><span class="o">=</span><span class="n">_items</span><span class="p">,</span> <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">charge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">application_fee</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Charge</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a charge for this customer.</span>

<span class="sd">        :param amount: The amount to charge.</span>
<span class="sd">        :type amount: Decimal. Precision is 2; anything more will be ignored.</span>
<span class="sd">        :param source: The source to use for this charge.</span>
<span class="sd">            Must be a source attributed to this customer. If None, the customer&#39;s</span>
<span class="sd">            default source is used. Can be either the id of the source or</span>
<span class="sd">            the source object itself.</span>
<span class="sd">        :type source: string, Source</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must supply a decimal value representing dollars.&quot;</span><span class="p">)</span>

        <span class="c1"># Convert Source to id</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">id</span>

        <span class="n">stripe_charge</span> <span class="o">=</span> <span class="n">Charge</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
            <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Convert dollars into cents</span>
            <span class="n">application_fee</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">application_fee</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">application_fee</span>
            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Convert dollars into cents</span>
            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">return</span> <span class="n">Charge</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_charge</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_invoice_item</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">amount</span><span class="p">,</span>
        <span class="n">currency</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">discountable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">invoice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">subscription</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an arbitrary charge or credit to the customer&#39;s upcoming invoice.</span>
<span class="sd">        Different than creating a charge. Charges are separate bills that get</span>
<span class="sd">        processed immediately. Invoice items are appended to the customer&#39;s next</span>
<span class="sd">        invoice. This is extremely useful when adding surcharges to subscriptions.</span>

<span class="sd">        :param amount: The amount to charge.</span>
<span class="sd">        :type amount: Decimal. Precision is 2; anything more will be ignored.</span>
<span class="sd">        :param currency: 3-letter ISO code for currency</span>
<span class="sd">        :type currency: string</span>
<span class="sd">        :param description: An arbitrary string.</span>
<span class="sd">        :type description: string</span>
<span class="sd">        :param discountable: Controls whether discounts apply to this invoice item.</span>
<span class="sd">            Defaults to False for prorations or negative invoice items,</span>
<span class="sd">            and True for all other invoice items.</span>
<span class="sd">        :type discountable: boolean</span>
<span class="sd">        :param invoice: An existing invoice to add this invoice item to.</span>
<span class="sd">            When left blank, the invoice item will be added to the next upcoming \</span>
<span class="sd">             scheduled invoice. \</span>
<span class="sd">             Use this when adding invoice items in response to an \</span>
<span class="sd">             ``invoice.created`` webhook. You cannot add an invoice \</span>
<span class="sd">            item to an invoice that has already been paid, attempted or closed.</span>
<span class="sd">        :type invoice: Invoice or string (invoice ID)</span>
<span class="sd">        :param metadata: A set of key/value pairs useful for storing</span>
<span class="sd">            additional information.</span>
<span class="sd">        :type metadata: dict</span>
<span class="sd">        :param subscription: A subscription to add this invoice item to.</span>
<span class="sd">            When left blank, the invoice item will be be added to the next upcoming \</span>
<span class="sd">            scheduled invoice. When set, scheduled invoices for subscriptions other \</span>
<span class="sd">            than the specified subscription will ignore the invoice item. \</span>
<span class="sd">            Use this when you want to express that an invoice item has been accrued \</span>
<span class="sd">            within the context of a particular subscription.</span>
<span class="sd">        :type subscription: Subscription or string (subscription ID)</span>

<span class="sd">        .. Notes:</span>
<span class="sd">        .. if you&#39;re using ``Customer.add_invoice_item()`` instead of</span>
<span class="sd">        .. ``Customer.add_invoice_item()``, ``invoice`` and ``subscriptions``</span>
<span class="sd">        .. can only be strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">InvoiceItem</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must supply a decimal value representing dollars.&quot;</span><span class="p">)</span>

        <span class="c1"># Convert Invoice to id</span>
        <span class="k">if</span> <span class="n">invoice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">invoice</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># Convert Subscription to id</span>
        <span class="k">if</span> <span class="n">subscription</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscription</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">subscription</span> <span class="o">=</span> <span class="n">subscription</span><span class="o">.</span><span class="n">id</span>

        <span class="n">stripe_invoiceitem</span> <span class="o">=</span> <span class="n">InvoiceItem</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Convert dollars into cents</span>
            <span class="n">currency</span><span class="o">=</span><span class="n">currency</span><span class="p">,</span>
            <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">discountable</span><span class="o">=</span><span class="n">discountable</span><span class="p">,</span>
            <span class="n">invoice</span><span class="o">=</span><span class="n">invoice</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">subscription</span><span class="o">=</span><span class="n">subscription</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">InvoiceItem</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="n">stripe_invoiceitem</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">set_default</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a card to this customer&#39;s account.</span>

<span class="sd">        :param source: Either a token, like the ones returned by our Stripe.js, or a</span>
<span class="sd">            dictionary containing a user&#39;s credit card details.</span>
<span class="sd">            Stripe will automatically validate the card.</span>
<span class="sd">        :type source: string, dict</span>
<span class="sd">        :param set_default: Whether or not to set the source as the customer&#39;s</span>
<span class="sd">            default source</span>
<span class="sd">        :type set_default: boolean</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.payment_methods</span> <span class="kn">import</span> <span class="n">DjstripePaymentMethod</span>

        <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
        <span class="n">new_stripe_payment_method</span> <span class="o">=</span> <span class="n">stripe_customer</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_default</span><span class="p">:</span>
            <span class="n">stripe_customer</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">new_stripe_payment_method</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">stripe_customer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">new_payment_method</span> <span class="o">=</span> <span class="n">DjstripePaymentMethod</span><span class="o">.</span><span class="n">from_stripe_object</span><span class="p">(</span>
            <span class="n">new_stripe_payment_method</span>
        <span class="p">)</span>

        <span class="c1"># Change the default source</span>
        <span class="k">if</span> <span class="n">set_default</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">new_payment_method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new_payment_method</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_payment_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment_method</span><span class="p">,</span> <span class="n">set_default</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an already existing payment method to this customer&#39;s account</span>

<span class="sd">        :param payment_method: PaymentMethod to be attached to the customer</span>
<span class="sd">        :type payment_method: str, PaymentMethod</span>
<span class="sd">        :param set_default: If true, this will be set as the default_payment_method</span>
<span class="sd">        :type set_default: bool</span>
<span class="sd">        :rtype: PaymentMethod</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.payment_methods</span> <span class="kn">import</span> <span class="n">PaymentMethod</span>

        <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
        <span class="n">payment_method</span> <span class="o">=</span> <span class="n">PaymentMethod</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">stripe_customer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_default</span><span class="p">:</span>
            <span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;invoice_settings&quot;</span><span class="p">][</span>
                <span class="s2">&quot;default_payment_method&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">payment_method</span><span class="o">.</span><span class="n">id</span>
            <span class="n">stripe_customer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># Refresh self from the stripe customer, this should have two effects:</span>
            <span class="c1"># 1) sets self.default_payment_method (we rely on logic in</span>
            <span class="c1"># Customer._manipulate_stripe_object_hook to do this)</span>
            <span class="c1"># 2) updates self.invoice_settings.default_payment_methods</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_customer</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">payment_method</span>

    <span class="k">def</span> <span class="nf">purge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Customers are soft deleted as deleted customers are still accessible by the</span>
<span class="sd">        Stripe API and sync for all RelatedModels would fail&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_api_delete</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;No such customer:&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                <span class="c1"># The exception was thrown because the stripe customer was already</span>
                <span class="c1"># deleted on the stripe side, ignore the exception</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The exception was raised for another reason, re-raise it</span>
                <span class="k">raise</span>

        <span class="c1"># toggle the deleted flag on Customer to indicate it has been</span>
        <span class="c1"># deleted upstream in Stripe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleted</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">:</span>
            <span class="c1"># Delete the idempotency key used by Customer.create()</span>
            <span class="c1"># So re-creating a customer for this subscriber before the key expires</span>
            <span class="c1"># doesn&#39;t return the older Customer data</span>
            <span class="n">idempotency_key_action</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;customer:create:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">IdempotencyKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">idempotency_key_action</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Remove sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_cards</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">source</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">source</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">date_purged</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_valid_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a list of this customer&#39;s valid subscriptions.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">subscription</span>
            <span class="k">for</span> <span class="n">subscription</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptions</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">subscription</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">is_subscribed_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Product</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks to see if this customer has an active subscription to the given product.</span>

<span class="sd">        :param product: The product for which to check for an active subscription.</span>
<span class="sd">        :type product: Product or string (product ID)</span>

<span class="sd">        :returns: True if there exists an active subscription, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span>

        <span class="k">for</span> <span class="n">subscription</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_subscriptions</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">subscription</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">price</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">product</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">has_any_active_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks to see if this customer has an active subscription to any plan.</span>

<span class="sd">        :returns: True if there exists an active subscription, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_subscriptions</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">active_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns active subscriptions</span>
<span class="sd">        (subscriptions with an active status that end in the future).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptions</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="o">.</span><span class="n">active</span><span class="p">,</span>
            <span class="n">current_period_end__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns this customer&#39;s valid subscriptions</span>
<span class="sd">        (subscriptions that aren&#39;t canceled or incomplete_expired).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptions</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
            <span class="n">status__in</span><span class="o">=</span><span class="p">[</span>
                <span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="o">.</span><span class="n">canceled</span><span class="p">,</span>
                <span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="o">.</span><span class="n">incomplete_expired</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shortcut to get this customer&#39;s subscription.</span>

<span class="sd">        :returns: None if the customer has no subscriptions, the subscription if</span>
<span class="sd">            the customer has a subscription.</span>
<span class="sd">        :raises MultipleSubscriptionException: Raised if the customer has multiple</span>
<span class="sd">            subscriptions.</span>
<span class="sd">            In this case, use ``Customer.subscriptions`` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_subscriptions</span>

        <span class="k">if</span> <span class="n">subscriptions</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MultipleSubscriptionException</span><span class="p">(</span>
                <span class="s2">&quot;This customer has multiple subscriptions. Use Customer.subscriptions &quot;</span>
                <span class="s2">&quot;to access them.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subscriptions</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">send_invoice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pay and send the customer&#39;s latest invoice.</span>

<span class="sd">        :returns: True if an invoice was able to be created and paid, False otherwise</span>
<span class="sd">            (typically if there was nothing to invoice).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Invoice</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">invoice</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">pay</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">InvalidRequestError</span><span class="p">:</span>  <span class="c1"># TODO: Check this for a more</span>
            <span class="c1">#                           specific error message.</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># There was nothing to invoice</span>

    <span class="k">def</span> <span class="nf">retry_unpaid_invoices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Attempt to retry collecting payment on the customer&#39;s unpaid invoices.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_invoices</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">auto_advance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">&quot;paid&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">invoice</span><span class="o">.</span><span class="n">retry</span><span class="p">()</span>  <span class="c1"># Always retry unpaid invoices</span>
            <span class="k">except</span> <span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;Invoice is already paid&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">add_coupon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coupon</span><span class="p">,</span> <span class="n">idempotency_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a coupon to a Customer.</span>

<span class="sd">        The coupon can be a Coupon object, or a valid Stripe Coupon ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coupon</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">coupon</span> <span class="o">=</span> <span class="n">coupon</span><span class="o">.</span><span class="n">id</span>

        <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
        <span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;coupon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupon</span>
        <span class="n">stripe_customer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">idempotency_key</span><span class="o">=</span><span class="n">idempotency_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="n">stripe_customer</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">upcoming_invoice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the upcoming preview invoice (singular) for this customer.</span>

<span class="sd">        See `Invoice.upcoming() &lt;#djstripe.Invoice.upcoming&gt;`__.</span>

<span class="sd">        The ``customer`` argument to the ``upcoming()`` call is automatically set</span>
<span class="sd">         by this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Invoice</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;customer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">upcoming</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Coupon</span>
        <span class="kn">from</span> <span class="nn">.payment_methods</span> <span class="kn">import</span> <span class="n">DjstripePaymentMethod</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">customer_sources</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">customer_sources</span><span class="p">:</span>
            <span class="c1"># Have to create sources before we handle the default_source</span>
            <span class="c1"># We save all of them in the `sources` dict, so that we can find them</span>
            <span class="c1"># by id when we look at the default_source (we need the source type).</span>
            <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">customer_sources</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">DjstripePaymentMethod</span><span class="o">.</span><span class="n">_get_or_create_source</span><span class="p">(</span>
                    <span class="n">source</span><span class="p">,</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">],</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
                <span class="n">sources</span><span class="p">[</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">obj</span>

        <span class="n">discount</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;discount&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">discount</span><span class="p">:</span>
            <span class="n">coupon</span><span class="p">,</span> <span class="n">_created</span> <span class="o">=</span> <span class="n">Coupon</span><span class="o">.</span><span class="n">_get_or_create_from_stripe_object</span><span class="p">(</span>
                <span class="n">discount</span><span class="p">,</span> <span class="s2">&quot;coupon&quot;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">coupon</span> <span class="ow">and</span> <span class="n">coupon</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupon</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coupon</span> <span class="o">=</span> <span class="n">coupon</span>
                <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coupon</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="p">):</span>
        <span class="c1"># When we save a customer to Stripe, we add a reference to its Django PK</span>
        <span class="c1"># in the `django_account` key. If we find that, we re-attach that PK.</span>
        <span class="n">subscriber_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">SUBSCRIBER_CUSTOMER_KEY</span>
        <span class="k">if</span> <span class="n">subscriber_key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># Disabled. Nothing else to do.</span>
            <span class="k">return</span>

        <span class="n">subscriber_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subscriber_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subscriber_id</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_subscriber_model</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># We have to perform a get(), instead of just attaching the PK</span>
                <span class="c1"># blindly as the object may have been deleted or not exist.</span>
                <span class="c1"># Attempting to save that would cause an IntegrityError.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">subscriber_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Could not find subscriber </span><span class="si">%r</span><span class="s2"> matching customer </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">subscriber_id</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># SYNC methods should be dropped in favor of the master sync infrastructure proposed</span>
    <span class="k">def</span> <span class="nf">_sync_invoices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Invoice</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">for</span> <span class="n">stripe_invoice</span> <span class="ow">in</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">Invoice</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_invoice</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sync_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">for</span> <span class="n">stripe_charge</span> <span class="ow">in</span> <span class="n">Charge</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">Charge</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_charge</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sync_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.payment_methods</span> <span class="kn">import</span> <span class="n">Card</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">for</span> <span class="n">stripe_card</span> <span class="ow">in</span> <span class="n">Card</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">Card</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_card</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sync_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Subscription</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">for</span> <span class="n">stripe_subscription</span> <span class="ow">in</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span>
            <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
            <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Customer-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.address" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s address.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.balance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Current balance (in cents), if any, being stored on the customer&#39;s account. If negative, the customer has credit to apply to the next invoice. If positive, the customer has an amount owed that will be added to the next invoice. The balance does not refer to any unpaid invoices; it solely takes into account amounts that have yet to be successfully applied to any invoice. This balance is only taken into account for recurring billing purposes (i.e., subscriptions, invoices, invoice items).&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.coupon" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">coupon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Coupon&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.coupon_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">coupon_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If a coupon is present and has a limited duration, the date that the discount will end.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.coupon_start" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">coupon_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If a coupon is present, the date at which it was applied.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The currency the customer can be charged in for recurring billing purposes&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.date_purged" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">date_purged</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.default_payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">default_payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentMethod&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;default payment method used for subscriptions and invoices for the customer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.default_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;customers&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.deleted" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">deleted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the Customer instance has been deleted upstream in Stripe or not.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.delinquent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">delinquent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the latest charge for the customer&#39;s latest invoice has failed.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.email" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default_source&#39;</span><span class="p">,</span> <span class="s1">&#39;sources&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.invoice_prefix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">invoice_prefix</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The prefix for the customer used to generate unique invoice numbers.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.invoice_settings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">invoice_settings</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s default invoice settings.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s full name or business name.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.phone" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s phone number.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.preferred_locales" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">preferred_locales</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer&#39;s preferred locales (languages), ordered by preference.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.shipping" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">shipping</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Shipping information associated with the customer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;customers&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.subscriber" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">subscriber</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_subscriber_model_string</span><span class="p">(),</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;djstripe_customers&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Customer.tax_exempt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">tax_exempt</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CustomerTaxExempt</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Describes the customer</span><span class="se">\&#39;</span><span class="s1">s tax exemption status. When set to reverse, invoice and receipt PDFs include the text &quot;Reverse charge&quot;.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.core.Customer-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.core.Customer.Meta" class="doc doc-heading">
        <code>djstripe.models.core.Customer.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span>.<span title="djstripe.models.base.StripeModel.Meta">Meta</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">754</span>
<span class="normal">755</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;subscriber&quot;</span><span class="p">,</span> <span class="s2">&quot;livemode&quot;</span><span class="p">,</span> <span class="s2">&quot;djstripe_owner_account&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.core.Customer.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.core.Customer.Meta.unique_together" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;subscriber&#39;</span><span class="p">,</span> <span class="s1">&#39;livemode&#39;</span><span class="p">,</span> <span class="s1">&#39;djstripe_owner_account&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.core.Customer-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.active_subscriptions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">active_subscriptions</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns active subscriptions
(subscriptions with an active status that end in the future).</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">active_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns active subscriptions</span>
<span class="sd">    (subscriptions with an active status that end in the future).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptions</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="n">status</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="o">.</span><span class="n">active</span><span class="p">,</span>
        <span class="n">current_period_end__gt</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.add_card" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">add_card</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">set_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds a card to this customer's account.</p>
<p>:param source: Either a token, like the ones returned by our Stripe.js, or a
    dictionary containing a user's credit card details.
    Stripe will automatically validate the card.
:type source: string, dict
:param set_default: Whether or not to set the source as the customer's
    default source
:type set_default: boolean</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">set_default</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a card to this customer&#39;s account.</span>

<span class="sd">    :param source: Either a token, like the ones returned by our Stripe.js, or a</span>
<span class="sd">        dictionary containing a user&#39;s credit card details.</span>
<span class="sd">        Stripe will automatically validate the card.</span>
<span class="sd">    :type source: string, dict</span>
<span class="sd">    :param set_default: Whether or not to set the source as the customer&#39;s</span>
<span class="sd">        default source</span>
<span class="sd">    :type set_default: boolean</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.payment_methods</span> <span class="kn">import</span> <span class="n">DjstripePaymentMethod</span>

    <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
    <span class="n">new_stripe_payment_method</span> <span class="o">=</span> <span class="n">stripe_customer</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">set_default</span><span class="p">:</span>
        <span class="n">stripe_customer</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">new_stripe_payment_method</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">stripe_customer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">new_payment_method</span> <span class="o">=</span> <span class="n">DjstripePaymentMethod</span><span class="o">.</span><span class="n">from_stripe_object</span><span class="p">(</span>
        <span class="n">new_stripe_payment_method</span>
    <span class="p">)</span>

    <span class="c1"># Change the default source</span>
    <span class="k">if</span> <span class="n">set_default</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">new_payment_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">new_payment_method</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.add_coupon" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">add_coupon</span><span class="p">(</span><span class="n">coupon</span><span class="p">,</span> <span class="n">idempotency_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Add a coupon to a Customer.</p>
<p>The coupon can be a Coupon object, or a valid Stripe Coupon ID.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_coupon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coupon</span><span class="p">,</span> <span class="n">idempotency_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a coupon to a Customer.</span>

<span class="sd">    The coupon can be a Coupon object, or a valid Stripe Coupon ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coupon</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">coupon</span> <span class="o">=</span> <span class="n">coupon</span><span class="o">.</span><span class="n">id</span>

    <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
    <span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;coupon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coupon</span>
    <span class="n">stripe_customer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">idempotency_key</span><span class="o">=</span><span class="n">idempotency_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
        <span class="n">stripe_customer</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.add_invoice_item" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">add_invoice_item</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">discountable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">invoice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subscription</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds an arbitrary charge or credit to the customer's upcoming invoice.
Different than creating a charge. Charges are separate bills that get
processed immediately. Invoice items are appended to the customer's next
invoice. This is extremely useful when adding surcharges to subscriptions.</p>
<p>:param amount: The amount to charge.
:type amount: Decimal. Precision is 2; anything more will be ignored.
:param currency: 3-letter ISO code for currency
:type currency: string
:param description: An arbitrary string.
:type description: string
:param discountable: Controls whether discounts apply to this invoice item.
    Defaults to False for prorations or negative invoice items,
    and True for all other invoice items.
:type discountable: boolean
:param invoice: An existing invoice to add this invoice item to.
    When left blank, the invoice item will be added to the next upcoming              scheduled invoice.              Use this when adding invoice items in response to an              <code>invoice.created</code> webhook. You cannot add an invoice             item to an invoice that has already been paid, attempted or closed.
:type invoice: Invoice or string (invoice ID)
:param metadata: A set of key/value pairs useful for storing
    additional information.
:type metadata: dict
:param subscription: A subscription to add this invoice item to.
    When left blank, the invoice item will be be added to the next upcoming             scheduled invoice. When set, scheduled invoices for subscriptions other             than the specified subscription will ignore the invoice item.             Use this when you want to express that an invoice item has been accrued             within the context of a particular subscription.
:type subscription: Subscription or string (subscription ID)</p>
<p>.. Notes:
.. if you're using <code>Customer.add_invoice_item()</code> instead of
.. <code>Customer.add_invoice_item()</code>, <code>invoice</code> and <code>subscriptions</code>
.. can only be strings</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_invoice_item</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">,</span>
    <span class="n">currency</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">discountable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">invoice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">subscription</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an arbitrary charge or credit to the customer&#39;s upcoming invoice.</span>
<span class="sd">    Different than creating a charge. Charges are separate bills that get</span>
<span class="sd">    processed immediately. Invoice items are appended to the customer&#39;s next</span>
<span class="sd">    invoice. This is extremely useful when adding surcharges to subscriptions.</span>

<span class="sd">    :param amount: The amount to charge.</span>
<span class="sd">    :type amount: Decimal. Precision is 2; anything more will be ignored.</span>
<span class="sd">    :param currency: 3-letter ISO code for currency</span>
<span class="sd">    :type currency: string</span>
<span class="sd">    :param description: An arbitrary string.</span>
<span class="sd">    :type description: string</span>
<span class="sd">    :param discountable: Controls whether discounts apply to this invoice item.</span>
<span class="sd">        Defaults to False for prorations or negative invoice items,</span>
<span class="sd">        and True for all other invoice items.</span>
<span class="sd">    :type discountable: boolean</span>
<span class="sd">    :param invoice: An existing invoice to add this invoice item to.</span>
<span class="sd">        When left blank, the invoice item will be added to the next upcoming \</span>
<span class="sd">         scheduled invoice. \</span>
<span class="sd">         Use this when adding invoice items in response to an \</span>
<span class="sd">         ``invoice.created`` webhook. You cannot add an invoice \</span>
<span class="sd">        item to an invoice that has already been paid, attempted or closed.</span>
<span class="sd">    :type invoice: Invoice or string (invoice ID)</span>
<span class="sd">    :param metadata: A set of key/value pairs useful for storing</span>
<span class="sd">        additional information.</span>
<span class="sd">    :type metadata: dict</span>
<span class="sd">    :param subscription: A subscription to add this invoice item to.</span>
<span class="sd">        When left blank, the invoice item will be be added to the next upcoming \</span>
<span class="sd">        scheduled invoice. When set, scheduled invoices for subscriptions other \</span>
<span class="sd">        than the specified subscription will ignore the invoice item. \</span>
<span class="sd">        Use this when you want to express that an invoice item has been accrued \</span>
<span class="sd">        within the context of a particular subscription.</span>
<span class="sd">    :type subscription: Subscription or string (subscription ID)</span>

<span class="sd">    .. Notes:</span>
<span class="sd">    .. if you&#39;re using ``Customer.add_invoice_item()`` instead of</span>
<span class="sd">    .. ``Customer.add_invoice_item()``, ``invoice`` and ``subscriptions``</span>
<span class="sd">    .. can only be strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">InvoiceItem</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must supply a decimal value representing dollars.&quot;</span><span class="p">)</span>

    <span class="c1"># Convert Invoice to id</span>
    <span class="k">if</span> <span class="n">invoice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">invoice</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">invoice</span> <span class="o">=</span> <span class="n">invoice</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Convert Subscription to id</span>
    <span class="k">if</span> <span class="n">subscription</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscription</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">subscription</span> <span class="o">=</span> <span class="n">subscription</span><span class="o">.</span><span class="n">id</span>

    <span class="n">stripe_invoiceitem</span> <span class="o">=</span> <span class="n">InvoiceItem</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Convert dollars into cents</span>
        <span class="n">currency</span><span class="o">=</span><span class="n">currency</span><span class="p">,</span>
        <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">discountable</span><span class="o">=</span><span class="n">discountable</span><span class="p">,</span>
        <span class="n">invoice</span><span class="o">=</span><span class="n">invoice</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">subscription</span><span class="o">=</span><span class="n">subscription</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">InvoiceItem</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
        <span class="n">stripe_invoiceitem</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.add_payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">add_payment_method</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">set_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Adds an already existing payment method to this customer's account</p>
<p>:param payment_method: PaymentMethod to be attached to the customer
:type payment_method: str, PaymentMethod
:param set_default: If true, this will be set as the default_payment_method
:type set_default: bool
:rtype: PaymentMethod</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_payment_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment_method</span><span class="p">,</span> <span class="n">set_default</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an already existing payment method to this customer&#39;s account</span>

<span class="sd">    :param payment_method: PaymentMethod to be attached to the customer</span>
<span class="sd">    :type payment_method: str, PaymentMethod</span>
<span class="sd">    :param set_default: If true, this will be set as the default_payment_method</span>
<span class="sd">    :type set_default: bool</span>
<span class="sd">    :rtype: PaymentMethod</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.payment_methods</span> <span class="kn">import</span> <span class="n">PaymentMethod</span>

    <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
    <span class="n">payment_method</span> <span class="o">=</span> <span class="n">PaymentMethod</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">stripe_customer</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">set_default</span><span class="p">:</span>
        <span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;invoice_settings&quot;</span><span class="p">][</span>
            <span class="s2">&quot;default_payment_method&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">payment_method</span><span class="o">.</span><span class="n">id</span>
        <span class="n">stripe_customer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Refresh self from the stripe customer, this should have two effects:</span>
        <span class="c1"># 1) sets self.default_payment_method (we rely on logic in</span>
        <span class="c1"># Customer._manipulate_stripe_object_hook to do this)</span>
        <span class="c1"># 2) updates self.invoice_settings.default_payment_methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_customer</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">payment_method</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.charge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">application_fee</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Creates a charge for this customer.</p>
<p>:param amount: The amount to charge.
:type amount: Decimal. Precision is 2; anything more will be ignored.
:param source: The source to use for this charge.
    Must be a source attributed to this customer. If None, the customer's
    default source is used. Can be either the id of the source or
    the source object itself.
:type source: string, Source</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">charge</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">application_fee</span><span class="p">:</span> <span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Charge</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a charge for this customer.</span>

<span class="sd">    :param amount: The amount to charge.</span>
<span class="sd">    :type amount: Decimal. Precision is 2; anything more will be ignored.</span>
<span class="sd">    :param source: The source to use for this charge.</span>
<span class="sd">        Must be a source attributed to this customer. If None, the customer&#39;s</span>
<span class="sd">        default source is used. Can be either the id of the source or</span>
<span class="sd">        the source object itself.</span>
<span class="sd">    :type source: string, Source</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must supply a decimal value representing dollars.&quot;</span><span class="p">)</span>

    <span class="c1"># Convert Source to id</span>
    <span class="k">if</span> <span class="n">source</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">id</span>

    <span class="n">stripe_charge</span> <span class="o">=</span> <span class="n">Charge</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
        <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Convert dollars into cents</span>
        <span class="n">application_fee</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">application_fee</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">application_fee</span>
        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Convert dollars into cents</span>
        <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="k">return</span> <span class="n">Charge</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_charge</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">subscriber</span><span class="p">,</span> <span class="n">idempotency_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subscriber</span><span class="p">,</span> <span class="n">idempotency_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">subscriber_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">SUBSCRIBER_CUSTOMER_KEY</span>
    <span class="k">if</span> <span class="n">subscriber_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">subscriber_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">subscriber</span><span class="o">.</span><span class="n">pk</span>

    <span class="n">stripe_customer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
        <span class="n">email</span><span class="o">=</span><span class="n">subscriber</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="n">idempotency_key</span><span class="o">=</span><span class="n">idempotency_key</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">customer</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;subscriber&quot;</span><span class="p">:</span> <span class="n">subscriber</span><span class="p">,</span>
            <span class="s2">&quot;livemode&quot;</span><span class="p">:</span> <span class="n">stripe_customer</span><span class="p">[</span><span class="s2">&quot;livemode&quot;</span><span class="p">],</span>
            <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="n">stripe_customer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;delinquent&quot;</span><span class="p">:</span> <span class="n">stripe_customer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delinquent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">customer</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.credits" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">credits</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>The customer is considered to have credits if their balance is below 0.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">credits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The customer is considered to have credits if their balance is below 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.customer_payment_methods" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">customer_payment_methods</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>An iterable of all of the customer's payment methods
(sources, then legacy cards)</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">customer_payment_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An iterable of all of the customer&#39;s payment methods</span>
<span class="sd">    (sources, then legacy cards)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">source</span>

    <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_cards</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">card</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.get_or_create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">subscriber</span><span class="p">,</span> <span class="n">livemode</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_LIVE_MODE</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get or create a dj-stripe customer.</p>
<p>:param subscriber: The subscriber model instance for which to get or
    create a customer.
:type subscriber: User</p>
<p>:param livemode: Whether to get the subscriber in live or test mode.
:type livemode: bool</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">subscriber</span><span class="p">,</span>
    <span class="n">livemode</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_LIVE_MODE</span><span class="p">,</span>
    <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get or create a dj-stripe customer.</span>

<span class="sd">    :param subscriber: The subscriber model instance for which to get or</span>
<span class="sd">        create a customer.</span>
<span class="sd">    :type subscriber: User</span>

<span class="sd">    :param livemode: Whether to get the subscriber in live or test mode.</span>
<span class="sd">    :type livemode: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subscriber</span><span class="o">=</span><span class="n">subscriber</span><span class="p">,</span> <span class="n">livemode</span><span class="o">=</span><span class="n">livemode</span><span class="p">),</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">Customer</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;create:</span><span class="si">{</span><span class="n">subscriber</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">idempotency_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_idempotency_key</span><span class="p">(</span>
            <span class="s2">&quot;customer&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">livemode</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">subscriber</span><span class="p">,</span>
                <span class="n">idempotency_key</span><span class="o">=</span><span class="n">idempotency_key</span><span class="p">,</span>
                <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.has_any_active_subscription" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">has_any_active_subscription</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Checks to see if this customer has an active subscription to any plan.</p>
<p>:returns: True if there exists an active subscription, False otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_any_active_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks to see if this customer has an active subscription to any plan.</span>

<span class="sd">    :returns: True if there exists an active subscription, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_subscriptions</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.is_subscribed_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">is_subscribed_to</span><span class="p">(</span><span class="n">product</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Checks to see if this customer has an active subscription to the given product.</p>
<p>:param product: The product for which to check for an active subscription.
:type product: Product or string (product ID)</p>
<p>:returns: True if there exists an active subscription, False otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_subscribed_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Product</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks to see if this customer has an active subscription to the given product.</span>

<span class="sd">    :param product: The product for which to check for an active subscription.</span>
<span class="sd">    :type product: Product or string (product ID)</span>

<span class="sd">    :returns: True if there exists an active subscription, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span>

    <span class="k">for</span> <span class="n">subscription</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_valid_subscriptions</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">subscription</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">price</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">product</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.pending_charges" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">pending_charges</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>The customer is considered to have pending charges if their balance is above 0.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">pending_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The customer is considered to have pending charges if their balance is above 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.purge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Customers are soft deleted as deleted customers are still accessible by the
Stripe API and sync for all RelatedModels would fail</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">purge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Customers are soft deleted as deleted customers are still accessible by the</span>
<span class="sd">    Stripe API and sync for all RelatedModels would fail&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_delete</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;No such customer:&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
            <span class="c1"># The exception was thrown because the stripe customer was already</span>
            <span class="c1"># deleted on the stripe side, ignore the exception</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The exception was raised for another reason, re-raise it</span>
            <span class="k">raise</span>

    <span class="c1"># toggle the deleted flag on Customer to indicate it has been</span>
    <span class="c1"># deleted upstream in Stripe</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deleted</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">:</span>
        <span class="c1"># Delete the idempotency key used by Customer.create()</span>
        <span class="c1"># So re-creating a customer for this subscriber before the key expires</span>
        <span class="c1"># doesn&#39;t return the older Customer data</span>
        <span class="n">idempotency_key_action</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;customer:create:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="o">.</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">IdempotencyKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">idempotency_key_action</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Remove sources</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_cards</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">source</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">source</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">date_purged</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.retry_unpaid_invoices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">retry_unpaid_invoices</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Attempt to retry collecting payment on the customer's unpaid invoices.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">retry_unpaid_invoices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Attempt to retry collecting payment on the customer&#39;s unpaid invoices.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sync_invoices</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">auto_advance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">&quot;paid&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">invoice</span><span class="o">.</span><span class="n">retry</span><span class="p">()</span>  <span class="c1"># Always retry unpaid invoices</span>
        <span class="k">except</span> <span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;Invoice is already paid&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.send_invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">send_invoice</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Pay and send the customer's latest invoice.</p>
<p>:returns: True if an invoice was able to be created and paid, False otherwise
    (typically if there was nothing to invoice).</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">send_invoice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pay and send the customer&#39;s latest invoice.</span>

<span class="sd">    :returns: True if an invoice was able to be created and paid, False otherwise</span>
<span class="sd">        (typically if there was nothing to invoice).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Invoice</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">invoice</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">invoice</span><span class="o">.</span><span class="n">pay</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">InvalidRequestError</span><span class="p">:</span>  <span class="c1"># TODO: Check this for a more</span>
        <span class="c1">#                           specific error message.</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># There was nothing to invoice</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.subscribe" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Subscribes this customer to all the prices or plans in the items dict (Recommended).</p>
<p>:param items: A list of up to 20 subscription items, each with an attached price
:type list:
    :param items: A dictionary of Plan (or Plan ID) or Price (or Price ID)
    :type dict:  The price or plan to which to subscribe the customer.</p>
<p>:param price: The price to which to subscribe the customer.
:type price: Price or string (price ID)</p>
<p>:param plan: The plan to which to subscribe the customer.
:type plan: Plan or string (plan ID)</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subscribes this customer to all the prices or plans in the items dict (Recommended).</span>

<span class="sd">    :param items: A list of up to 20 subscription items, each with an attached price</span>
<span class="sd">    :type list:</span>
<span class="sd">        :param items: A dictionary of Plan (or Plan ID) or Price (or Price ID)</span>
<span class="sd">        :type dict:  The price or plan to which to subscribe the customer.</span>

<span class="sd">    :param price: The price to which to subscribe the customer.</span>
<span class="sd">    :type price: Price or string (price ID)</span>

<span class="sd">    :param plan: The plan to which to subscribe the customer.</span>
<span class="sd">    :type plan: Plan or string (plan ID)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Subscription</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">items</span> <span class="ow">and</span> <span class="n">price</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">items</span> <span class="ow">and</span> <span class="n">plan</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">price</span> <span class="ow">and</span> <span class="n">plan</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Please define only one of items, price or plan arguments.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_items</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">}]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">plan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plan&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">price</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_sanitise_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">plan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;price&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">})</span>
            <span class="k">if</span> <span class="s2">&quot;plan&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;plan&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">})</span>

    <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span>
        <span class="n">items</span><span class="o">=</span><span class="n">_items</span><span class="p">,</span> <span class="n">customer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.subscription" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">subscription</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Shortcut to get this customer's subscription.</p>
<p>:returns: None if the customer has no subscriptions, the subscription if
    the customer has a subscription.
:raises MultipleSubscriptionException: Raised if the customer has multiple
    subscriptions.
    In this case, use <code>Customer.subscriptions</code> instead.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shortcut to get this customer&#39;s subscription.</span>

<span class="sd">    :returns: None if the customer has no subscriptions, the subscription if</span>
<span class="sd">        the customer has a subscription.</span>
<span class="sd">    :raises MultipleSubscriptionException: Raised if the customer has multiple</span>
<span class="sd">        subscriptions.</span>
<span class="sd">        In this case, use ``Customer.subscriptions`` instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">subscriptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_subscriptions</span>

    <span class="k">if</span> <span class="n">subscriptions</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MultipleSubscriptionException</span><span class="p">(</span>
            <span class="s2">&quot;This customer has multiple subscriptions. Use Customer.subscriptions &quot;</span>
            <span class="s2">&quot;to access them.&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">subscriptions</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.upcoming_invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">upcoming_invoice</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the upcoming preview invoice (singular) for this customer.</p>
<p>See <code>Invoice.upcoming() &lt;#djstripe.Invoice.upcoming&gt;</code>__.</p>
<p>The <code>customer</code> argument to the <code>upcoming()</code> call is automatically set
 by this method.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upcoming_invoice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the upcoming preview invoice (singular) for this customer.</span>

<span class="sd">    See `Invoice.upcoming() &lt;#djstripe.Invoice.upcoming&gt;`__.</span>

<span class="sd">    The ``customer`` argument to the ``upcoming()`` call is automatically set</span>
<span class="sd">     by this method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.billing</span> <span class="kn">import</span> <span class="n">Invoice</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;customer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">return</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">upcoming</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Customer.valid_subscriptions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">valid_subscriptions</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns this customer's valid subscriptions
(subscriptions that aren't canceled or incomplete_expired).</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">valid_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns this customer&#39;s valid subscriptions</span>
<span class="sd">    (subscriptions that aren&#39;t canceled or incomplete_expired).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriptions</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
        <span class="n">status__in</span><span class="o">=</span><span class="p">[</span>
            <span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="o">.</span><span class="n">canceled</span><span class="p">,</span>
            <span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="o">.</span><span class="n">incomplete_expired</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Dispute" class="doc doc-heading">
        <code>djstripe.models.core.Dispute</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A dispute occurs when a customer questions your charge with their
card issuer. When this happens, you're given the opportunity to
respond to the dispute with evidence that shows that the charge is legitimate</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#disputes</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Dispute</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dispute occurs when a customer questions your charge with their</span>
<span class="sd">    card issuer. When this happens, you&#39;re given the opportunity to</span>
<span class="sd">    respond to the dispute with evidence that shows that the charge is legitimate</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#disputes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Dispute</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;payments&quot;</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Disputed amount (in cents). Usually the amount of the charge, &quot;</span>
            <span class="s2">&quot;but can differ &quot;</span>
            <span class="s2">&quot;(usually because of currency fluctuation or because only part of &quot;</span>
            <span class="s2">&quot;the order is disputed).&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;disputes&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your &quot;</span>
        <span class="s2">&quot;account balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">balance_transactions</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;List of 0, 1 or 2 Balance Transactions that show funds withdrawn and reinstated to your Stripe account as a result of this dispute.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># charge is nullable to avoid infinite sync as Charge model has a dispute field as well</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Charge&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;disputes&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The charge that was disputed&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">evidence</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Evidence provided to respond to a dispute.&quot;</span><span class="p">)</span>
    <span class="n">evidence_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information about the evidence submission.&quot;</span><span class="p">)</span>
    <span class="n">is_charge_refundable</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If true, it is still possible to refund the disputed payment. &quot;</span>
            <span class="s2">&quot;Once the payment has been fully refunded, no further funds will &quot;</span>
            <span class="s2">&quot;be withdrawn from your Stripe account as a result of this dispute.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">payment_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentIntent&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;disputes&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The PaymentIntent that was disputed&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">DisputeReason</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">DisputeStatus</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">DisputeStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">) &quot;</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the stripe dashboard url for this object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stripe_dashboard_url</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_intent</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="c1"># Retrieve and save files from the dispute.evidence object.</span>
        <span class="c1"># todo find a better way of retrieving and syncing File Type fields from Dispute object</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;cancellation_policy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;customer_communication&quot;</span><span class="p">,</span>
            <span class="s2">&quot;customer_signature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;duplicate_charge_documentation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;receipt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;refund_policy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;service_documentation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shipping_documentation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uncategorized_file&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">file_upload_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evidence</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_upload_id</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">File</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
                        <span class="n">File</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">file_upload_id</span><span class="p">)</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">),</span>
                        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">PermissionError</span><span class="p">:</span>
                    <span class="c1"># No permission to retrieve the data with the key</span>
                    <span class="c1"># Log a warning message</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;No permission to retrieve the File Evidence Object.&quot;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">:</span>
                    <span class="k">raise</span>

        <span class="c1"># iterate and sync every balance transaction</span>
        <span class="k">for</span> <span class="n">stripe_balance_transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transactions</span><span class="p">:</span>
            <span class="n">BalanceTransaction</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
                <span class="n">stripe_balance_transaction</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Dispute-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Disputed amount (in cents). Usually the amount of the charge, but can differ (usually because of currency fluctuation or because only part of the order is disputed).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;disputes&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.balance_transactions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">balance_transactions</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;List of 0, 1 or 2 Balance Transactions that show funds withdrawn and reinstated to your Stripe account as a result of this dispute.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.charge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Charge&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;disputes&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The charge that was disputed&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.evidence" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">evidence</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Evidence provided to respond to a dispute.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.evidence_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">evidence_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information about the evidence submission.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.is_charge_refundable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">is_charge_refundable</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If true, it is still possible to refund the disputed payment. Once the payment has been fully refunded, no further funds will be withdrawn from your Stripe account as a result of this dispute.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.payment_intent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">payment_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentIntent&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;disputes&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The PaymentIntent that was disputed&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.reason" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">DisputeReason</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">DisputeStatus</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Dispute</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Dispute.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;payments&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.Dispute-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Dispute.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">DisputeStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">) &quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Dispute.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Dispute</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get the stripe dashboard url for this object.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the stripe dashboard url for this object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stripe_dashboard_url</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_intent</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Event" class="doc doc-heading">
        <code>djstripe.models.core.Event</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Events are Stripe's way of letting you know when something interesting
happens in your account.
When an interesting event occurs, a new Event object is created and POSTed
to the configured webhook URL if the Event type matches.</p>
<p>Stripe documentation: https://stripe.com/docs/api/events?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Events are Stripe&#39;s way of letting you know when something interesting</span>
<span class="sd">    happens in your account.</span>
<span class="sd">    When an interesting event occurs, a new Event object is created and POSTed</span>
<span class="sd">    to the configured webhook URL if the Event type matches.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/events?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Event</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;events&quot;</span>

    <span class="n">api_version</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;the API version at which the event data was &quot;</span>
        <span class="s2">&quot;rendered. Blank for old entries only, all new entries will have this value&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;data received at webhook. data should be considered to be garbage &quot;</span>
        <span class="s2">&quot;until validity check is run and valid flag is set&quot;</span>
    <span class="p">)</span>
    <span class="n">request_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information about the request that triggered this event, &quot;</span>
        <span class="s2">&quot;for traceability purposes. If empty string then this is an old entry &quot;</span>
        <span class="s2">&quot;without that data. If Null then this is not an old entry, but a Stripe &quot;</span>
        <span class="s2">&quot;&#39;automated&#39; event with no associated request.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">idempotency_key</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Stripe&#39;s event description code&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># as of api version 2017-02-14, the account.application.deauthorized</span>
            <span class="c1"># event sends None as api_version.</span>
            <span class="c1"># If we receive that, store an empty string instead.</span>
            <span class="c1"># Remove this hack if this gets fixed upstream.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">request_obj</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request_obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Format as of 2017-05-25</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idempotency_key</span> <span class="o">=</span> <span class="n">request_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;idempotency_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Format before 2017-05-25</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_obj</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="c1"># Rollback any DB operations in the case of failure so</span>
        <span class="c1"># we will retry creating and processing the event the</span>
        <span class="c1"># next time the webhook fires.</span>
        <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
            <span class="c1"># process the event and create an Event Object</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_from_stripe_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">invoke_webhook_handlers</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">invoke_webhook_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invokes any webhook handlers that have been registered for this event</span>
<span class="sd">        based on event type or event sub-type.</span>

<span class="sd">        See event handlers registered in the ``djstripe.event_handlers`` module</span>
<span class="sd">        (or handlers registered in djstripe plugins or contrib packages).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">webhooks</span><span class="o">.</span><span class="n">call_handlers</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">signal</span> <span class="o">=</span> <span class="n">WEBHOOK_SIGNALS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">signal</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">Event</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the event category/verb as a list of parts.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the event category string (e.g. &#39;customer&#39;).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">verb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the event past-tense verb string (e.g. &#39;updated&#39;).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">customer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;customer&quot;</span><span class="p">:</span>
            <span class="n">customer_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">customer_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">customer_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Customer</span><span class="o">.</span><span class="n">_get_or_retrieve</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span>
                <span class="n">stripe_account</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">djstripe_owner_account</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Event-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.api_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;the API version at which the event data was rendered. Blank for old entries only, all new entries will have this value&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;data received at webhook. data should be considered to be garbage until validity check is run and valid flag is set&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.idempotency_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">idempotency_key</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.request_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information about the request that triggered this event, for traceability purposes. If empty string then this is an old entry without that data. If Null then this is not an old entry, but a Stripe &#39;automated&#39; event with no associated request.&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Event</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;events&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Event.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Stripe&#39;s event description code&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.Event-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1525</span>
<span class="normal">1526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.category" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">category</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the event category string (e.g. 'customer').</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cached_property</span>
<span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the event category string (e.g. &#39;customer&#39;).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">customer</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">customer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;customer&quot;</span><span class="p">:</span>
        <span class="n">customer_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">customer_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">customer_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Customer</span><span class="o">.</span><span class="n">_get_or_retrieve</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="n">stripe_account</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">djstripe_owner_account</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.invoke_webhook_handlers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">invoke_webhook_handlers</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Invokes any webhook handlers that have been registered for this event
based on event type or event sub-type.</p>
<p>See event handlers registered in the <code>djstripe.event_handlers</code> module
(or handlers registered in djstripe plugins or contrib packages).</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">invoke_webhook_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invokes any webhook handlers that have been registered for this event</span>
<span class="sd">    based on event type or event sub-type.</span>

<span class="sd">    See event handlers registered in the ``djstripe.event_handlers`` module</span>
<span class="sd">    (or handlers registered in djstripe plugins or contrib packages).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">webhooks</span><span class="o">.</span><span class="n">call_handlers</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">signal</span> <span class="o">=</span> <span class="n">WEBHOOK_SIGNALS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">signal</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">Event</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.parts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">parts</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the event category/verb as a list of parts.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cached_property</span>
<span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the event category/verb as a list of parts.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.process" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">):</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="c1"># Rollback any DB operations in the case of failure so</span>
    <span class="c1"># we will retry creating and processing the event the</span>
    <span class="c1"># next time the webhook fires.</span>
    <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
        <span class="c1"># process the event and create an Event Object</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_from_stripe_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">invoke_webhook_handlers</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Event.verb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">verb</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the event past-tense verb string (e.g. 'updated').</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cached_property</span>
<span class="k">def</span> <span class="nf">verb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the event past-tense verb string (e.g. &#39;updated&#39;).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.File" class="doc doc-heading">
        <code>djstripe.models.core.File</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>This is an object representing a file hosted on Stripe's servers.
The file may have been uploaded by yourself using the create file request
(for example, when uploading dispute evidence) or it may have been created by
Stripe (for example, the results of a Sigma scheduled query).</p>
<p>Stripe documentation: https://stripe.com/docs/api/files?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is an object representing a file hosted on Stripe&#39;s servers.</span>
<span class="sd">    The file may have been uploaded by yourself using the create file request</span>
<span class="sd">    (for example, when uploading dispute evidence) or it may have been created by</span>
<span class="sd">    Stripe (for example, the results of a Sigma scheduled query).</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/files?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">File</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A filename for the file, suitable for saving to a filesystem.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">purpose</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">FilePurpose</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The purpose of the uploaded file.&quot;</span>
    <span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The size in bytes of the file upload object.&quot;</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">FileType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The type of the file returned.&quot;</span>
    <span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A read-only URL where the uploaded file can be accessed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_valid_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;file_upload&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">FilePurpose</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">purpose</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.File-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.File.filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A filename for the file, suitable for saving to a filesystem.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.File.purpose" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">purpose</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">FilePurpose</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The purpose of the uploaded file.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.File.size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The size in bytes of the file upload object.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.File.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">File</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.File.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">FileType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The type of the file returned.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.File.url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A read-only URL where the uploaded file can be accessed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.File-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.File.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1640</span>
<span class="normal">1641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">FilePurpose</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">purpose</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.File.is_valid_object" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">is_valid_object</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_valid_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;file_upload&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.FileLink" class="doc doc-heading">
        <code>djstripe.models.core.FileLink</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>To share the contents of a File object with non-Stripe users,
you can create a FileLink. FileLinks contain a URL that can be used
to retrieve the contents of the file without authentication.</p>
<p>Stripe documentation: https://stripe.com/docs/api/file_links?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FileLink</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To share the contents of a File object with non-Stripe users,</span>
<span class="sd">    you can create a FileLink. FileLinks contain a URL that can be used</span>
<span class="sd">    to retrieve the contents of the file without authentication.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/file_links?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">FileLink</span>

    <span class="n">expires_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Time at which the link expires.&quot;</span>
    <span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The publicly accessible URL to download the file.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.FileLink-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.FileLink.expires_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FileLink</span><span class="o">.</span><span class="n">expires_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Time at which the link expires.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.FileLink.file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FileLink</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;File&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.FileLink.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FileLink</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">FileLink</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.FileLink.url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FileLink</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The publicly accessible URL to download the file.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.FileLink-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.FileLink.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FileLink</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1667</span>
<span class="normal">1668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Mandate" class="doc doc-heading">
        <code>djstripe.models.core.Mandate</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A Mandate is a record of the permission a customer has given you to debit their payment method.</p>
<p>https://stripe.com/docs/api/mandates</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Mandate</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Mandate is a record of the permission a customer has given you to debit their payment method.</span>

<span class="sd">    https://stripe.com/docs/api/mandates</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Mandate</span>

    <span class="n">customer_acceptance</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Details about the customer&#39;s acceptance of the mandate.&quot;</span>
    <span class="p">)</span>
    <span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s2">&quot;paymentmethod&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">payment_method_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional mandate information specific to the payment method type.&quot;</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">MandateStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of the mandate, which indicates whether it can be used to initiate a payment.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">MandateType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of the mandate, which indicates whether it can be used to initiate a payment.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">multi_use</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If this is a `multi_use` mandate, this hash contains details about the mandate.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">single_use</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If this is a `single_use` mandate, this hash contains details about the mandate.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Mandate-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.customer_acceptance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">customer_acceptance</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Details about the customer&#39;s acceptance of the mandate.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.multi_use" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">multi_use</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If this is a `multi_use` mandate, this hash contains details about the mandate.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;paymentmethod&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.payment_method_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">payment_method_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional mandate information specific to the payment method type.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.single_use" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">single_use</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If this is a `single_use` mandate, this hash contains details about the mandate.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">MandateStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of the mandate, which indicates whether it can be used to initiate a payment.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Mandate</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Mandate.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Mandate</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">MandateType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of the mandate, which indicates whether it can be used to initiate a payment.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.PaymentIntent" class="doc doc-heading">
        <code>djstripe.models.core.PaymentIntent</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A PaymentIntent guides you through the process of collecting a payment
from your customer. We recommend that you create exactly one PaymentIntent for each order
or customer session in your system. You can reference the PaymentIntent later to
see the history of payment attempts for a particular session.</p>
<p>A PaymentIntent transitions through multiple statuses throughout its lifetime as
it interfaces with Stripe.js to perform authentication flows and ultimately
creates at most one successful charge.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#payment_intents</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PaymentIntent</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PaymentIntent guides you through the process of collecting a payment</span>
<span class="sd">    from your customer. We recommend that you create exactly one PaymentIntent for each order</span>
<span class="sd">    or customer session in your system. You can reference the PaymentIntent later to</span>
<span class="sd">    see the history of payment attempts for a particular session.</span>

<span class="sd">    A PaymentIntent transitions through multiple statuses throughout its lifetime as</span>
<span class="sd">    it interfaces with Stripe.js to perform authentication flows and ultimately</span>
<span class="sd">    creates at most one successful charge.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#payment_intents</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentIntent</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;payments&quot;</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount (in cents) intended to be collected by this PaymentIntent.&quot;</span>
    <span class="p">)</span>
    <span class="n">amount_capturable</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount (in cents) that can be captured from this PaymentIntent.&quot;</span>
    <span class="p">)</span>
    <span class="n">amount_received</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount (in cents) that was collected by this PaymentIntent.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># application</span>
    <span class="c1"># application_fee_amount</span>
    <span class="n">canceled_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Populated when status is canceled, this is the time at which the &quot;</span>
            <span class="s2">&quot;PaymentIntent was canceled. Measured in seconds since the Unix epoch.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">cancellation_reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentIntentCancellationReason</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Reason for cancellation of this PaymentIntent, either user-provided &quot;</span>
            <span class="s2">&quot;(duplicate, fraudulent, requested_by_customer, or abandoned) or &quot;</span>
            <span class="s2">&quot;generated by Stripe internally (failed_invoice, void_invoice, &quot;</span>
            <span class="s2">&quot;or automatic).&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">capture_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CaptureMethod</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Capture method of this PaymentIntent, one of automatic or manual.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The client secret of this PaymentIntent. &quot;</span>
            <span class="s2">&quot;Used for client-side retrieval using a publishable key.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">confirmation_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ConfirmationMethod</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Confirmation method of this PaymentIntent, one of manual or automatic.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Customer this PaymentIntent is for if one exists.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;An arbitrary string attached to the object. &quot;</span>
            <span class="s2">&quot;Often useful for displaying to users.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">last_payment_error</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The payment error encountered in the previous PaymentIntent confirmation.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">next_action</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If present, this property tells you what actions you need to take &quot;</span>
            <span class="s2">&quot;in order for your customer to fulfill a payment using the provided source.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">on_behalf_of</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The account (if any) for which the funds of the &quot;</span>
        <span class="s2">&quot;PaymentIntent are intended.&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;payment_intents&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Payment method used in this PaymentIntent.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_method_types</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The list of payment method types (e.g. card) that this &quot;</span>
            <span class="s2">&quot;PaymentIntent is allowed to use.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">receipt_email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Email address that the receipt for the resulting payment will be sent to.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># TODO: Add `review` field after we add Review model.</span>
    <span class="n">setup_future_usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">IntentUsage</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Indicates that you intend to make future payments with this &quot;</span>
            <span class="s2">&quot;PaymentIntent&#39;s payment method. &quot;</span>
            <span class="s2">&quot;If present, the payment method used with this PaymentIntent can &quot;</span>
            <span class="s2">&quot;be attached to a Customer, even after the transaction completes. &quot;</span>
            <span class="s2">&quot;Use `on_session` if you intend to only reuse the payment method &quot;</span>
            <span class="s2">&quot;when your customer is present in your checkout flow. Use `off_session` &quot;</span>
            <span class="s2">&quot;if your customer may or may not be in your checkout flow. &quot;</span>
            <span class="s2">&quot;Stripe uses `setup_future_usage` to dynamically optimize &quot;</span>
            <span class="s2">&quot;your payment flow and comply with regional legislation and network rules. &quot;</span>
            <span class="s2">&quot;For example, if your customer is impacted by SCA, using `off_session` &quot;</span>
            <span class="s2">&quot;will ensure that they are authenticated while processing this &quot;</span>
            <span class="s2">&quot;PaymentIntent. You will then be able to make later off-session payments &quot;</span>
            <span class="s2">&quot;for this customer.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">shipping</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Shipping information for this PaymentIntent.&quot;</span>
    <span class="p">)</span>
    <span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;For non-card charges, you can use this value as the complete description &quot;</span>
            <span class="s2">&quot;that appears on your customers&#39; statements. Must contain at least one &quot;</span>
            <span class="s2">&quot;letter, maximum 22 characters.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentIntentStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Status of this PaymentIntent, one of requires_payment_method, &quot;</span>
            <span class="s2">&quot;requires_confirmation, requires_action, processing, requires_capture, &quot;</span>
            <span class="s2">&quot;canceled, or succeeded. &quot;</span>
            <span class="s2">&quot;You can read more about PaymentIntent statuses here.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">transfer_data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The data with which to automatically create a Transfer when the payment &quot;</span>
            <span class="s2">&quot;is finalized. &quot;</span>
            <span class="s2">&quot;See the PaymentIntents Connect usage guide for details.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">transfer_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A string that identifies the resulting payment as part of a group. &quot;</span>
            <span class="s2">&quot;See the PaymentIntents Connect usage guide for details.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_behalf_of</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">PaymentIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span> <span class="ow">and</span> <span class="n">customer</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">) for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">account</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s modify operation for this model</span>

<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">stripe_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_api_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s cancel operation for this model</span>

<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_api_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s confirm operation for this model.</span>

<span class="sd">        Confirm that your customer intends to pay with current or</span>
<span class="sd">        provided payment method. Upon confirmation, the PaymentIntent</span>
<span class="sd">        will attempt to initiate a payment.</span>

<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span><span class="o">.</span><span class="n">confirm</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.PaymentIntent-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (in cents) intended to be collected by this PaymentIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.amount_capturable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">amount_capturable</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (in cents) that can be captured from this PaymentIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.amount_received" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">amount_received</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (in cents) that was collected by this PaymentIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.canceled_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">canceled_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Populated when status is canceled, this is the time at which the PaymentIntent was canceled. Measured in seconds since the Unix epoch.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.cancellation_reason" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">cancellation_reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentIntentCancellationReason</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Reason for cancellation of this PaymentIntent, either user-provided (duplicate, fraudulent, requested_by_customer, or abandoned) or generated by Stripe internally (failed_invoice, void_invoice, or automatic).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.capture_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">capture_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CaptureMethod</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Capture method of this PaymentIntent, one of automatic or manual.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.client_secret" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The client secret of this PaymentIntent. Used for client-side retrieval using a publishable key.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.confirmation_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">confirmation_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ConfirmationMethod</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Confirmation method of this PaymentIntent, one of manual or automatic.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Customer this PaymentIntent is for if one exists.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;An arbitrary string attached to the object. Often useful for displaying to users.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.last_payment_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">last_payment_error</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The payment error encountered in the previous PaymentIntent confirmation.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.next_action" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">next_action</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If present, this property tells you what actions you need to take in order for your customer to fulfill a payment using the provided source.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.on_behalf_of" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">on_behalf_of</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The account (if any) for which the funds of the PaymentIntent are intended.&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;payment_intents&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentMethod&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Payment method used in this PaymentIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.payment_method_types" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">payment_method_types</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The list of payment method types (e.g. card) that this PaymentIntent is allowed to use.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.receipt_email" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">receipt_email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Email address that the receipt for the resulting payment will be sent to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.setup_future_usage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">setup_future_usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">IntentUsage</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Indicates that you intend to make future payments with this PaymentIntent&#39;s payment method. If present, the payment method used with this PaymentIntent can be attached to a Customer, even after the transaction completes. Use `on_session` if you intend to only reuse the payment method when your customer is present in your checkout flow. Use `off_session` if your customer may or may not be in your checkout flow. Stripe uses `setup_future_usage` to dynamically optimize your payment flow and comply with regional legislation and network rules. For example, if your customer is impacted by SCA, using `off_session` will ensure that they are authenticated while processing this PaymentIntent. You will then be able to make later off-session payments for this customer.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.shipping" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">shipping</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Shipping information for this PaymentIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.statement_descriptor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;For non-card charges, you can use this value as the complete description that appears on your customers&#39; statements. Must contain at least one letter, maximum 22 characters.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentIntentStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Status of this PaymentIntent, one of requires_payment_method, requires_confirmation, requires_action, processing, requires_capture, canceled, or succeeded. You can read more about PaymentIntent statuses here.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentIntent</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;payments&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.transfer_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">transfer_data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The data with which to automatically create a Transfer when the payment is finalized. See the PaymentIntents Connect usage guide for details.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.PaymentIntent.transfer_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">transfer_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A string that identifies the resulting payment as part of a group. See the PaymentIntents Connect usage guide for details.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.PaymentIntent-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.PaymentIntent.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_behalf_of</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">PaymentIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">account</span> <span class="ow">and</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">) for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">account</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.PaymentIntent.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's modify operation for this model</p>
<p>:param api_key: The api key to use for this request.
    Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s modify operation for this model</span>

<span class="sd">    :param api_key: The api key to use for this request.</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">stripe_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Payout" class="doc doc-heading">
        <code>djstripe.models.core.Payout</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A Payout object is created when you receive funds from Stripe, or when you initiate
a payout to either a bank account or debit card of a connected Stripe account.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#payouts</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Payout</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Payout object is created when you receive funds from Stripe, or when you initiate</span>
<span class="sd">    a payout to either a bank account or debit card of a connected Stripe account.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#payouts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;destination&quot;</span><span class="p">]</span>
    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Payout</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;payouts&quot;</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount (as decimal) to be transferred to your bank account or &quot;</span>
        <span class="s2">&quot;debit card.&quot;</span>
    <span class="p">)</span>
    <span class="n">arrival_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Date the payout is expected to arrive in the bank. &quot;</span>
            <span class="s2">&quot;This factors in delays like weekends or bank holidays.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">automatic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;`true` if the payout was created by an automated payout schedule, &quot;</span>
            <span class="s2">&quot;and `false` if it was requested manually.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your &quot;</span>
        <span class="s2">&quot;account balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BankAccount&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Bank account or card the payout was sent to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">failure_balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;failure_payouts&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If the payout failed or was canceled, this will be the balance &quot;</span>
            <span class="s2">&quot;transaction that reversed the initial balance transaction, and &quot;</span>
            <span class="s2">&quot;puts the funds from the failed payout back in your balance.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">failure_code</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutFailureCode</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Error code explaining reason for transfer failure if available. &quot;</span>
            <span class="s2">&quot;See https://stripe.com/docs/api?lang=python#transfer_failures.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">failure_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Message to user further explaining reason for &quot;</span>
            <span class="s2">&quot;payout failure if available.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutMethod</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The method used to send this payout. &quot;</span>
            <span class="s2">&quot;`instant` is only supported for payouts to debit cards.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># TODO: `original_payout` impl as OneToOne, with `reversed_by` reverse relation</span>
    <span class="c1"># original_payout = StripeForeignKey(</span>
    <span class="c1">#     &quot;Payout&quot;,</span>
    <span class="c1">#     on_delete=models.SET_NULL,</span>
    <span class="c1">#     null=True,</span>
    <span class="c1">#     blank=True,</span>
    <span class="c1">#     help_text=&quot;If the payout reverses another, this is the original payout.&quot;,</span>
    <span class="c1"># )</span>
    <span class="n">source_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutSourceType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The source balance this payout came from.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Extra information about a payout to be displayed &quot;</span>
        <span class="s2">&quot;on the user&#39;s bank statement.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Current status of the payout. &quot;</span>
            <span class="s2">&quot;A payout will be `pending` until it is submitted to the bank, &quot;</span>
            <span class="s2">&quot;at which point it becomes `in_transit`. &quot;</span>
            <span class="s2">&quot;It will then change to paid if the transaction goes through. &quot;</span>
            <span class="s2">&quot;If it does not go through successfully, &quot;</span>
            <span class="s2">&quot;its status will change to `failed` or `canceled`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutType</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Payout-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (as decimal) to be transferred to your bank account or debit card.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.arrival_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">arrival_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Date the payout is expected to arrive in the bank. This factors in delays like weekends or bank holidays.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.automatic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">automatic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;`true` if the payout was created by an automated payout schedule, and `false` if it was requested manually.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.destination" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BankAccount&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Bank account or card the payout was sent to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;destination&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.failure_balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">failure_balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;failure_payouts&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the payout failed or was canceled, this will be the balance transaction that reversed the initial balance transaction, and puts the funds from the failed payout back in your balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.failure_code" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">failure_code</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutFailureCode</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Error code explaining reason for transfer failure if available. See https://stripe.com/docs/api?lang=python#transfer_failures.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.failure_message" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">failure_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Message to user further explaining reason for payout failure if available.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutMethod</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The method used to send this payout. `instant` is only supported for payouts to debit cards.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.source_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">source_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutSourceType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The source balance this payout came from.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.statement_descriptor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Extra information about a payout to be displayed on the user&#39;s bank statement.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Current status of the payout. A payout will be `pending` until it is submitted to the bank, at which point it becomes `in_transit`. It will then change to paid if the transaction goes through. If it does not go through successfully, its status will change to `failed` or `canceled`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Payout</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;payouts&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Payout.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutType</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.Payout-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Payout.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Payout</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2137</span>
<span class="normal">2138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">PayoutStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Price" class="doc doc-heading">
        <code>djstripe.models.core.Price</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Prices define the unit cost, currency, and (optional) billing cycle for
both recurring and one-time purchases of products.</p>
<p>Price and Plan objects are the same, but use a different representation.
Creating a recurring Price in Stripe also makes a Plan available, and vice versa.
This is not the case for a Price with interval=one_time.</p>
<p>Price objects are a more recent API representation, support more features
and its usage is encouraged instead of Plan objects.</p>
<p>Stripe documentation:
- https://stripe.com/docs/api/prices
- https://stripe.com/docs/billing/prices-guide</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Price</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prices define the unit cost, currency, and (optional) billing cycle for</span>
<span class="sd">    both recurring and one-time purchases of products.</span>

<span class="sd">    Price and Plan objects are the same, but use a different representation.</span>
<span class="sd">    Creating a recurring Price in Stripe also makes a Plan available, and vice versa.</span>
<span class="sd">    This is not the case for a Price with interval=one_time.</span>

<span class="sd">    Price objects are a more recent API representation, support more features</span>
<span class="sd">    and its usage is encouraged instead of Plan objects.</span>

<span class="sd">    Stripe documentation:</span>
<span class="sd">    - https://stripe.com/docs/api/prices</span>
<span class="sd">    - https://stripe.com/docs/billing/prices-guide</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Price</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;tiers&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;prices&quot;</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether the price can be used for new purchases.&quot;</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A brief description of the plan, hidden from customers.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Product&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;prices&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The product this price is associated with.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">recurring</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The recurring components of a price such as `interval` and `usage_type`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether the price is for a one-time purchase or a recurring &quot;</span>
            <span class="s2">&quot;(subscription) purchase.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">unit_amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The unit amount in cents to be charged, represented as a whole &quot;</span>
            <span class="s2">&quot;integer if possible. Null if a sub-cent precision is required.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">unit_amount_decimal</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The unit amount in cents to be charged, represented as a decimal &quot;</span>
            <span class="s2">&quot;string with at most 12 decimal places.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># More attributes</span>
    <span class="n">billing_scheme</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BillingScheme</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Describes how to compute the price per period. &quot;</span>
            <span class="s2">&quot;Either `per_unit` or `tiered`. &quot;</span>
            <span class="s2">&quot;`per_unit` indicates that the fixed amount (specified in `unit_amount` &quot;</span>
            <span class="s2">&quot;or `unit_amount_decimal`) will be charged per unit in `quantity` &quot;</span>
            <span class="s2">&quot;(for prices with `usage_type=licensed`), or per unit of total &quot;</span>
            <span class="s2">&quot;usage (for prices with `usage_type=metered`). &quot;</span>
            <span class="s2">&quot;`tiered` indicates that the unit pricing will be computed using &quot;</span>
            <span class="s2">&quot;a tiering strategy as defined using the `tiers` and `tiers_mode` &quot;</span>
            <span class="s2">&quot;attributes.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">lookup_key</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A lookup key used to retrieve prices dynamically from a &quot;</span>
        <span class="s2">&quot;static string.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tiers</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Each element represents a pricing tier. &quot;</span>
            <span class="s2">&quot;This parameter requires `billing_scheme` to be set to `tiered`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">tiers_mode</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceTiersMode</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Defines if the tiering price should be `graduated` or `volume` based. &quot;</span>
            <span class="s2">&quot;In `volume`-based tiering, the maximum quantity within a period &quot;</span>
            <span class="s2">&quot;determines the per unit price, in `graduated` tiering pricing can &quot;</span>
            <span class="s2">&quot;successively change as the quantity grows.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">transform_quantity</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Apply a transformation to the reported usage or set quantity &quot;</span>
            <span class="s2">&quot;before computing the amount billed. Cannot be combined with `tiers`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or create a Price.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Price</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">Price</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># A few minor things are changed in the api-version of the create call</span>
        <span class="n">api_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]:</span>
            <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">),</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>

        <span class="n">stripe_price</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="o">**</span><span class="n">api_kwargs</span><span class="p">)</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
        <span class="n">price</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_price</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">price</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_price</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">human_readable_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">billing_scheme</span> <span class="o">==</span> <span class="s2">&quot;per_unit&quot;</span><span class="p">:</span>
            <span class="n">unit_amount</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_amount</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="n">unit_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># tiered billing scheme</span>
            <span class="n">tier_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">formatted_unit_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
            <span class="p">)</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Starts at </span><span class="si">{</span><span class="n">formatted_unit_amount_tier_1</span><span class="si">}</span><span class="s2"> per unit&quot;</span>

            <span class="c1"># stripe shows flat fee even if it is set to 0.00</span>
            <span class="n">flat_amount_tier_1</span> <span class="o">=</span> <span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;flat_amount&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">flat_amount_tier_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">formatted_flat_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
                    <span class="n">flat_amount_tier_1</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
                <span class="p">)</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">formatted_flat_amount_tier_1</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">format_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">:</span>
            <span class="n">interval_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">[</span><span class="s2">&quot;interval_count&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">interval_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;week&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">),</span>
                <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]]</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2">/</span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;days&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;weeks&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;months&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;years&quot;</span><span class="p">),</span>
                <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]]</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2"> / every </span><span class="si">{interval_count}</span><span class="s2"> </span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
                <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval_count</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2"> (one time)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">format_lazy</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">format_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Price-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.active" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the price can be used for new purchases.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.billing_scheme" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">billing_scheme</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BillingScheme</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Describes how to compute the price per period. Either `per_unit` or `tiered`. `per_unit` indicates that the fixed amount (specified in `unit_amount` or `unit_amount_decimal`) will be charged per unit in `quantity` (for prices with `usage_type=licensed`), or per unit of total usage (for prices with `usage_type=metered`). `tiered` indicates that the unit pricing will be computed using a tiering strategy as defined using the `tiers` and `tiers_mode` attributes.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;tiers&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.lookup_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">lookup_key</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A lookup key used to retrieve prices dynamically from a static string.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.nickname" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A brief description of the plan, hidden from customers.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.product" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;prices&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The product this price is associated with.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.recurring" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">recurring</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The recurring components of a price such as `interval` and `usage_type`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Price</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;prices&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.tiers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">tiers</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Each element represents a pricing tier. This parameter requires `billing_scheme` to be set to `tiered`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.tiers_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">tiers_mode</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceTiersMode</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Defines if the tiering price should be `graduated` or `volume` based. In `volume`-based tiering, the maximum quantity within a period determines the per unit price, in `graduated` tiering pricing can successively change as the quantity grows.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.transform_quantity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">transform_quantity</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Apply a transformation to the reported usage or set quantity before computing the amount billed. Cannot be combined with `tiers`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the price is for a one-time purchase or a recurring (subscription) purchase.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.unit_amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">unit_amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The unit amount in cents to be charged, represented as a whole integer if possible. Null if a sub-cent precision is required.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Price.unit_amount_decimal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">unit_amount_decimal</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The unit amount in cents to be charged, represented as a decimal string with at most 12 decimal places.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.core.Price-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.core.Price.Meta" class="doc doc-heading">
        <code>djstripe.models.core.Price.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2262</span>
<span class="normal">2263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.core.Price.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.core.Price.Meta.ordering" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unit_amount&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.core.Price-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Price.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2291</span>
<span class="normal">2292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_price</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Price.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># A few minor things are changed in the api-version of the create call</span>
    <span class="n">api_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]:</span>
        <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">),</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>

    <span class="n">stripe_price</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="o">**</span><span class="n">api_kwargs</span><span class="p">)</span>

    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="n">price</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_price</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">price</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Price.get_or_create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get or create a Price.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get or create a Price.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Price</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">Price</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Price.human_readable_price" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Price</span><span class="o">.</span><span class="n">human_readable_price</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">human_readable_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">billing_scheme</span> <span class="o">==</span> <span class="s2">&quot;per_unit&quot;</span><span class="p">:</span>
        <span class="n">unit_amount</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_amount</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="n">unit_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># tiered billing scheme</span>
        <span class="n">tier_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">formatted_unit_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
            <span class="p">(</span><span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
        <span class="p">)</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Starts at </span><span class="si">{</span><span class="n">formatted_unit_amount_tier_1</span><span class="si">}</span><span class="s2"> per unit&quot;</span>

        <span class="c1"># stripe shows flat fee even if it is set to 0.00</span>
        <span class="n">flat_amount_tier_1</span> <span class="o">=</span> <span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;flat_amount&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">flat_amount_tier_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">formatted_flat_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
                <span class="n">flat_amount_tier_1</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
            <span class="p">)</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">formatted_flat_amount_tier_1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">format_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">:</span>
        <span class="n">interval_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">[</span><span class="s2">&quot;interval_count&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">interval_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">),</span>
                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;week&quot;</span><span class="p">),</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">),</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">),</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]]</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2">/</span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;days&quot;</span><span class="p">),</span>
                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;weeks&quot;</span><span class="p">),</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;months&quot;</span><span class="p">),</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;years&quot;</span><span class="p">),</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">recurring</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]]</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2"> / every </span><span class="si">{interval_count}</span><span class="s2"> </span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
            <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval_count</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2"> (one time)&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">format_lazy</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">format_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Product" class="doc doc-heading">
        <code>djstripe.models.core.Product</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Products describe the specific goods or services you offer to your customers.
For example, you might offer a Standard and Premium version of your goods or service;
each version would be a separate Product. They can be used in conjunction with
Prices to configure pricing in Payment Links, Checkout, and Subscriptions.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#products</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Products describe the specific goods or services you offer to your customers.</span>
<span class="sd">    For example, you might offer a Standard and Premium version of your goods or service;</span>
<span class="sd">    each version would be a separate Product. They can be used in conjunction with</span>
<span class="sd">    Prices to configure pricing in Payment Links, Checkout, and Subscriptions.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#products</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Product</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;products&quot;</span>

    <span class="c1"># Fields applicable to both `good` and `service`</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The product&#39;s name, meant to be displayable to the customer. &quot;</span>
            <span class="s2">&quot;Applicable to both `service` and `good` types.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ProductType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The type of the product. The product is either of type `good`, which is &quot;</span>
            <span class="s2">&quot;eligible for use with Orders and SKUs, or `service`, which is eligible &quot;</span>
            <span class="s2">&quot;for use with Subscriptions and Plans.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Fields applicable to `good` only</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether the product is currently available for purchase. &quot;</span>
            <span class="s2">&quot;Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A list of up to 5 attributes that each SKU can provide values for &quot;</span>
            <span class="s1">&#39;(e.g., `[&quot;color&quot;, &quot;size&quot;]`). Only applicable to products of `type=good`.&#39;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A short one-line description of the product, meant to be displayable&quot;</span>
            <span class="s2">&quot;to the customer. Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">deactivate_on</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;An array of connect application identifiers that cannot purchase &quot;</span>
            <span class="s2">&quot;this product. Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A list of up to 8 URLs of images for this product, meant to be &quot;</span>
            <span class="s2">&quot;displayable to the customer. Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">package_dimensions</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The dimensions of this product for shipping purposes. &quot;</span>
            <span class="s2">&quot;A SKU associated with this product can override this value by having its &quot;</span>
            <span class="s2">&quot;own `package_dimensions`. Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">shippable</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether this product is a shipped good. &quot;</span>
            <span class="s2">&quot;Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">799</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;A URL of a publicly-accessible webpage for this product. &quot;</span>
            <span class="s2">&quot;Only applicable to products of `type=good`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Fields available to `service` only</span>
    <span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Extra information about a product which will appear on your customer&#39;s &quot;</span>
            <span class="s2">&quot;credit card statement. In the case that multiple products are billed at &quot;</span>
            <span class="s2">&quot;once, the first statement descriptor will be used. &quot;</span>
            <span class="s2">&quot;Only available on products of type=`service`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">unit_label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 1 product can have 1 or more than 1 related price</span>
        <span class="n">price_qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">price_count</span> <span class="o">=</span> <span class="n">price_qs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">price_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">price_count</span><span class="si">}</span><span class="s2"> prices)&quot;</span>
        <span class="k">elif</span> <span class="n">price_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">price_qs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">human_readable_price</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Product-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.active" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the product is currently available for purchase. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A list of up to 5 attributes that each SKU can provide values for (e.g., `[&quot;color&quot;, &quot;size&quot;]`). Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.caption" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">caption</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A short one-line description of the product, meant to be displayableto the customer. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.deactivate_on" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">deactivate_on</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;An array of connect application identifiers that cannot purchase this product. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.images" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A list of up to 8 URLs of images for this product, meant to be displayable to the customer. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The product&#39;s name, meant to be displayable to the customer. Applicable to both `service` and `good` types.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.package_dimensions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">package_dimensions</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The dimensions of this product for shipping purposes. A SKU associated with this product can override this value by having its own `package_dimensions`. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.shippable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">shippable</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether this product is a shipped good. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.statement_descriptor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Extra information about a product which will appear on your customer&#39;s credit card statement. In the case that multiple products are billed at once, the first statement descriptor will be used. Only available on products of type=`service`.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Product</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;products&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ProductType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The type of the product. The product is either of type `good`, which is eligible for use with Orders and SKUs, or `service`, which is eligible for use with Subscriptions and Plans.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.unit_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">unit_label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Product.url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">799</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A URL of a publicly-accessible webpage for this product. Only applicable to products of `type=good`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.Product-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Product.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># 1 product can have 1 or more than 1 related price</span>
    <span class="n">price_qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">price_count</span> <span class="o">=</span> <span class="n">price_qs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">price_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">price_count</span><span class="si">}</span><span class="s2"> prices)&quot;</span>
    <span class="k">elif</span> <span class="n">price_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">price_qs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">human_readable_price</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.Refund" class="doc doc-heading">
        <code>djstripe.models.core.Refund</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Refund objects allow you to refund a charge that has previously been created
but not yet refunded. Funds will be refunded to the credit or debit card
that was originally charged.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#refund_object</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Refund</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Refund objects allow you to refund a charge that has previously been created</span>
<span class="sd">    but not yet refunded. Funds will be refunded to the credit or debit card</span>
<span class="sd">    that was originally charged.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#refund_object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Refund</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount, in cents.&quot;</span><span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your account &quot;</span>
        <span class="s2">&quot;balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Charge&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;refunds&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The charge that was refunded&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">failure_balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;failure_refunds&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the refund failed, this balance transaction describes the &quot;</span>
        <span class="s2">&quot;adjustment made on your account balance that reverses the initial &quot;</span>
        <span class="s2">&quot;balance transaction.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">failure_reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">RefundFailureReason</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the refund failed, the reason for refund failure if known.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">RefundReason</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Reason for the refund.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">receipt_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The transaction number that appears on email receipts sent &quot;</span>
        <span class="s2">&quot;for this charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">RefundStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Status of the refund.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># todo implement source_transfer_reversal and transfer_reversal</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">RefundStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.Refund-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount, in cents.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.charge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Charge&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;refunds&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The charge that was refunded&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.failure_balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">failure_balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;failure_refunds&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the refund failed, this balance transaction describes the adjustment made on your account balance that reverses the initial balance transaction.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.failure_reason" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">failure_reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">RefundFailureReason</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the refund failed, the reason for refund failure if known.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.reason" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">RefundReason</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Reason for the refund.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.receipt_number" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">receipt_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The transaction number that appears on email receipts sent for this charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">RefundStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Status of the refund.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.Refund.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Refund</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.Refund-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Refund.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">enums</span><span class="o">.</span><span class="n">RefundStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.Refund.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Refund</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2405</span>
<span class="normal">2406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.core.SetupIntent" class="doc doc-heading">
        <code>djstripe.models.core.SetupIntent</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A SetupIntent guides you through the process of setting up a customer's
payment credentials for future payments. For example, you could use a SetupIntent
to set up your customer's card without immediately collecting a payment.
Later, you can use PaymentIntents to drive the payment flow.</p>
<p>NOTE: You should not maintain long-lived, unconfirmed SetupIntents.
For security purposes, SetupIntents older than 24 hours may no longer be valid.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#setup_intents</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SetupIntent</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A SetupIntent guides you through the process of setting up a customer&#39;s</span>
<span class="sd">    payment credentials for future payments. For example, you could use a SetupIntent</span>
<span class="sd">    to set up your customer&#39;s card without immediately collecting a payment.</span>
<span class="sd">    Later, you can use PaymentIntents to drive the payment flow.</span>

<span class="sd">    NOTE: You should not maintain long-lived, unconfirmed SetupIntents.</span>
<span class="sd">    For security purposes, SetupIntents older than 24 hours may no longer be valid.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#setup_intents</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SetupIntent</span>

    <span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the Connect application that created the SetupIntent.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cancellation_reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentCancellationReason</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Reason for cancellation of this SetupIntent, one of abandoned, &quot;</span>
            <span class="s2">&quot;requested_by_customer, or duplicate&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The client secret of this SetupIntent. &quot;</span>
            <span class="s2">&quot;Used for client-side retrieval using a publishable key.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Customer this SetupIntent belongs to, if one exists.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">last_setup_error</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The error encountered in the previous SetupIntent confirmation.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">next_action</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;If present, this property tells you what actions you need to take in&quot;</span>
            <span class="s2">&quot;order for your customer to continue payment setup.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">on_behalf_of</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The account (if any) for which the setup is intended.&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;setup_intents&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Payment method used in this PaymentIntent.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_method_types</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The list of payment method types (e.g. card) that this PaymentIntent is &quot;</span>
            <span class="s2">&quot;allowed to use.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Status of this SetupIntent, one of requires_payment_method, &quot;</span>
            <span class="s2">&quot;requires_confirmation, requires_action, processing, &quot;</span>
            <span class="s2">&quot;canceled, or succeeded.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">IntentUsage</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">IntentUsage</span><span class="o">.</span><span class="n">off_session</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Indicates how the payment method is intended to be used in the future.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_behalf_of</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span>

        <span class="k">if</span> <span class="n">account</span> <span class="ow">and</span> <span class="n">customer</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">account</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.core.SetupIntent-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.application" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the Connect application that created the SetupIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.cancellation_reason" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">cancellation_reason</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentCancellationReason</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Reason for cancellation of this SetupIntent, one of abandoned, requested_by_customer, or duplicate&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.client_secret" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The client secret of this SetupIntent. Used for client-side retrieval using a publishable key.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Customer this SetupIntent belongs to, if one exists.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.last_setup_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">last_setup_error</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The error encountered in the previous SetupIntent confirmation.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.next_action" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">next_action</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If present, this property tells you what actions you need to take inorder for your customer to continue payment setup.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.on_behalf_of" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">on_behalf_of</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The account (if any) for which the setup is intended.&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;setup_intents&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentMethod&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Payment method used in this PaymentIntent.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.payment_method_types" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">payment_method_types</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The list of payment method types (e.g. card) that this PaymentIntent is allowed to use.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Status of this SetupIntent, one of requires_payment_method, requires_confirmation, requires_action, processing, canceled, or succeeded.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SetupIntent</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.core.SetupIntent.usage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">IntentUsage</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">IntentUsage</span><span class="o">.</span><span class="n">off_session</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Indicates how the payment method is intended to be used in the future.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.core.SetupIntent-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.core.SetupIntent.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">SetupIntent</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_behalf_of</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span>

    <span class="k">if</span> <span class="n">account</span> <span class="ow">and</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">account</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">customer</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">SetupIntentStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="djstripe.models.core-functions">Functions</h2>



  </div>

  </div>

</div><h2 id="payment-methods">Payment Methods</h2>
<!-- DO NOT INCLUDE LegacySourceMixin AND DjstripePaymentMethod -->


<div class="doc doc-object doc-module">


<a id="djstripe.models.payment_methods"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h2 id="djstripe.models.payment_methods-attributes">Attributes</h2>
<h2 id="djstripe.models.payment_methods-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.payment_methods.BankAccount" class="doc doc-heading">
        <code>djstripe.models.payment_methods.BankAccount</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.payment_methods.LegacySourceMixin">LegacySourceMixin</span></code>, <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>These bank accounts are payment methods on Customer objects.
On the other hand External Accounts are transfer destinations on Account
objects for Custom accounts. They can be bank accounts or debit cards as well.</p>
<p>Stripe documentation:https://stripe.com/docs/api/customer_bank_accounts</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BankAccount</span><span class="p">(</span><span class="n">LegacySourceMixin</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    These bank accounts are payment methods on Customer objects.</span>
<span class="sd">    On the other hand External Accounts are transfer destinations on Account</span>
<span class="sd">    objects for Custom accounts. They can be bank accounts or debit cards as well.</span>

<span class="sd">    Stripe documentation:https://stripe.com/docs/api/customer_bank_accounts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">BankAccount</span>

    <span class="n">account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;bank_accounts&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The external account the charge was made on behalf of. Null here indicates &quot;</span>
        <span class="s2">&quot;that this value was never set.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">account_holder_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The name of the person or business that owns the bank account.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">account_holder_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BankAccountHolderType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The type of entity that holds the account.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bank_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Name of the bank associated with the routing number &quot;</span>
        <span class="s2">&quot;(e.g., `WELLS FARGO`).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Two-letter ISO code representing the country the bank account &quot;</span>
        <span class="s2">&quot;is located in.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;bank_account&quot;</span>
    <span class="p">)</span>
    <span class="n">default_for_currency</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether this external account (BankAccount) is the default account for &quot;</span>
        <span class="s2">&quot;its currency.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Uniquely identifies this particular bank account. &quot;</span>
            <span class="s2">&quot;You can use this attribute to check whether two bank accounts are &quot;</span>
            <span class="s2">&quot;the same.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">last4</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">routing_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The routing transit number for the bank account.&quot;</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BankAccountStatus</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># prefer to show it by customer format if present</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
            <span class="n">default_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_source</span>
            <span class="n">default_payment_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_payment_method</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">default_payment_method</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_payment_method</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">default_source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_source</span><span class="o">.</span><span class="n">id</span>
            <span class="p">):</span>
                <span class="c1"># current card is the default payment method or source</span>
                <span class="n">default</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">customer_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_number</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_status</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="n">customer_template</span>

        <span class="n">default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;default_for_currency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">account_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_number</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last4</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">account_template</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">human_readable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;new&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Pending Verification&quot;</span>
        <span class="k">return</span> <span class="n">enums</span><span class="o">.</span><span class="n">BankAccountStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImpossibleAPIRequest</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t retrieve a bank account without a customer or account object.&quot;</span>
                <span class="s2">&quot; This may happen if not all accounts or customer objects are in the db.&quot;</span>
                <span class="s1">&#39; Please run &quot;python manage.py djstripe_sync_models Account Customer&quot; as a potential fix.&#39;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.payment_methods.BankAccount-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;bank_accounts&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The external account the charge was made on behalf of. Null here indicates that this value was never set.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.account_holder_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">account_holder_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The name of the person or business that owns the bank account.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.account_holder_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">account_holder_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BankAccountHolderType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The type of entity that holds the account.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.bank_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">bank_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Name of the bank associated with the routing number (e.g., `WELLS FARGO`).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.country" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Two-letter ISO code representing the country the bank account is located in.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;bank_account&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.default_for_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">default_for_currency</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether this external account (BankAccount) is the default account for its currency.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.fingerprint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">fingerprint</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Uniquely identifies this particular bank account. You can use this attribute to check whether two bank accounts are the same.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.last4" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">last4</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.routing_number" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">routing_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The routing transit number for the bank account.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BankAccountStatus</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.BankAccount.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">BankAccount</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.payment_methods.BankAccount-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.BankAccount.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># prefer to show it by customer format if present</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
        <span class="n">default_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_source</span>
        <span class="n">default_payment_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_payment_method</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">default_payment_method</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_payment_method</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">default_source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_source</span><span class="o">.</span><span class="n">id</span>
        <span class="p">):</span>
            <span class="c1"># current card is the default payment method or source</span>
            <span class="n">default</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">customer_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_number</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_status</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">customer_template</span>

    <span class="n">default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;default_for_currency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">account_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_number</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last4</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">account_template</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.BankAccount.api_retrieve" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ImpossibleAPIRequest</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t retrieve a bank account without a customer or account object.&quot;</span>
            <span class="s2">&quot; This may happen if not all accounts or customer objects are in the db.&quot;</span>
            <span class="s1">&#39; Please run &quot;python manage.py djstripe_sync_models Account Customer&quot; as a potential fix.&#39;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.BankAccount.human_readable_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">BankAccount</span><span class="o">.</span><span class="n">human_readable_status</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">human_readable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;new&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Pending Verification&quot;</span>
    <span class="k">return</span> <span class="n">enums</span><span class="o">.</span><span class="n">BankAccountStatus</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.payment_methods.Card" class="doc doc-heading">
        <code>djstripe.models.payment_methods.Card</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.payment_methods.LegacySourceMixin">LegacySourceMixin</span></code>, <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>You can store multiple cards on a customer in order to charge the customer later.</p>
<p>This is a legacy model which only applies to the "v2" Stripe API (eg. Checkout.js).
You should strive to use the Stripe "v3" API (eg. Stripe Elements).
Also see: https://stripe.com/docs/stripe-js/elements/migrating
When using Elements, you will not be using Card objects. Instead, you will use
Source objects.
A Source object of type "card" is equivalent to a Card object. However, Card
objects cannot be converted into Source objects by Stripe at this time.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#cards</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Card</span><span class="p">(</span><span class="n">LegacySourceMixin</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    You can store multiple cards on a customer in order to charge the customer later.</span>

<span class="sd">    This is a legacy model which only applies to the &quot;v2&quot; Stripe API (eg. Checkout.js).</span>
<span class="sd">    You should strive to use the Stripe &quot;v3&quot; API (eg. Stripe Elements).</span>
<span class="sd">    Also see: https://stripe.com/docs/stripe-js/elements/migrating</span>
<span class="sd">    When using Elements, you will not be using Card objects. Instead, you will use</span>
<span class="sd">    Source objects.</span>
<span class="sd">    A Source object of type &quot;card&quot; is equivalent to a Card object. However, Card</span>
<span class="sd">    objects cannot be converted into Source objects by Stripe at this time.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#cards</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Card</span>
    <span class="c1"># Stripe Custom Connected Accounts can have cards as &quot;Payout Sources&quot;</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;cards&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The external account the charge was made on behalf of. Null here indicates &quot;</span>
        <span class="s2">&quot;that this value was never set.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">address_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;City/District/Suburb/Town/Village.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">address_country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Billing address country.&quot;</span>
    <span class="p">)</span>
    <span class="n">address_line1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Street address/PO Box/Company name.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">address_line1_check</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardCheckResult</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If `address_line1` was provided, results of the check.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">address_line2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Apartment/Suite/Unit/Building.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">address_state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;State/County/Province/Region.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">address_zip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ZIP or postal code.&quot;</span>
    <span class="p">)</span>
    <span class="n">address_zip_check</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardCheckResult</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If `address_zip` was provided, results of the check.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">brand</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardBrand</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Card brand.&quot;</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Two-letter ISO code representing the country of the card.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;legacy_cards&quot;</span>
    <span class="p">)</span>
    <span class="n">cvc_check</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardCheckResult</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If a CVC was provided, results of the check.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_for_currency</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether this external account (Card) is the default account for &quot;</span>
        <span class="s2">&quot;its currency.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">dynamic_last4</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;(For tokenized numbers only.) The last four digits of the device &quot;</span>
        <span class="s2">&quot;account number.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">exp_month</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Card expiration month.&quot;</span><span class="p">)</span>
    <span class="n">exp_year</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Card expiration year.&quot;</span><span class="p">)</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Uniquely identifies this particular card number.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">funding</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardFundingType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Card funding type.&quot;</span>
    <span class="p">)</span>
    <span class="n">last4</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Last four digits of Card number.&quot;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Cardholder name.&quot;</span>
    <span class="p">)</span>
    <span class="n">tokenization_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardTokenizationMethod</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the card number is tokenized, this is the method that was used.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># prefer to show it by customer format if present</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
            <span class="n">default_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_source</span>
            <span class="n">default_payment_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_payment_method</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">default_payment_method</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_payment_method</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">default_source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_source</span><span class="o">.</span><span class="n">id</span>
            <span class="p">):</span>
                <span class="c1"># current card is the default payment method or source</span>
                <span class="n">default</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">customer_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">CardBrand</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brand</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last4</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> Expires </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_month</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_year</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="n">customer_template</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;default_for_currency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">account_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">CardBrand</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brand</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">default_currency</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last4</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="n">account_template</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_token</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">exp_month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">exp_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">cvc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Token</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a single use token that wraps the details of a credit card.</span>
<span class="sd">        This token can be used in place of a credit card dictionary with any API method.</span>
<span class="sd">        These tokens can only be used once: by creating a new charge object,</span>
<span class="sd">        or attaching them to a customer.</span>
<span class="sd">        (Source: https://stripe.com/docs/api?lang=python#create_card_token)</span>

<span class="sd">        :param number: The card number without any separators (no spaces)</span>
<span class="sd">        :param exp_month: The card&#39;s expiration month. (two digits)</span>
<span class="sd">        :param exp_year: The card&#39;s expiration year. (four digits)</span>
<span class="sd">        :param cvc: Card security code.</span>
<span class="sd">        :param api_key: The API key to use</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">card</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
            <span class="s2">&quot;exp_month&quot;</span><span class="p">:</span> <span class="n">exp_month</span><span class="p">,</span>
            <span class="s2">&quot;exp_year&quot;</span><span class="p">:</span> <span class="n">exp_year</span><span class="p">,</span>
            <span class="s2">&quot;cvc&quot;</span><span class="p">:</span> <span class="n">cvc</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">card</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">card</span><span class="o">=</span><span class="n">card</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.payment_methods.Card-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;cards&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The external account the charge was made on behalf of. Null here indicates that this value was never set.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_city" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;City/District/Suburb/Town/Village.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_country" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Billing address country.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_line1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_line1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Street address/PO Box/Company name.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_line1_check" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_line1_check</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardCheckResult</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If `address_line1` was provided, results of the check.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_line2" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_line2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Apartment/Suite/Unit/Building.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_state" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;State/County/Province/Region.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_zip" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_zip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ZIP or postal code.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.address_zip_check" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">address_zip_check</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardCheckResult</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If `address_zip` was provided, results of the check.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.brand" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">brand</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardBrand</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Card brand.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.country" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Two-letter ISO code representing the country of the card.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;legacy_cards&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.cvc_check" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">cvc_check</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardCheckResult</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If a CVC was provided, results of the check.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.default_for_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">default_for_currency</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether this external account (Card) is the default account for its currency.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.dynamic_last4" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">dynamic_last4</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;(For tokenized numbers only.) The last four digits of the device account number.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.exp_month" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">exp_month</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Card expiration month.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.exp_year" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">exp_year</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Card expiration year.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.fingerprint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">fingerprint</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Uniquely identifies this particular card number.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.funding" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">funding</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardFundingType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Card funding type.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.last4" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">last4</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Last four digits of Card number.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Cardholder name.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Card</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Card.tokenization_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">tokenization_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CardTokenizationMethod</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the card number is tokenized, this is the method that was used.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.payment_methods.Card-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Card.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># prefer to show it by customer format if present</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
        <span class="n">default_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_source</span>
        <span class="n">default_payment_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">default_payment_method</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">default_payment_method</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_payment_method</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">default_source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">default_source</span><span class="o">.</span><span class="n">id</span>
        <span class="p">):</span>
            <span class="c1"># current card is the default payment method or source</span>
            <span class="n">default</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">customer_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">CardBrand</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brand</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last4</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> Expires </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_month</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_year</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">customer_template</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;default_for_currency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">account_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">CardBrand</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brand</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">default_currency</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span> <span class="k">if</span> <span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last4</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">account_template</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Card.create_token" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Card</span><span class="o">.</span><span class="n">create_token</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">exp_month</span><span class="p">,</span> <span class="n">exp_year</span><span class="p">,</span> <span class="n">cvc</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Creates a single use token that wraps the details of a credit card.
This token can be used in place of a credit card dictionary with any API method.
These tokens can only be used once: by creating a new charge object,
or attaching them to a customer.
(Source: https://stripe.com/docs/api?lang=python#create_card_token)</p>
<p>:param number: The card number without any separators (no spaces)
:param exp_month: The card's expiration month. (two digits)
:param exp_year: The card's expiration year. (four digits)
:param cvc: Card security code.
:param api_key: The API key to use</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create_token</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">exp_month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">exp_year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">cvc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Token</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a single use token that wraps the details of a credit card.</span>
<span class="sd">    This token can be used in place of a credit card dictionary with any API method.</span>
<span class="sd">    These tokens can only be used once: by creating a new charge object,</span>
<span class="sd">    or attaching them to a customer.</span>
<span class="sd">    (Source: https://stripe.com/docs/api?lang=python#create_card_token)</span>

<span class="sd">    :param number: The card number without any separators (no spaces)</span>
<span class="sd">    :param exp_month: The card&#39;s expiration month. (two digits)</span>
<span class="sd">    :param exp_year: The card&#39;s expiration year. (four digits)</span>
<span class="sd">    :param cvc: Card security code.</span>
<span class="sd">    :param api_key: The API key to use</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">card</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
        <span class="s2">&quot;exp_month&quot;</span><span class="p">:</span> <span class="n">exp_month</span><span class="p">,</span>
        <span class="s2">&quot;exp_year&quot;</span><span class="p">:</span> <span class="n">exp_year</span><span class="p">,</span>
        <span class="s2">&quot;cvc&quot;</span><span class="p">:</span> <span class="n">cvc</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">card</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">card</span><span class="o">=</span><span class="n">card</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.payment_methods.PaymentMethod" class="doc doc-heading">
        <code>djstripe.models.payment_methods.PaymentMethod</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>PaymentMethod objects represent your customer's payment instruments.
You can use them with PaymentIntents to collect payments or save them
to Customer objects to store instrument details for future payments.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#payment_methods</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PaymentMethod</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PaymentMethod objects represent your customer&#39;s payment instruments.</span>
<span class="sd">    You can use them with PaymentIntents to collect payments or save them</span>
<span class="sd">    to Customer objects to store instrument details for future payments.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#payment_methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentMethod</span>
    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">billing_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Billing information associated with the PaymentMethod that may be used or &quot;</span>
            <span class="s2">&quot;required by particular types of payment methods.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;payment_methods&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Customer to which this PaymentMethod is saved. &quot;</span>
            <span class="s2">&quot;This will not be set when the PaymentMethod has &quot;</span>
            <span class="s2">&quot;not been saved to a Customer.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentMethodType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The type of the PaymentMethod.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">acss_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `acss_debit`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">afterpay_clearpay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `afterpay_clearpay`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">alipay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `alipay`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">au_becs_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `au_becs_debit`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bacs_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `bacs_debit`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bancontact</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `bancontact`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">boleto</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `boleto`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">card</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `card`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">card_present</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `card_present`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `eps`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fpx</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `fpx`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">giropay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `giropay`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">grabpay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `grabpay`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ideal</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `ideal`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">interac_present</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Additional information for payment methods of type `interac_present`&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">oxxo</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `oxxo`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">p24</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `p24`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sepa_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `sepa_debit`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sofort</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `sofort`&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">wechat_pay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Additional information for payment methods of type `wechat_pay`&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentMethodType</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentMethodType</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not associated with any customer&quot;</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># &quot;customer&quot; key could be like &quot;cus_6lsBvm5rJ0zyHc&quot; or {&quot;id&quot;: &quot;cus_6lsBvm5rJ0zyHc&quot;}</span>
        <span class="n">customer_id</span> <span class="o">=</span> <span class="n">get_id_from_stripe_data</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">current_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">customer_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_ids</span><span class="p">:</span>
            <span class="n">customer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_customer</span><span class="p">(</span>
                <span class="n">target_cls</span><span class="o">=</span><span class="n">Customer</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">payment_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">],</span>
        <span class="n">customer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Customer</span><span class="p">],</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a payment method to a customer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">payment_method</span> <span class="o">=</span> <span class="n">payment_method</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="n">id</span>

        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="p">):</span>
            <span class="c1"># send api_key if we&#39;re not passing in a Stripe object</span>
            <span class="c1"># avoids &quot;Received unknown parameter: api_key&quot; since api uses the</span>
            <span class="c1"># key cached in the Stripe object</span>
            <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">}</span>

        <span class="n">stripe_payment_method</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span>
            <span class="n">payment_method</span><span class="p">,</span> <span class="n">customer</span><span class="o">=</span><span class="n">customer</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_payment_method</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach the payment method from its customer.</span>

<span class="sd">        :return: Returns true if the payment method was newly detached, \</span>
<span class="sd">                 false if it was already detached</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find customers that use this</span>
        <span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">default_payment_method</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># special handling is needed for legacy &quot;card&quot;-type PaymentMethods,</span>
        <span class="c1"># since detaching them deletes them within Stripe.</span>
        <span class="c1"># see https://github.com/dj-stripe/dj-stripe/pull/967</span>
        <span class="n">is_legacy_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;card_&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span>

            <span class="c1"># resync customer to update .default_payment_method and</span>
            <span class="c1"># .invoice_settings.default_payment_method</span>
            <span class="k">for</span> <span class="n">customer</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">:</span>
                <span class="n">Customer</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">customer</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">())</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">InvalidRequestError</span><span class="p">,):</span>
            <span class="c1"># The source was already detached. Resyncing.</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_legacy_card</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">())</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_legacy_card</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">changed</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.payment_methods.PaymentMethod-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.acss_debit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">acss_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `acss_debit`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.afterpay_clearpay" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">afterpay_clearpay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `afterpay_clearpay`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.alipay" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">alipay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `alipay`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.au_becs_debit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">au_becs_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `au_becs_debit`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.bacs_debit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">bacs_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `bacs_debit`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.bancontact" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">bancontact</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `bancontact`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.billing_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">billing_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Billing information associated with the PaymentMethod that may be used or required by particular types of payment methods.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.boleto" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">boleto</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `boleto`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.card" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">card</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `card`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.card_present" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">card_present</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `card_present`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;payment_methods&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Customer to which this PaymentMethod is saved. This will not be set when the PaymentMethod has not been saved to a Customer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.eps" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `eps`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.fpx" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">fpx</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `fpx`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.giropay" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">giropay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `giropay`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.grabpay" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">grabpay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `grabpay`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.ideal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">ideal</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `ideal`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.interac_present" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">interac_present</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `interac_present`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.oxxo" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">oxxo</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `oxxo`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.p24" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">p24</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `p24`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.sepa_debit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">sepa_debit</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `sepa_debit`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.sofort" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">sofort</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `sofort`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentMethod</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentMethodType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The type of the PaymentMethod.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.PaymentMethod.wechat_pay" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">wechat_pay</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Additional information for payment methods of type `wechat_pay`&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.payment_methods.PaymentMethod-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.PaymentMethod.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentMethodType</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">PaymentMethodType</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not associated with any customer&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.PaymentMethod._attach_objects_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">_attach_objects_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># &quot;customer&quot; key could be like &quot;cus_6lsBvm5rJ0zyHc&quot; or {&quot;id&quot;: &quot;cus_6lsBvm5rJ0zyHc&quot;}</span>
    <span class="n">customer_id</span> <span class="o">=</span> <span class="n">get_id_from_stripe_data</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">current_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">customer_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_ids</span><span class="p">:</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_customer</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">Customer</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.PaymentMethod.attach" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">customer</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Attach a payment method to a customer</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">attach</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">payment_method</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">],</span>
    <span class="n">customer</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Customer</span><span class="p">],</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attach a payment method to a customer</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">payment_method</span> <span class="o">=</span> <span class="n">payment_method</span><span class="o">.</span><span class="n">id</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="n">id</span>

    <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payment_method</span><span class="p">,</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="p">):</span>
        <span class="c1"># send api_key if we&#39;re not passing in a Stripe object</span>
        <span class="c1"># avoids &quot;Received unknown parameter: api_key&quot; since api uses the</span>
        <span class="c1"># key cached in the Stripe object</span>
        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">}</span>

    <span class="n">stripe_payment_method</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span>
        <span class="n">payment_method</span><span class="p">,</span> <span class="n">customer</span><span class="o">=</span><span class="n">customer</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_payment_method</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.PaymentMethod.detach" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Detach the payment method from its customer.</p>
<p>:return: Returns true if the payment method was newly detached,                  false if it was already detached
:rtype: bool</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detach the payment method from its customer.</span>

<span class="sd">    :return: Returns true if the payment method was newly detached, \</span>
<span class="sd">             false if it was already detached</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find customers that use this</span>
    <span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">default_payment_method</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># special handling is needed for legacy &quot;card&quot;-type PaymentMethods,</span>
    <span class="c1"># since detaching them deletes them within Stripe.</span>
    <span class="c1"># see https://github.com/dj-stripe/dj-stripe/pull/967</span>
    <span class="n">is_legacy_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;card_&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">())</span>

        <span class="c1"># resync customer to update .default_payment_method and</span>
        <span class="c1"># .invoice_settings.default_payment_method</span>
        <span class="k">for</span> <span class="n">customer</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">:</span>
            <span class="n">Customer</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">customer</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">())</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">InvalidRequestError</span><span class="p">,):</span>
        <span class="c1"># The source was already detached. Resyncing.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_legacy_card</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">())</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_legacy_card</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">changed</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.PaymentMethod.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">PaymentMethod</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.payment_methods.Source" class="doc doc-heading">
        <code>djstripe.models.payment_methods.Source</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Source objects allow you to accept a variety of payment methods.
They represent a customer's payment instrument, and can be used with
the Stripe API just like a Card object: once chargeable,
they can be charged, or can be attached to customers.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#sources</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Source objects allow you to accept a variety of payment methods.</span>
<span class="sd">    They represent a customer&#39;s payment instrument, and can be used with</span>
<span class="sd">    the Stripe API just like a Card object: once chargeable,</span>
<span class="sd">    they can be charged, or can be attached to customers.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#sources</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Amount (as decimal) associated with the source. &quot;</span>
            <span class="s2">&quot;This is the amount for which the source will be chargeable once ready. &quot;</span>
            <span class="s2">&quot;Required for `single_use` sources.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The client secret of the source. &quot;</span>
            <span class="s2">&quot;Used for client-side retrieval using a publishable key.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">flow</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceFlow</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The authentication flow of the source.&quot;</span>
    <span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Information about the owner of the payment instrument that may be &quot;</span>
            <span class="s2">&quot;used or required by particular source types.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Extra information about a source. This will appear on your &quot;</span>
        <span class="s2">&quot;customer&#39;s statement every time you charge the source.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of the source. Only `chargeable` sources can be used &quot;</span>
        <span class="s2">&quot;to create a charge.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The type of the source.&quot;</span><span class="p">)</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceUsage</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether this source should be reusable or not. &quot;</span>
        <span class="s2">&quot;Some source types may or may not be reusable by construction, &quot;</span>
        <span class="s2">&quot;while other may leave the option at creation.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Flows</span>
    <span class="n">code_verification</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information related to the code verification flow. &quot;</span>
        <span class="s2">&quot;Present if the source is authenticated by a verification code &quot;</span>
        <span class="s2">&quot;(`flow` is `code_verification`).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">receiver</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information related to the receiver flow. &quot;</span>
        <span class="s2">&quot;Present if the source is a receiver (`flow` is `receiver`).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">redirect</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information related to the redirect flow. &quot;</span>
        <span class="s2">&quot;Present if the source is authenticated by a redirect (`flow` is `redirect`).&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">source_data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The data corresponding to the source type.&quot;</span><span class="p">)</span>

    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;sources&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Source</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;sources&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># The source_data dict is an alias of all the source types</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;source_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># &quot;customer&quot; key could be like &quot;cus_6lsBvm5rJ0zyHc&quot; or {&quot;id&quot;: &quot;cus_6lsBvm5rJ0zyHc&quot;}</span>
        <span class="n">customer_id</span> <span class="o">=</span> <span class="n">get_id_from_stripe_data</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">current_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">customer_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_ids</span><span class="p">:</span>
            <span class="n">customer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_customer</span><span class="p">(</span>
                <span class="n">target_cls</span><span class="o">=</span><span class="n">Customer</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach the source from its customer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First, wipe default source on all customers that use this.</span>
        <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">default_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">default_source</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># TODO - we could use the return value of sync_from_stripe_data</span>
            <span class="c1">#  or call its internals - self._sync/_attach_objects_hook etc here</span>
            <span class="c1">#  to update `self` at this point?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">InvalidRequestError</span><span class="p">:</span>
            <span class="c1"># The source was already detached. Resyncing.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">),</span>
                <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">        :returns: an iterator over all items in the query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Customer</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">list_sources</span><span class="p">(</span>
            <span class="nb">object</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.payment_methods.Source-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (as decimal) associated with the source. This is the amount for which the source will be chargeable once ready. Required for `single_use` sources.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.client_secret" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The client secret of the source. Used for client-side retrieval using a publishable key.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.code_verification" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">code_verification</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information related to the code verification flow. Present if the source is authenticated by a verification code (`flow` is `code_verification`).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;sources&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.flow" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceFlow</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The authentication flow of the source.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.owner" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information about the owner of the payment instrument that may be used or required by particular source types.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.receiver" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">receiver</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information related to the receiver flow. Present if the source is a receiver (`flow` is `receiver`).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.redirect" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">redirect</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information related to the redirect flow. Present if the source is authenticated by a redirect (`flow` is `redirect`).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.source_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">source_data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The data corresponding to the source type.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.statement_descriptor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">statement_descriptor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Extra information about a source. This will appear on your customer&#39;s statement every time you charge the source.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of the source. Only `chargeable` sources can be used to create a charge.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Source</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;sources&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The type of the source.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.payment_methods.Source.usage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SourceUsage</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether this source should be reusable or not. Some source types may or may not be reusable by construction, while other may leave the option at creation.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.payment_methods.Source-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Source.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">729</span>
<span class="normal">730</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Source._attach_objects_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">_attach_objects_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># &quot;customer&quot; key could be like &quot;cus_6lsBvm5rJ0zyHc&quot; or {&quot;id&quot;: &quot;cus_6lsBvm5rJ0zyHc&quot;}</span>
    <span class="n">customer_id</span> <span class="o">=</span> <span class="n">get_id_from_stripe_data</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">current_ids</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">customer_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_ids</span><span class="p">:</span>
        <span class="n">customer</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_customer</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">Customer</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">customer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Source._manipulate_stripe_object_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># The source_data dict is an alias of all the source types</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;source_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Source.api_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's list operation for this model.
:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
See Stripe documentation for accepted kwargs for each object.
:returns: an iterator over all items in the query</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">    :returns: an iterator over all items in the query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Customer</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">list_sources</span><span class="p">(</span>
        <span class="nb">object</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.payment_methods.Source.detach" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">payment_methods</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Detach the source from its customer.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/payment_methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detach the source from its customer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># First, wipe default source on all customers that use this.</span>
    <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">default_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">default_source</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># TODO - we could use the return value of sync_from_stripe_data</span>
        <span class="c1">#  or call its internals - self._sync/_attach_objects_hook etc here</span>
        <span class="c1">#  to update `self` at this point?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">InvalidRequestError</span><span class="p">:</span>
        <span class="c1"># The source was already detached. Resyncing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">),</span>
            <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="djstripe.models.payment_methods-functions">Functions</h2>



  </div>

  </div>

</div><h2 id="billing">Billing</h2>
<!-- DO NOT INCLUDE DjstripeInvoiceTotalTaxAmount, DjstripeUpcomingInvoiceTotalTaxAmount AND DJBaseInvoiceSTRIPEPAYMENTMETHOD -->


<div class="doc doc-object doc-module">


<a id="djstripe.models.billing"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h2 id="djstripe.models.billing-attributes">Attributes</h2>
<h2 id="djstripe.models.billing-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.Coupon" class="doc doc-heading">
        <code>djstripe.models.billing.Coupon</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A coupon contains information about a percent-off or amount-off discount you might want to apply to a customer.
Coupons may be applied to invoices or orders.
Coupons do not work with conventional one-off charges.</p>
<p>Stripe documentation: https://stripe.com/docs/api/coupons?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Coupon</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A coupon contains information about a percent-off or amount-off discount you might want to apply to a customer.</span>
<span class="sd">    Coupons may be applied to invoices or orders.</span>
<span class="sd">    Coupons do not work with conventional one-off charges.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/coupons?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Coupon</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;applies_to&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;coupons&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">applies_to</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Contains information about what this coupon applies to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">amount_off</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount (as decimal) that will be taken off the subtotal of any &quot;</span>
        <span class="s2">&quot;invoices for this customer.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CouponDuration</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Describes how long a customer who applies this coupon &quot;</span>
            <span class="s2">&quot;will get the discount.&quot;</span>
        <span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CouponDuration</span><span class="o">.</span><span class="n">once</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">duration_in_months</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If `duration` is `repeating`, the number of months &quot;</span>
        <span class="s2">&quot;the coupon applies.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">max_redemptions</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Maximum number of times this coupon can be redeemed, in total, &quot;</span>
        <span class="s2">&quot;before it is no longer valid.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Name of the coupon displayed to customers on for instance invoices &quot;</span>
            <span class="s2">&quot;or receipts.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">percent_off</span> <span class="o">=</span> <span class="n">StripePercentField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Percent that will be taken off the subtotal of any invoices for &quot;</span>
            <span class="s2">&quot;this customer for the duration of the coupon. &quot;</span>
            <span class="s2">&quot;For example, a coupon with percent_off of 50 will make a &quot;</span>
            <span class="s2">&quot;$100 invoice $50 instead.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">redeem_by</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Date after which the coupon can no longer be redeemed. &quot;</span>
        <span class="s2">&quot;Max 5 years in the future.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">times_redeemed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Number of times this coupon has been applied to a customer.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># valid = models.BooleanField(editable=False)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;livemode&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">human_readable_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">percent_off</span><span class="p">:</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">percent_off</span><span class="si">}</span><span class="s2">%&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount_off</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="s2">&quot;(invalid amount)&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> off&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">human_readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">==</span> <span class="n">enums</span><span class="o">.</span><span class="n">CouponDuration</span><span class="o">.</span><span class="n">repeating</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_in_months</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;for 1 month&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_in_months</span><span class="si">}</span><span class="s2"> months&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_amount</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.Coupon-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.amount_off" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">amount_off</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (as decimal) that will be taken off the subtotal of any invoices for this customer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.applies_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">applies_to</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Contains information about what this coupon applies to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.duration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CouponDuration</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Describes how long a customer who applies this coupon will get the discount.&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">CouponDuration</span><span class="o">.</span><span class="n">once</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.duration_in_months" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">duration_in_months</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If `duration` is `repeating`, the number of months the coupon applies.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;applies_to&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.max_redemptions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">max_redemptions</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Maximum number of times this coupon can be redeemed, in total, before it is no longer valid.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Name of the coupon displayed to customers on for instance invoices or receipts.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.percent_off" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">percent_off</span> <span class="o">=</span> <span class="n">StripePercentField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Percent that will be taken off the subtotal of any invoices for this customer for the duration of the coupon. For example, a coupon with percent_off of 50 will make a $100 invoice $50 instead.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.redeem_by" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">redeem_by</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Date after which the coupon can no longer be redeemed. Max 5 years in the future.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Coupon</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;coupons&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Coupon.times_redeemed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">times_redeemed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Number of times this coupon has been applied to a customer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.billing.Coupon-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.billing.Coupon.Meta" class="doc doc-heading">
        <code>djstripe.models.billing.Coupon.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span>.<span title="djstripe.models.base.StripeModel.Meta">Meta</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
    <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;livemode&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.billing.Coupon.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.billing.Coupon.Meta.unique_together" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;livemode&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.billing.Coupon-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Coupon.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Coupon.human_readable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">human_readable</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">human_readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">==</span> <span class="n">enums</span><span class="o">.</span><span class="n">CouponDuration</span><span class="o">.</span><span class="n">repeating</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_in_months</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;for 1 month&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration_in_months</span><span class="si">}</span><span class="s2"> months&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_amount</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Coupon.human_readable_amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Coupon</span><span class="o">.</span><span class="n">human_readable_amount</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">human_readable_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">percent_off</span><span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">percent_off</span><span class="si">}</span><span class="s2">%&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount_off</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="s2">&quot;(invalid amount)&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> off&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.Invoice" class="doc doc-heading">
        <code>djstripe.models.billing.Invoice</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.billing.BaseInvoice">BaseInvoice</span></code></p>

  
      <p>Invoices are statements of what a customer owes for a particular billing
period, including subscriptions, invoice items, and any automatic proration
adjustments if necessary.</p>
<p>Once an invoice is created, payment is automatically attempted. Note that
the payment, while automatic, does not happen exactly at the time of invoice
creation. If you have configured webhooks, the invoice will wait until one
hour after the last webhook is successfully sent (or the last webhook times
out after failing).</p>
<p>Any customer credit on the account is applied before determining how much is
due for that invoice (the amount that will be actually charged).
If the amount due for the invoice is less than 50 cents (the minimum for a
charge), we add the amount to the customer's running account balance to be
added to the next invoice. If this amount is negative, it will act as a
credit to offset the next invoice. Note that the customer account balance
does not include unpaid invoices; it only includes balances that need to be
taken into account when calculating the amount due for the next invoice.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#invoices</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Invoice</span><span class="p">(</span><span class="n">BaseInvoice</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invoices are statements of what a customer owes for a particular billing</span>
<span class="sd">    period, including subscriptions, invoice items, and any automatic proration</span>
<span class="sd">    adjustments if necessary.</span>

<span class="sd">    Once an invoice is created, payment is automatically attempted. Note that</span>
<span class="sd">    the payment, while automatic, does not happen exactly at the time of invoice</span>
<span class="sd">    creation. If you have configured webhooks, the invoice will wait until one</span>
<span class="sd">    hour after the last webhook is successfully sent (or the last webhook times</span>
<span class="sd">    out after failing).</span>

<span class="sd">    Any customer credit on the account is applied before determining how much is</span>
<span class="sd">    due for that invoice (the amount that will be actually charged).</span>
<span class="sd">    If the amount due for the invoice is less than 50 cents (the minimum for a</span>
<span class="sd">    charge), we add the amount to the customer&#39;s running account balance to be</span>
<span class="sd">    added to the next invoice. If this amount is negative, it will act as a</span>
<span class="sd">    credit to offset the next invoice. Note that the customer account balance</span>
<span class="sd">    does not include unpaid invoices; it only includes balances that need to be</span>
<span class="sd">    taken into account when calculating the amount due for the next invoice.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#invoices</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;invoices&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment source for the invoice. &quot;</span>
        <span class="s2">&quot;It must belong to the customer associated with the invoice and be &quot;</span>
        <span class="s2">&quot;in a chargeable state. If not set, defaults to the subscription&#39;s &quot;</span>
        <span class="s2">&quot;default source, if any, or to the customer&#39;s default source.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Note:</span>
    <span class="c1"># Most fields are defined on BaseInvoice so they&#39;re shared with UpcomingInvoice.</span>
    <span class="c1"># ManyToManyFields are an exception, since UpcomingInvoice doesn&#39;t exist in the db.</span>
    <span class="n">default_tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="s2">&quot;TaxRate&quot;</span><span class="p">,</span>
        <span class="c1"># explicitly specify the joining table name as though the joining model</span>
        <span class="c1"># was defined with through=&quot;DjstripeInvoiceDefaultTaxRate&quot;</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s2">&quot;djstripe_djstripeinvoicedefaulttaxrate&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The tax rates applied to this invoice, if any.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_default_tax_rates</span><span class="p">(</span>
                <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_set_total_tax_amounts</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">DjstripeInvoiceTotalTaxAmount</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.Invoice-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Invoice.default_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Invoice</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;invoices&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment source for the invoice. It must belong to the customer associated with the invoice and be in a chargeable state. If not set, defaults to the subscription&#39;s default source, if any, or to the customer&#39;s default source.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Invoice.default_tax_rates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Invoice</span><span class="o">.</span><span class="n">default_tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;TaxRate&#39;</span><span class="p">,</span> <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;djstripe_djstripeinvoicedefaulttaxrate&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The tax rates applied to this invoice, if any.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.Invoice-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Invoice._attach_objects_post_save_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Invoice</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">default_tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_default_tax_rates</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_set_total_tax_amounts</span><span class="p">(</span>
        <span class="n">target_cls</span><span class="o">=</span><span class="n">DjstripeInvoiceTotalTaxAmount</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.InvoiceItem" class="doc doc-heading">
        <code>djstripe.models.billing.InvoiceItem</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Sometimes you want to add a charge or credit to a customer but only actually
charge the customer's card at the end of a regular billing cycle.
This is useful for combining several charges to minimize per-transaction fees
or having Stripe tabulate your usage-based billing totals.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#invoiceitems</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InvoiceItem</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sometimes you want to add a charge or credit to a customer but only actually</span>
<span class="sd">    charge the customer&#39;s card at the end of a regular billing cycle.</span>
<span class="sd">    This is useful for combining several charges to minimize per-transaction fees</span>
<span class="sd">    or having Stripe tabulate your usage-based billing totals.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#invoiceitems</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">InvoiceItem</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount invoiced (as decimal).&quot;</span><span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;invoiceitems&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer associated with this invoiceitem.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The date on the invoiceitem.&quot;</span><span class="p">)</span>
    <span class="n">discountable</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If True, discounts will apply to this invoice item. &quot;</span>
        <span class="s2">&quot;Always False for prorations.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># TODO: discounts</span>
    <span class="n">invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Invoice&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;invoiceitems&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The invoice to which this invoiceitem is attached.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span>
    <span class="n">period_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Might be the date when this invoiceitem&#39;s invoice was sent.&quot;</span>
    <span class="p">)</span>
    <span class="n">period_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Might be the date when this invoiceitem was added to the invoice&quot;</span>
    <span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Plan&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the invoice item is a proration, the plan of the subscription &quot;</span>
        <span class="s2">&quot;for which the proration was computed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Price&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;invoiceitems&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the invoice item is a proration, the price of the subscription &quot;</span>
        <span class="s2">&quot;for which the proration was computed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">proration</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the invoice item was created automatically as a &quot;</span>
        <span class="s2">&quot;proration adjustment when the customer switched plans.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the invoice item is a proration, the quantity of the &quot;</span>
        <span class="s2">&quot;subscription for which the proration was computed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Subscription&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;invoiceitems&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The subscription that this invoice item has been created for, &quot;</span>
        <span class="s2">&quot;if any.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># XXX: subscription_item</span>
    <span class="n">tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="s2">&quot;TaxRate&quot;</span><span class="p">,</span>
        <span class="c1"># explicitly specify the joining table name as though the joining model</span>
        <span class="c1"># was defined with through=&quot;DjstripeInvoiceItemTaxRate&quot;</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s2">&quot;djstripe_djstripeinvoiceitemtaxrate&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The tax rates which apply to this invoice item. When set, &quot;</span>
        <span class="s2">&quot;the default_tax_rates on the invoice do not apply to this &quot;</span>
        <span class="s2">&quot;invoice item.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">unit_amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Unit amount (in the `currency` specified) of the invoice item.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">unit_amount_decimal</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Same as `unit_amount`, but contains a decimal value with &quot;</span>
            <span class="s2">&quot;at most 12 decimal places.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="c1"># only call .set() on saved instance (ie don&#39;t on items of UpcomingInvoice)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_tax_rates</span><span class="p">(</span>
                    <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_valid_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;invoiceitem&quot;</span><span class="p">,</span> <span class="s2">&quot;line_item&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoice</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;-il_&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Attempting to retrieve InvoiceItem with id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">!r}</span><span class="s2">&quot;</span>
                <span class="s2">&quot; will most likely fail. &quot;</span>
                <span class="s2">&quot;Run manage.py djstripe_update_invoiceitem_ids if this is a problem.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.InvoiceItem-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount invoiced (as decimal).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;invoiceitems&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The customer associated with this invoiceitem.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The date on the invoiceitem.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.discountable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">discountable</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If True, discounts will apply to this invoice item. Always False for prorations.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Invoice&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;invoiceitems&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The invoice to which this invoiceitem is attached.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.period" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.period_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">period_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Might be the date when this invoiceitem&#39;s invoice was sent.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.period_start" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">period_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Might be the date when this invoiceitem was added to the invoice&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.plan" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">plan</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the invoice item is a proration, the plan of the subscription for which the proration was computed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.price" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;invoiceitems&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the invoice item is a proration, the price of the subscription for which the proration was computed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.proration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">proration</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether or not the invoice item was created automatically as a proration adjustment when the customer switched plans.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.quantity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the invoice item is a proration, the quantity of the subscription for which the proration was computed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">InvoiceItem</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.subscription" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Subscription&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;invoiceitems&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The subscription that this invoice item has been created for, if any.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.tax_rates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;TaxRate&#39;</span><span class="p">,</span> <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;djstripe_djstripeinvoiceitemtaxrate&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The tax rates which apply to this invoice item. When set, the default_tax_rates on the invoice do not apply to this invoice item.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.unit_amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">unit_amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Unit amount (in the `currency` specified) of the invoice item.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.InvoiceItem.unit_amount_decimal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">unit_amount_decimal</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Same as `unit_amount`, but contains a decimal value with at most 12 decimal places.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.InvoiceItem-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.InvoiceItem.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1012</span>
<span class="normal">1013</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.InvoiceItem._attach_objects_post_save_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
        <span class="c1"># only call .set() on saved instance (ie don&#39;t on items of UpcomingInvoice)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_tax_rates</span><span class="p">(</span>
                <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.InvoiceItem._manipulate_stripe_object_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.InvoiceItem.api_retrieve" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;-il_&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Attempting to retrieve InvoiceItem with id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="s2">&quot; will most likely fail. &quot;</span>
            <span class="s2">&quot;Run manage.py djstripe_update_invoiceitem_ids if this is a problem.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.InvoiceItem.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1019</span>
<span class="normal">1020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoice</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.InvoiceItem.is_valid_object" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">InvoiceItem</span><span class="o">.</span><span class="n">is_valid_object</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_valid_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;invoiceitem&quot;</span><span class="p">,</span> <span class="s2">&quot;line_item&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.Plan" class="doc doc-heading">
        <code>djstripe.models.billing.Plan</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>A subscription plan contains the pricing information for different
products and feature levels on your site.</p>
<p>Stripe documentation: https://stripe.com/docs/api/plans?lang=python</p>
<p>NOTE: The Stripe Plans API has been deprecated in favor of the Prices API.
You may want to upgrade to use the Price model instead of the Plan model.</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Plan</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subscription plan contains the pricing information for different</span>
<span class="sd">    products and feature levels on your site.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/plans?lang=python</span>

<span class="sd">    NOTE: The Stripe Plans API has been deprecated in favor of the Prices API.</span>
<span class="sd">    You may want to upgrade to use the Price model instead of the Plan model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Plan</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;tiers&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;plans&quot;</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether the plan can be used for new purchases.&quot;</span>
    <span class="p">)</span>
    <span class="n">aggregate_usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PlanAggregateUsage</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Specifies a usage aggregation strategy for plans of usage_type=metered. &quot;</span>
            <span class="s2">&quot;Allowed values are `sum` for summing up all usage during a period, &quot;</span>
            <span class="s2">&quot;`last_during_period` for picking the last usage record reported within a &quot;</span>
            <span class="s2">&quot;period, `last_ever` for picking the last usage record ever (across period &quot;</span>
            <span class="s2">&quot;bounds) or max which picks the usage record with the maximum reported &quot;</span>
            <span class="s2">&quot;usage during a period. Defaults to `sum`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount (as decimal) to be charged on the interval specified.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">amount_decimal</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The unit amount in cents to be charged, represented as a decimal &quot;</span>
            <span class="s2">&quot;string with at most 12 decimal places.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">billing_scheme</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BillingScheme</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Describes how to compute the price per period. &quot;</span>
            <span class="s2">&quot;Either `per_unit` or `tiered`. &quot;</span>
            <span class="s2">&quot;`per_unit` indicates that the fixed amount (specified in amount) &quot;</span>
            <span class="s2">&quot;will be charged per unit in quantity &quot;</span>
            <span class="s2">&quot;(for plans with `usage_type=licensed`), or per unit of total &quot;</span>
            <span class="s2">&quot;usage (for plans with `usage_type=metered`). &quot;</span>
            <span class="s2">&quot;`tiered` indicates that the unit pricing will be computed using &quot;</span>
            <span class="s2">&quot;a tiering strategy as defined using the tiers and tiers_mode attributes.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PlanInterval</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The frequency with which a subscription should be billed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">interval_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The number of intervals (specified in the interval property) &quot;</span>
            <span class="s2">&quot;between each subscription billing.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A brief description of the plan, hidden from customers.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Product&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The product whose pricing this plan determines.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tiers</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Each element represents a pricing tier. &quot;</span>
            <span class="s2">&quot;This parameter requires `billing_scheme` to be set to `tiered`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">tiers_mode</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceTiersMode</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Defines if the tiering price should be `graduated` or `volume` based. &quot;</span>
            <span class="s2">&quot;In `volume`-based tiering, the maximum quantity within a period &quot;</span>
            <span class="s2">&quot;determines the per unit price, in `graduated` tiering pricing can &quot;</span>
            <span class="s2">&quot;successively change as the quantity grows.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">transform_usage</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Apply a transformation to the reported usage or set quantity &quot;</span>
            <span class="s2">&quot;before computing the billed price. Cannot be combined with `tiers`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">trial_period_days</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Number of trial period days granted when subscribing a customer &quot;</span>
            <span class="s2">&quot;to this plan. Null if the plan has no trial period.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">usage_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceUsageType</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceUsageType</span><span class="o">.</span><span class="n">licensed</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Configures how the quantity per period should be determined, &quot;</span>
            <span class="s2">&quot;can be either `metered` or `licensed`. `licensed` will automatically &quot;</span>
            <span class="s2">&quot;bill the `quantity` set for a plan when adding it to a subscription, &quot;</span>
            <span class="s2">&quot;`metered` will aggregate the total usage based on usage records. &quot;</span>
            <span class="s2">&quot;Defaults to `licensed`.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or create a Plan.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Plan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">Plan</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># A few minor things are changed in the api-version of the create call</span>
        <span class="n">api_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">),</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>

        <span class="n">stripe_plan</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="o">**</span><span class="n">api_kwargs</span><span class="p">)</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_plan</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">plan</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_price</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_price</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">amount_in_cents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">human_readable_price</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">billing_scheme</span> <span class="o">==</span> <span class="s2">&quot;per_unit&quot;</span><span class="p">:</span>
            <span class="n">unit_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="n">unit_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># tiered billing scheme</span>
            <span class="n">tier_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">flat_amount_tier_1</span> <span class="o">=</span> <span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;flat_amount&quot;</span><span class="p">]</span>
            <span class="n">formatted_unit_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
            <span class="p">)</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Starts at </span><span class="si">{</span><span class="n">formatted_unit_amount_tier_1</span><span class="si">}</span><span class="s2"> per unit&quot;</span>

            <span class="c1"># stripe shows flat fee even if it is set to 0.00</span>
            <span class="k">if</span> <span class="n">flat_amount_tier_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">formatted_flat_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
                    <span class="n">flat_amount_tier_1</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
                <span class="p">)</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">formatted_flat_amount_tier_1</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">format_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span>

        <span class="n">interval_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_count</span>
        <span class="k">if</span> <span class="n">interval_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">),</span>
                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;week&quot;</span><span class="p">),</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">),</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">),</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">]</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2">/</span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;days&quot;</span><span class="p">),</span>
                <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;weeks&quot;</span><span class="p">),</span>
                <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;months&quot;</span><span class="p">),</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;years&quot;</span><span class="p">),</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">]</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2"> / every </span><span class="si">{interval_count}</span><span class="s2"> </span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
            <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval_count</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">format_lazy</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">format_args</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.Plan-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.active" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the plan can be used for new purchases.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.aggregate_usage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">aggregate_usage</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PlanAggregateUsage</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Specifies a usage aggregation strategy for plans of usage_type=metered. Allowed values are `sum` for summing up all usage during a period, `last_during_period` for picking the last usage record reported within a period, `last_ever` for picking the last usage record ever (across period bounds) or max which picks the usage record with the maximum reported usage during a period. Defaults to `sum`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount (as decimal) to be charged on the interval specified.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.amount_decimal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">amount_decimal</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The unit amount in cents to be charged, represented as a decimal string with at most 12 decimal places.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.billing_scheme" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">billing_scheme</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BillingScheme</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Describes how to compute the price per period. Either `per_unit` or `tiered`. `per_unit` indicates that the fixed amount (specified in amount) will be charged per unit in quantity (for plans with `usage_type=licensed`), or per unit of total usage (for plans with `usage_type=metered`). `tiered` indicates that the unit pricing will be computed using a tiering strategy as defined using the tiers and tiers_mode attributes.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;tiers&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.interval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PlanInterval</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The frequency with which a subscription should be billed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.interval_count" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">interval_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The number of intervals (specified in the interval property) between each subscription billing.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.nickname" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A brief description of the plan, hidden from customers.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.product" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The product whose pricing this plan determines.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Plan</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;plans&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.tiers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">tiers</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Each element represents a pricing tier. This parameter requires `billing_scheme` to be set to `tiered`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.tiers_mode" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">tiers_mode</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceTiersMode</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Defines if the tiering price should be `graduated` or `volume` based. In `volume`-based tiering, the maximum quantity within a period determines the per unit price, in `graduated` tiering pricing can successively change as the quantity grows.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.transform_usage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">transform_usage</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Apply a transformation to the reported usage or set quantity before computing the billed price. Cannot be combined with `tiers`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.trial_period_days" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">trial_period_days</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Number of trial period days granted when subscribing a customer to this plan. Null if the plan has no trial period.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Plan.usage_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">usage_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceUsageType</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">PriceUsageType</span><span class="o">.</span><span class="n">licensed</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Configures how the quantity per period should be determined, can be either `metered` or `licensed`. `licensed` will automatically bill the `quantity` set for a plan when adding it to a subscription, `metered` will aggregate the total usage based on usage records. Defaults to `licensed`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.billing.Plan-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.billing.Plan.Meta" class="doc doc-heading">
        <code>djstripe.models.billing.Plan.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1167</span>
<span class="normal">1168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.billing.Plan.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.billing.Plan.Meta.ordering" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.billing.Plan-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Plan.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">human_readable_price</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_price</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Plan.amount_in_cents" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">amount_in_cents</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">amount_in_cents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Plan.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># A few minor things are changed in the api-version of the create call</span>
    <span class="n">api_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">),</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>

    <span class="n">stripe_plan</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="o">**</span><span class="n">api_kwargs</span><span class="p">)</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_plan</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plan</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Plan.get_or_create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get or create a Plan.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_or_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get or create a Plan.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Plan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">Plan</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Plan.human_readable_price" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Plan</span><span class="o">.</span><span class="n">human_readable_price</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">human_readable_price</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">billing_scheme</span> <span class="o">==</span> <span class="s2">&quot;per_unit&quot;</span><span class="p">:</span>
        <span class="n">unit_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="n">unit_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># tiered billing scheme</span>
        <span class="n">tier_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">flat_amount_tier_1</span> <span class="o">=</span> <span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;flat_amount&quot;</span><span class="p">]</span>
        <span class="n">formatted_unit_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
            <span class="p">(</span><span class="n">tier_1</span><span class="p">[</span><span class="s2">&quot;unit_amount&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
        <span class="p">)</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Starts at </span><span class="si">{</span><span class="n">formatted_unit_amount_tier_1</span><span class="si">}</span><span class="s2"> per unit&quot;</span>

        <span class="c1"># stripe shows flat fee even if it is set to 0.00</span>
        <span class="k">if</span> <span class="n">flat_amount_tier_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">formatted_flat_amount_tier_1</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
                <span class="n">flat_amount_tier_1</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span>
            <span class="p">)</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">formatted_flat_amount_tier_1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">format_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span>

    <span class="n">interval_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_count</span>
    <span class="k">if</span> <span class="n">interval_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">),</span>
            <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;week&quot;</span><span class="p">),</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">),</span>
            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">),</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">]</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2">/</span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;days&quot;</span><span class="p">),</span>
            <span class="s2">&quot;week&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;weeks&quot;</span><span class="p">),</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;months&quot;</span><span class="p">),</span>
            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;years&quot;</span><span class="p">),</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">interval</span><span class="p">]</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{amount}</span><span class="s2"> / every </span><span class="si">{interval_count}</span><span class="s2"> </span><span class="si">{interval}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="n">format_args</span><span class="p">[</span><span class="s2">&quot;interval_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval_count</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">format_lazy</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">format_args</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.ShippingRate" class="doc doc-heading">
        <code>djstripe.models.billing.ShippingRate</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Shipping rates describe the price of shipping presented
to your customers and can be applied to Checkout Sessions
to collect shipping costs.</p>
<p>Stripe documentation: https://stripe.com/docs/api/shipping_rates</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ShippingRate</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shipping rates describe the price of shipping presented</span>
<span class="sd">    to your customers and can be applied to Checkout Sessions</span>
<span class="sd">    to collect shipping costs.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/shipping_rates</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">ShippingRate</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;shipping-rates&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether the shipping rate can be used for new purchases. Defaults to true&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The name of the shipping rate, meant to be displayable to the customer. This will appear on CheckoutSessions.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fixed_amount</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Describes a fixed amount to charge for shipping. Must be present if type is fixed_amount&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ShippingRateType</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ShippingRateType</span><span class="o">.</span><span class="n">fixed_amount</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;The type of calculation to use on the shipping rate. Can only be fixed_amount for now.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">delivery_estimate</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The estimated range for how long shipping will take, meant to be displayable to the customer. This will appear on CheckoutSessions.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tax_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ShippingRateTaxBehavior</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;Specifies whether the rate is considered inclusive of taxes or exclusive of taxes.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">tax_code</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;TaxCode&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The shipping tax code&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Shipping Rate&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixed_amount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_amount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currency&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (Active)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (Archived)&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.ShippingRate-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.active" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the shipping rate can be used for new purchases. Defaults to true&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.delivery_estimate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">delivery_estimate</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The estimated range for how long shipping will take, meant to be displayable to the customer. This will appear on CheckoutSessions.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.display_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The name of the shipping rate, meant to be displayable to the customer. This will appear on CheckoutSessions.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.fixed_amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">fixed_amount</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Describes a fixed amount to charge for shipping. Must be present if type is fixed_amount&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">ShippingRate</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;shipping-rates&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.tax_behavior" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">tax_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ShippingRateTaxBehavior</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Specifies whether the rate is considered inclusive of taxes or exclusive of taxes.&#39;</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.tax_code" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">tax_code</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;TaxCode&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The shipping tax code&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.ShippingRate.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ShippingRateType</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ShippingRateType</span><span class="o">.</span><span class="n">fixed_amount</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;The type of calculation to use on the shipping rate. Can only be fixed_amount for now.&#39;</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.billing.ShippingRate-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.billing.ShippingRate.Meta" class="doc doc-heading">
        <code>djstripe.models.billing.ShippingRate.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span>.<span title="djstripe.models.base.StripeModel.Meta">Meta</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1996</span>
<span class="normal">1997</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Shipping Rate&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.billing.ShippingRate.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.billing.ShippingRate.Meta.verbose_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Shipping Rate&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.billing.ShippingRate-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.ShippingRate.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">ShippingRate</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_amount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amount&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_amount</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currency&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (Active)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> (Archived)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.Subscription" class="doc doc-heading">
        <code>djstripe.models.billing.Subscription</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Subscriptions allow you to charge a customer's card on a recurring basis.
A subscription ties a customer to a particular plan you've created.</p>
<p>A subscription still in its trial period is <code>trialing</code> and moves to <code>active</code>
when the trial period is over.</p>
<p>When payment to renew the subscription fails, the subscription becomes <code>past_due</code>.
After Stripe has exhausted all payment retry attempts, the subscription ends up
with a status of either <code>canceled</code> or <code>unpaid</code> depending on your retry settings.</p>
<p>Note that when a subscription has a status of <code>unpaid</code>, no subsequent invoices
will be attempted (invoices will be created, but then immediately
automatically closed.</p>
<p>Additionally, updating customer card details will not lead to Stripe retrying the
latest invoice.).
After receiving updated card details from a customer, you may choose to reopen and
pay their closed invoices.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#subscriptions</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Subscription</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subscriptions allow you to charge a customer&#39;s card on a recurring basis.</span>
<span class="sd">    A subscription ties a customer to a particular plan you&#39;ve created.</span>

<span class="sd">    A subscription still in its trial period is ``trialing`` and moves to ``active``</span>
<span class="sd">    when the trial period is over.</span>

<span class="sd">    When payment to renew the subscription fails, the subscription becomes ``past_due``.</span>
<span class="sd">    After Stripe has exhausted all payment retry attempts, the subscription ends up</span>
<span class="sd">    with a status of either ``canceled`` or ``unpaid`` depending on your retry settings.</span>

<span class="sd">    Note that when a subscription has a status of ``unpaid``, no subsequent invoices</span>
<span class="sd">    will be attempted (invoices will be created, but then immediately</span>
<span class="sd">    automatically closed.</span>

<span class="sd">    Additionally, updating customer card details will not lead to Stripe retrying the</span>
<span class="sd">    latest invoice.).</span>
<span class="sd">    After receiving updated card details from a customer, you may choose to reopen and</span>
<span class="sd">    pay their closed invoices.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#subscriptions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Subscription</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;subscriptions&quot;</span>

    <span class="n">application_fee_percent</span> <span class="o">=</span> <span class="n">StripePercentField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A positive decimal that represents the fee percentage of the &quot;</span>
        <span class="s2">&quot;subscription invoice amount that will be transferred to the application &quot;</span>
        <span class="s2">&quot;owner&#39;s Stripe account each billing period.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">billing_cycle_anchor</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Determines the date of the first full invoice, and, for plans &quot;</span>
            <span class="s2">&quot;with `month` or `year` intervals, the day of the month for subsequent &quot;</span>
            <span class="s2">&quot;invoices.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">billing_thresholds</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Define thresholds at which an invoice will be sent, and the &quot;</span>
        <span class="s2">&quot;subscription advanced to a new billing period.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cancel_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A date in the future at which the subscription will automatically &quot;</span>
        <span class="s2">&quot;get canceled.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cancel_at_period_end</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the subscription has been canceled with the ``at_period_end`` &quot;</span>
        <span class="s2">&quot;flag set to true, ``cancel_at_period_end`` on the subscription will be true. &quot;</span>
        <span class="s2">&quot;You can use this attribute to determine whether a subscription that has a &quot;</span>
        <span class="s2">&quot;status of active is scheduled to be canceled at the end of the &quot;</span>
        <span class="s2">&quot;current period.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">canceled_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the subscription has been canceled, the date of that &quot;</span>
        <span class="s2">&quot;cancellation. If the subscription was canceled with ``cancel_at_period_end``, &quot;</span>
        <span class="s2">&quot;canceled_at will still reflect the date of the initial cancellation request, &quot;</span>
        <span class="s2">&quot;not the end of the subscription period when the subscription is automatically &quot;</span>
        <span class="s2">&quot;moved to a canceled state.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">collection_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">InvoiceCollectionMethod</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Either `charge_automatically`, or `send_invoice`. When charging &quot;</span>
        <span class="s2">&quot;automatically, Stripe will attempt to pay this subscription at the end of the &quot;</span>
        <span class="s2">&quot;cycle using the default source attached to the customer. &quot;</span>
        <span class="s2">&quot;When sending an invoice, Stripe will email your customer an invoice with &quot;</span>
        <span class="s2">&quot;payment instructions.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">current_period_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;End of the current period for which the subscription has been &quot;</span>
        <span class="s2">&quot;invoiced. At the end of this period, a new invoice will be created.&quot;</span>
    <span class="p">)</span>
    <span class="n">current_period_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Start of the current period for which the subscription has &quot;</span>
        <span class="s2">&quot;been invoiced.&quot;</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscriptions&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer associated with this subscription.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">days_until_due</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Number of days a customer has to pay invoices generated by this &quot;</span>
        <span class="s2">&quot;subscription. This value will be `null` for subscriptions where &quot;</span>
        <span class="s2">&quot;`billing=charge_automatically`.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentMethod&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment method for the subscription. &quot;</span>
        <span class="s2">&quot;It must belong to the customer associated with the subscription. &quot;</span>
        <span class="s2">&quot;If not set, invoices will use the default payment method in the &quot;</span>
        <span class="s2">&quot;customer&#39;s invoice settings.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscriptions&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment source for the subscription. &quot;</span>
        <span class="s2">&quot;It must belong to the customer associated with the subscription &quot;</span>
        <span class="s2">&quot;and be in a chargeable state. If not set, defaults to the customer&#39;s &quot;</span>
        <span class="s2">&quot;default source.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="s2">&quot;TaxRate&quot;</span><span class="p">,</span>
        <span class="c1"># explicitly specify the joining table name as though the joining model</span>
        <span class="c1"># was defined with through=&quot;DjstripeSubscriptionDefaultTaxRate&quot;</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s2">&quot;djstripe_djstripesubscriptiondefaulttaxrate&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The tax rates that will apply to any subscription item &quot;</span>
        <span class="s2">&quot;that does not have tax_rates set. Invoices created will have their &quot;</span>
        <span class="s2">&quot;default_tax_rates populated from the subscription.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">discount</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Describes the current discount applied to this subscription, if there is one. When billing, a discount applied to a subscription overrides a discount applied on a customer-wide basis.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ended_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the subscription has ended (either because it was canceled or &quot;</span>
        <span class="s2">&quot;because the customer was switched to a subscription to a new plan), &quot;</span>
        <span class="s2">&quot;the date the subscription ended.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">latest_invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Invoice&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The most recent invoice this subscription has generated.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">next_pending_invoice_item_invoice</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Specifies the approximate timestamp on which any pending &quot;</span>
        <span class="s2">&quot;invoice items will be billed according to the schedule provided at &quot;</span>
        <span class="s2">&quot;pending_invoice_item_interval.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pause_collection</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If specified, payment collection for this subscription will be paused.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pending_invoice_item_interval</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Specifies an interval for how often to bill for any &quot;</span>
        <span class="s2">&quot;pending invoice items. It is analogous to calling Create an invoice &quot;</span>
        <span class="s2">&quot;for the given subscription at the specified interval.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pending_setup_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;SetupIntent&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;setup_intents&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;We can use this SetupIntent to collect user authentication &quot;</span>
        <span class="s2">&quot;when creating a subscription without immediate payment or updating a &quot;</span>
        <span class="s2">&quot;subscription&#39;s payment method, allowing you to &quot;</span>
        <span class="s2">&quot;optimize for off-session payments.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">pending_update</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If specified, pending updates that will be applied to the &quot;</span>
        <span class="s2">&quot;subscription once the latest_invoice has been paid.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Plan&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscriptions&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The plan associated with this subscription. This value will be &quot;</span>
        <span class="s2">&quot;`null` for multi-plan subscriptions&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">proration_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="o">.</span><span class="n">create_prorations</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">proration_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The quantity applied to this subscription. This value will be &quot;</span>
        <span class="s2">&quot;`null` for multi-plan subscriptions&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">schedule</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;SubscriptionSchedule&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscriptions&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The schedule associated with this subscription.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Date when the subscription was first created. The date &quot;</span>
        <span class="s2">&quot;might differ from the created date due to backdating.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of this subscription.&quot;</span>
    <span class="p">)</span>
    <span class="n">trial_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the subscription has a trial, the end of that trial.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">trial_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the subscription has a trial, the beginning of that trial.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">SubscriptionManager</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">subscriptions_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">_get_valid_subscriptions</span><span class="p">()</span>
        <span class="n">products_lst</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">subscription</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">subscription</span> <span class="ow">in</span> <span class="n">subscriptions_lst</span>
            <span class="k">if</span> <span class="n">subscription</span> <span class="ow">and</span> <span class="n">subscription</span><span class="o">.</span><span class="n">plan</span> <span class="ow">and</span> <span class="n">subscription</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">product</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">products_lst</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">        :returns: an iterator over all items in the query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">):</span>
            <span class="c1"># special case: https://stripe.com/docs/api/subscriptions/list#list_subscriptions-status</span>
            <span class="c1"># See Issue: https://github.com/dj-stripe/dj-stripe/issues/1763</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plan</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">StripeModel</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See `Customer.subscribe() &lt;#djstripe.models.Customer.subscribe&gt;`__</span>

<span class="sd">        :param plan: The plan to which to subscribe the customer.</span>
<span class="sd">        :type plan: Plan or string (plan ID)</span>

<span class="sd">        .. important:: Updating a subscription by changing the plan or quantity \</span>
<span class="sd">            creates a new ``Subscription`` in \</span>
<span class="sd">            Stripe (and dj-stripe).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Convert Plan to id</span>
        <span class="k">if</span> <span class="n">plan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
            <span class="n">plan</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">id</span>

        <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_update</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extends this subscription by the provided delta.</span>

<span class="sd">        :param delta: The timedelta by which to extend this subscription.</span>
<span class="sd">        :type delta: timedelta</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delta must be a positive timedelta.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
            <span class="n">period_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">period_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_period_end</span>

        <span class="n">period_end</span> <span class="o">+=</span> <span class="n">delta</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">proration_behavior</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">trial_end</span><span class="o">=</span><span class="n">period_end</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at_period_end</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels this subscription. If you set the at_period_end parameter to true,</span>
<span class="sd">        the subscription will remain active until the end of the period, at which point</span>
<span class="sd">        it will be canceled and not renewed. By default, the subscription is terminated</span>
<span class="sd">        immediately. In either case, the customer will not be charged again for</span>
<span class="sd">        the subscription. Note, however, that any pending invoice items or metered</span>
<span class="sd">        usage will still be charged at the end of the period unless manually</span>
<span class="sd">        deleted.</span>

<span class="sd">        Depending on how `proration_behavior` is set, any pending prorations will</span>
<span class="sd">        also be left in place and collected at the end of the period.</span>
<span class="sd">        However, if the subscription is set to cancel immediately, you can pass the</span>
<span class="sd">        `prorate` and `invoice_now` flags in `kwargs` to configure how the pending</span>
<span class="sd">        metered usage is invoiced and how proration must work.</span>

<span class="sd">        By default, all unpaid invoices for the customer will be closed upon</span>
<span class="sd">        subscription cancellation. We do this in order to prevent unexpected payment</span>
<span class="sd">        retries once the customer has canceled a subscription. However, you can</span>
<span class="sd">        reopen the invoices manually after subscription cancellation to have us proceed</span>
<span class="sd">        with automatic retries, or you could even re-attempt payment yourself on all</span>
<span class="sd">        unpaid invoices before allowing the customer to cancel the</span>
<span class="sd">        subscription at all.</span>

<span class="sd">        :param at_period_end: A flag that if set to true will delay the cancellation \</span>
<span class="sd">            of the subscription until the end of the current period. Default is False.</span>
<span class="sd">        :type at_period_end: boolean</span>

<span class="sd">        .. important:: If a subscription is canceled during a trial period, \</span>
<span class="sd">        the ``at_period_end`` flag will be overridden to False so that the trial ends \</span>
<span class="sd">        immediately and the customer&#39;s card isn&#39;t charged.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If plan has trial days and customer cancels before</span>
        <span class="c1"># trial period ends, then end subscription now,</span>
        <span class="c1"># i.e. at_period_end=False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
            <span class="n">at_period_end</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">at_period_end</span><span class="p">:</span>
            <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_update</span><span class="p">(</span><span class="n">cancel_at_period_end</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_delete</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;No such subscription:&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                    <span class="c1"># cancel() works by deleting the subscription. The object still</span>
                    <span class="c1"># exists in Stripe however, and can still be retrieved.</span>
                    <span class="c1"># If the subscription was already canceled (status=canceled),</span>
                    <span class="c1"># that api_retrieve() call will fail with &quot;No such subscription&quot;.</span>
                    <span class="c1"># However, this may also happen if the subscription legitimately</span>
                    <span class="c1"># does not exist, in which case the following line will re-raise.</span>
                    <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

        <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
            <span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">reactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reactivates this subscription.</span>

<span class="sd">        If a customer&#39;s subscription is canceled with ``at_period_end`` set to True and</span>
<span class="sd">        it has not yet reached the end of the billing period, it can be reactivated.</span>
<span class="sd">        Subscriptions canceled immediately cannot be reactivated.</span>
<span class="sd">        (Source: https://stripe.com/docs/billing/subscriptions/cancel)</span>

<span class="sd">        .. warning:: Reactivating a fully canceled Subscription will fail silently. \</span>
<span class="sd">        Be sure to check the returned Subscription&#39;s status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
        <span class="n">stripe_subscription</span><span class="o">.</span><span class="n">plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span>
        <span class="n">stripe_subscription</span><span class="o">.</span><span class="n">cancel_at_period_end</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="o">.</span><span class="n">save</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">is_period_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if this subscription&#39;s period is current, false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_period_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_status_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if this subscription&#39;s status is current (active or trialing),</span>
<span class="sd">        false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;trialing&quot;</span><span class="p">,</span> <span class="s2">&quot;active&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">is_status_temporarily_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A status is temporarily current when the subscription is canceled with the</span>
<span class="sd">        ``at_period_end`` flag.</span>
<span class="sd">        The subscription is still active, but is technically canceled and we&#39;re just</span>
<span class="sd">        waiting for it to run out.</span>

<span class="sd">        You could use this method to give customers limited service after they&#39;ve</span>
<span class="sd">        canceled. For example, a video on demand service could only allow customers</span>
<span class="sd">        to download their libraries and do nothing else when their</span>
<span class="sd">        subscription is temporarily current.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canceled_at</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_at_period_end</span>
            <span class="ow">and</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_period_end</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if this subscription&#39;s status and period are current,</span>
<span class="sd">        false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_status_current</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_period_current</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
        <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_subscription_items</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">SubscriptionItem</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">subscription</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_default_tax_rates</span><span class="p">(</span>
                <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.Subscription-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.application_fee_percent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">application_fee_percent</span> <span class="o">=</span> <span class="n">StripePercentField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A positive decimal that represents the fee percentage of the subscription invoice amount that will be transferred to the application owner&#39;s Stripe account each billing period.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.billing_cycle_anchor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">billing_cycle_anchor</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Determines the date of the first full invoice, and, for plans with `month` or `year` intervals, the day of the month for subsequent invoices.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.billing_thresholds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">billing_thresholds</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Define thresholds at which an invoice will be sent, and the subscription advanced to a new billing period.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.cancel_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">cancel_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A date in the future at which the subscription will automatically get canceled.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.cancel_at_period_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">cancel_at_period_end</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the subscription has been canceled with the ``at_period_end`` flag set to true, ``cancel_at_period_end`` on the subscription will be true. You can use this attribute to determine whether a subscription that has a status of active is scheduled to be canceled at the end of the current period.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.canceled_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">canceled_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the subscription has been canceled, the date of that cancellation. If the subscription was canceled with ``cancel_at_period_end``, canceled_at will still reflect the date of the initial cancellation request, not the end of the subscription period when the subscription is automatically moved to a canceled state.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.collection_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">collection_method</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">InvoiceCollectionMethod</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Either `charge_automatically`, or `send_invoice`. When charging automatically, Stripe will attempt to pay this subscription at the end of the cycle using the default source attached to the customer. When sending an invoice, Stripe will email your customer an invoice with payment instructions.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.current_period_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">current_period_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;End of the current period for which the subscription has been invoiced. At the end of this period, a new invoice will be created.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.current_period_start" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">current_period_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Start of the current period for which the subscription has been invoiced.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The customer associated with this subscription.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.days_until_due" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">days_until_due</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Number of days a customer has to pay invoices generated by this subscription. This value will be `null` for subscriptions where `billing=charge_automatically`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.default_payment_method" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">default_payment_method</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentMethod&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment method for the subscription. It must belong to the customer associated with the subscription. If not set, invoices will use the default payment method in the customer&#39;s invoice settings.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.default_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment source for the subscription. It must belong to the customer associated with the subscription and be in a chargeable state. If not set, defaults to the customer&#39;s default source.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.default_tax_rates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">default_tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;TaxRate&#39;</span><span class="p">,</span> <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;djstripe_djstripesubscriptiondefaulttaxrate&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The tax rates that will apply to any subscription item that does not have tax_rates set. Invoices created will have their default_tax_rates populated from the subscription.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.discount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">discount</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Describes the current discount applied to this subscription, if there is one. When billing, a discount applied to a subscription overrides a discount applied on a customer-wide basis.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.ended_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">ended_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the subscription has ended (either because it was canceled or because the customer was switched to a subscription to a new plan), the date the subscription ended.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.latest_invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">latest_invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Invoice&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The most recent invoice this subscription has generated.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.next_pending_invoice_item_invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">next_pending_invoice_item_invoice</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Specifies the approximate timestamp on which any pending invoice items will be billed according to the schedule provided at pending_invoice_item_interval.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.objects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">SubscriptionManager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.pause_collection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">pause_collection</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If specified, payment collection for this subscription will be paused.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.pending_invoice_item_interval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">pending_invoice_item_interval</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Specifies an interval for how often to bill for any pending invoice items. It is analogous to calling Create an invoice for the given subscription at the specified interval.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.pending_setup_intent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">pending_setup_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;SetupIntent&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;setup_intents&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;We can use this SetupIntent to collect user authentication when creating a subscription without immediate payment or updating a subscription&#39;s payment method, allowing you to optimize for off-session payments.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.pending_update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">pending_update</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If specified, pending updates that will be applied to the subscription once the latest_invoice has been paid.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.plan" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">plan</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The plan associated with this subscription. This value will be `null` for multi-plan subscriptions&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.proration_behavior" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">proration_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="o">.</span><span class="n">create_prorations</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.proration_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">proration_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.quantity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The quantity applied to this subscription. This value will be `null` for multi-plan subscriptions&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.schedule" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;SubscriptionSchedule&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The schedule associated with this subscription.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.start_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Date when the subscription was first created. The date might differ from the created date due to backdating.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of this subscription.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Subscription</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;subscriptions&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.trial_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the subscription has a trial, the end of that trial.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.Subscription.trial_start" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">trial_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the subscription has a trial, the beginning of that trial.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.Subscription-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">subscriptions_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">_get_valid_subscriptions</span><span class="p">()</span>
    <span class="n">products_lst</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">subscription</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">subscription</span> <span class="ow">in</span> <span class="n">subscriptions_lst</span>
        <span class="k">if</span> <span class="n">subscription</span> <span class="ow">and</span> <span class="n">subscription</span><span class="o">.</span><span class="n">plan</span> <span class="ow">and</span> <span class="n">subscription</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">product</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">products_lst</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription._attach_objects_post_save_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
    <span class="p">)</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_subscription_items</span><span class="p">(</span>
        <span class="n">target_cls</span><span class="o">=</span><span class="n">SubscriptionItem</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">subscription</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">default_tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_default_tax_rates</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.api_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's list operation for this model.
:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
See Stripe documentation for accepted kwargs for each object.
:returns: an iterator over all items in the query</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">    :returns: an iterator over all items in the query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">):</span>
        <span class="c1"># special case: https://stripe.com/docs/api/subscriptions/list#list_subscriptions-status</span>
        <span class="c1"># See Issue: https://github.com/dj-stripe/dj-stripe/issues/1763</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.cancel" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">at_period_end</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Cancels this subscription. If you set the at_period_end parameter to true,
the subscription will remain active until the end of the period, at which point
it will be canceled and not renewed. By default, the subscription is terminated
immediately. In either case, the customer will not be charged again for
the subscription. Note, however, that any pending invoice items or metered
usage will still be charged at the end of the period unless manually
deleted.</p>
<p>Depending on how <code>proration_behavior</code> is set, any pending prorations will
also be left in place and collected at the end of the period.
However, if the subscription is set to cancel immediately, you can pass the
<code>prorate</code> and <code>invoice_now</code> flags in <code>kwargs</code> to configure how the pending
metered usage is invoiced and how proration must work.</p>
<p>By default, all unpaid invoices for the customer will be closed upon
subscription cancellation. We do this in order to prevent unexpected payment
retries once the customer has canceled a subscription. However, you can
reopen the invoices manually after subscription cancellation to have us proceed
with automatic retries, or you could even re-attempt payment yourself on all
unpaid invoices before allowing the customer to cancel the
subscription at all.</p>
<p>:param at_period_end: A flag that if set to true will delay the cancellation             of the subscription until the end of the current period. Default is False.
:type at_period_end: boolean</p>
<p>.. important:: If a subscription is canceled during a trial period,         the <code>at_period_end</code> flag will be overridden to False so that the trial ends         immediately and the customer's card isn't charged.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at_period_end</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cancels this subscription. If you set the at_period_end parameter to true,</span>
<span class="sd">    the subscription will remain active until the end of the period, at which point</span>
<span class="sd">    it will be canceled and not renewed. By default, the subscription is terminated</span>
<span class="sd">    immediately. In either case, the customer will not be charged again for</span>
<span class="sd">    the subscription. Note, however, that any pending invoice items or metered</span>
<span class="sd">    usage will still be charged at the end of the period unless manually</span>
<span class="sd">    deleted.</span>

<span class="sd">    Depending on how `proration_behavior` is set, any pending prorations will</span>
<span class="sd">    also be left in place and collected at the end of the period.</span>
<span class="sd">    However, if the subscription is set to cancel immediately, you can pass the</span>
<span class="sd">    `prorate` and `invoice_now` flags in `kwargs` to configure how the pending</span>
<span class="sd">    metered usage is invoiced and how proration must work.</span>

<span class="sd">    By default, all unpaid invoices for the customer will be closed upon</span>
<span class="sd">    subscription cancellation. We do this in order to prevent unexpected payment</span>
<span class="sd">    retries once the customer has canceled a subscription. However, you can</span>
<span class="sd">    reopen the invoices manually after subscription cancellation to have us proceed</span>
<span class="sd">    with automatic retries, or you could even re-attempt payment yourself on all</span>
<span class="sd">    unpaid invoices before allowing the customer to cancel the</span>
<span class="sd">    subscription at all.</span>

<span class="sd">    :param at_period_end: A flag that if set to true will delay the cancellation \</span>
<span class="sd">        of the subscription until the end of the current period. Default is False.</span>
<span class="sd">    :type at_period_end: boolean</span>

<span class="sd">    .. important:: If a subscription is canceled during a trial period, \</span>
<span class="sd">    the ``at_period_end`` flag will be overridden to False so that the trial ends \</span>
<span class="sd">    immediately and the customer&#39;s card isn&#39;t charged.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If plan has trial days and customer cancels before</span>
    <span class="c1"># trial period ends, then end subscription now,</span>
    <span class="c1"># i.e. at_period_end=False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
        <span class="n">at_period_end</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">at_period_end</span><span class="p">:</span>
        <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_update</span><span class="p">(</span><span class="n">cancel_at_period_end</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_delete</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;No such subscription:&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
                <span class="c1"># cancel() works by deleting the subscription. The object still</span>
                <span class="c1"># exists in Stripe however, and can still be retrieved.</span>
                <span class="c1"># If the subscription was already canceled (status=canceled),</span>
                <span class="c1"># that api_retrieve() call will fail with &quot;No such subscription&quot;.</span>
                <span class="c1"># However, this may also happen if the subscription legitimately</span>
                <span class="c1"># does not exist, in which case the following line will re-raise.</span>
                <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
        <span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.extend" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Extends this subscription by the provided delta.</p>
<p>:param delta: The timedelta by which to extend this subscription.
:type delta: timedelta</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extends this subscription by the provided delta.</span>

<span class="sd">    :param delta: The timedelta by which to extend this subscription.</span>
<span class="sd">    :type delta: timedelta</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;delta must be a positive timedelta.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
        <span class="n">period_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">period_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_period_end</span>

    <span class="n">period_end</span> <span class="o">+=</span> <span class="n">delta</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">proration_behavior</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">trial_end</span><span class="o">=</span><span class="n">period_end</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.is_period_current" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">is_period_current</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns True if this subscription's period is current, false otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_period_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if this subscription&#39;s period is current, false otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_period_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_end</span> <span class="o">&gt;</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.is_status_current" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">is_status_current</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns True if this subscription's status is current (active or trialing),
false otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_status_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if this subscription&#39;s status is current (active or trialing),</span>
<span class="sd">    false otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;trialing&quot;</span><span class="p">,</span> <span class="s2">&quot;active&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.is_status_temporarily_current" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">is_status_temporarily_current</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>A status is temporarily current when the subscription is canceled with the
<code>at_period_end</code> flag.
The subscription is still active, but is technically canceled and we're just
waiting for it to run out.</p>
<p>You could use this method to give customers limited service after they've
canceled. For example, a video on demand service could only allow customers
to download their libraries and do nothing else when their
subscription is temporarily current.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_status_temporarily_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A status is temporarily current when the subscription is canceled with the</span>
<span class="sd">    ``at_period_end`` flag.</span>
<span class="sd">    The subscription is still active, but is technically canceled and we&#39;re just</span>
<span class="sd">    waiting for it to run out.</span>

<span class="sd">    You could use this method to give customers limited service after they&#39;ve</span>
<span class="sd">    canceled. For example, a video on demand service could only allow customers</span>
<span class="sd">    to download their libraries and do nothing else when their</span>
<span class="sd">    subscription is temporarily current.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canceled_at</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_at_period_end</span>
        <span class="ow">and</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_period_end</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.is_valid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns True if this subscription's status and period are current,
false otherwise.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if this subscription&#39;s status and period are current,</span>
<span class="sd">    false otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_status_current</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_period_current</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.reactivate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">reactivate</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Reactivates this subscription.</p>
<p>If a customer's subscription is canceled with <code>at_period_end</code> set to True and
it has not yet reached the end of the billing period, it can be reactivated.
Subscriptions canceled immediately cannot be reactivated.
(Source: https://stripe.com/docs/billing/subscriptions/cancel)</p>
<p>.. warning:: Reactivating a fully canceled Subscription will fail silently.         Be sure to check the returned Subscription's status.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reactivates this subscription.</span>

<span class="sd">    If a customer&#39;s subscription is canceled with ``at_period_end`` set to True and</span>
<span class="sd">    it has not yet reached the end of the billing period, it can be reactivated.</span>
<span class="sd">    Subscriptions canceled immediately cannot be reactivated.</span>
<span class="sd">    (Source: https://stripe.com/docs/billing/subscriptions/cancel)</span>

<span class="sd">    .. warning:: Reactivating a fully canceled Subscription will fail silently. \</span>
<span class="sd">    Be sure to check the returned Subscription&#39;s status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">()</span>
    <span class="n">stripe_subscription</span><span class="o">.</span><span class="n">plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">id</span>
    <span class="n">stripe_subscription</span><span class="o">.</span><span class="n">cancel_at_period_end</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="o">.</span><span class="n">save</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.Subscription.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>See <code>Customer.subscribe() &lt;#djstripe.models.Customer.subscribe&gt;</code>__</p>
<p>:param plan: The plan to which to subscribe the customer.
:type plan: Plan or string (plan ID)</p>
<p>.. important:: Updating a subscription by changing the plan or quantity             creates a new <code>Subscription</code> in             Stripe (and dj-stripe).</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plan</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">StripeModel</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Customer.subscribe() &lt;#djstripe.models.Customer.subscribe&gt;`__</span>

<span class="sd">    :param plan: The plan to which to subscribe the customer.</span>
<span class="sd">    :type plan: Plan or string (plan ID)</span>

<span class="sd">    .. important:: Updating a subscription by changing the plan or quantity \</span>
<span class="sd">        creates a new ``Subscription`` in \</span>
<span class="sd">        Stripe (and dj-stripe).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert Plan to id</span>
    <span class="k">if</span> <span class="n">plan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="n">StripeModel</span><span class="p">):</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">id</span>

    <span class="n">stripe_subscription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_update</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="k">return</span> <span class="n">Subscription</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.SubscriptionItem" class="doc doc-heading">
        <code>djstripe.models.billing.SubscriptionItem</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Subscription items allow you to create customer subscriptions
with more than one plan, making it easy to represent complex billing relationships.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#subscription_items</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SubscriptionItem</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subscription items allow you to create customer subscriptions</span>
<span class="sd">    with more than one plan, making it easy to represent complex billing relationships.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#subscription_items</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionItem</span>

    <span class="n">billing_thresholds</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Define thresholds at which an invoice will be sent, and the &quot;</span>
        <span class="s2">&quot;related subscription advanced to a new billing period.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Plan&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscription_items&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The plan the customer is subscribed to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Price&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscription_items&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The price the customer is subscribed to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">proration_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="o">.</span><span class="n">create_prorations</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">proration_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The quantity of the plan to which the customer should be subscribed.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Subscription&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;items&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The subscription this subscription item belongs to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="s2">&quot;TaxRate&quot;</span><span class="p">,</span>
        <span class="c1"># explicitly specify the joining table name as though the joining model</span>
        <span class="c1"># was defined with through=&quot;DjstripeSubscriptionItemTaxRate&quot;</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s2">&quot;djstripe_djstripesubscriptionitemtaxrate&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The tax rates which apply to this subscription_item. When set, &quot;</span>
        <span class="s2">&quot;the default_tax_rates on the subscription do not apply to this &quot;</span>
        <span class="s2">&quot;subscription_item.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_tax_rates</span><span class="p">(</span>
                <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.SubscriptionItem-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.billing_thresholds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">billing_thresholds</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Define thresholds at which an invoice will be sent, and the related subscription advanced to a new billing period.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.plan" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">plan</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Plan&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscription_items&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The plan the customer is subscribed to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.price" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscription_items&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The price the customer is subscribed to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.proration_behavior" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">proration_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionProrationBehavior</span><span class="o">.</span><span class="n">create_prorations</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.proration_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">proration_date</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.quantity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The quantity of the plan to which the customer should be subscribed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionItem</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.subscription" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Subscription&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The subscription this subscription item belongs to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionItem.tax_rates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">tax_rates</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s1">&#39;TaxRate&#39;</span><span class="p">,</span> <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;djstripe_djstripesubscriptionitemtaxrate&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The tax rates which apply to this subscription_item. When set, the default_tax_rates on the subscription do not apply to this subscription_item.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.SubscriptionItem-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.SubscriptionItem._attach_objects_post_save_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tax_rates</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_tax_rates</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.SubscriptionSchedule" class="doc doc-heading">
        <code>djstripe.models.billing.SubscriptionSchedule</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Subscription schedules allow you to create and manage the lifecycle
of a subscription by predefining expected changes.</p>
<p>Stripe documentation: https://stripe.com/docs/api/subscription_schedules?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SubscriptionSchedule</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subscription schedules allow you to create and manage the lifecycle</span>
<span class="sd">    of a subscription by predefining expected changes.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/subscription_schedules?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionSchedule</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;subscription_schedules&quot;</span>

    <span class="n">canceled_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Time at which the subscription schedule was canceled.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">completed_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Time at which the subscription schedule was completed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">current_phase</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Object representing the start and end dates for the &quot;</span>
        <span class="s2">&quot;current phase of the subscription schedule, if it is `active`.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;schedules&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer who owns the subscription schedule.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_settings</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Object representing the subscription schedule&#39;s default settings.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">end_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionScheduleEndBehavior</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Behavior of the subscription schedule and underlying &quot;</span>
        <span class="s2">&quot;subscription when it ends.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">phases</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Configuration for the subscription schedule&#39;s phases.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">released_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Time at which the subscription schedule was released.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">released_subscription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Subscription&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;released_schedules&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The subscription once managed by this subscription schedule &quot;</span>
        <span class="s2">&quot;(if it is released).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionScheduleStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The present status of the subscription schedule. Possible &quot;</span>
        <span class="s2">&quot;values are `not_started`, `active`, `completed`, `released`, and &quot;</span>
        <span class="s2">&quot;`canceled`.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">subscription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Subscription&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;subscriptions&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the subscription managed by the subscription schedule.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Releases the subscription schedule immediately, which will stop scheduling</span>
<span class="sd">        of its phases, but leave any existing subscription in place.</span>
<span class="sd">        A schedule can only be released if its status is not_started or active.</span>
<span class="sd">        If the subscription schedule is currently associated with a subscription,</span>
<span class="sd">        releasing it will remove its subscription property and set the subscriptions</span>
<span class="sd">        ID to the released_subscription property</span>
<span class="sd">        and returns the Released SubscriptionSchedule.</span>
<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="n">stripe_subscription_schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">release</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription_schedule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels a subscription schedule and its associated subscription immediately</span>
<span class="sd">        (if the subscription schedule has an active subscription). A subscription schedule can only be canceled if its status is not_started or active</span>
<span class="sd">        and returns the Canceled SubscriptionSchedule.</span>
<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="n">stripe_subscription_schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription_schedule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates an existing subscription schedule</span>
<span class="sd">        and returns the updated SubscriptionSchedule.</span>
<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stripe_subscription_schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_update</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription_schedule</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.SubscriptionSchedule-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.canceled_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">canceled_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Time at which the subscription schedule was canceled.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.completed_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">completed_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Time at which the subscription schedule was completed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.current_phase" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">current_phase</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Object representing the start and end dates for the current phase of the subscription schedule, if it is `active`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;schedules&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The customer who owns the subscription schedule.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.default_settings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">default_settings</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Object representing the subscription schedule&#39;s default settings.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.end_behavior" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">end_behavior</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionScheduleEndBehavior</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Behavior of the subscription schedule and underlying subscription when it ends.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.phases" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">phases</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Configuration for the subscription schedule&#39;s phases.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.released_at" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">released_at</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Time at which the subscription schedule was released.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.released_subscription" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">released_subscription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Subscription&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;released_schedules&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The subscription once managed by this subscription schedule (if it is released).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">SubscriptionScheduleStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The present status of the subscription schedule. Possible values are `not_started`, `active`, `completed`, `released`, and `canceled`.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionSchedule</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;subscription_schedules&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.SubscriptionSchedule.subscription" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;Subscription&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;subscriptions&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the subscription managed by the subscription schedule.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.SubscriptionSchedule-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.SubscriptionSchedule.cancel" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Cancels a subscription schedule and its associated subscription immediately
(if the subscription schedule has an active subscription). A subscription schedule can only be canceled if its status is not_started or active
and returns the Canceled SubscriptionSchedule.
:param api_key: The api key to use for this request.
    Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cancels a subscription schedule and its associated subscription immediately</span>
<span class="sd">    (if the subscription schedule has an active subscription). A subscription schedule can only be canceled if its status is not_started or active</span>
<span class="sd">    and returns the Canceled SubscriptionSchedule.</span>
<span class="sd">    :param api_key: The api key to use for this request.</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="n">stripe_subscription_schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription_schedule</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.SubscriptionSchedule.release" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Releases the subscription schedule immediately, which will stop scheduling
of its phases, but leave any existing subscription in place.
A schedule can only be released if its status is not_started or active.
If the subscription schedule is currently associated with a subscription,
releasing it will remove its subscription property and set the subscriptions
ID to the released_subscription property
and returns the Released SubscriptionSchedule.
:param api_key: The api key to use for this request.
    Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Releases the subscription schedule immediately, which will stop scheduling</span>
<span class="sd">    of its phases, but leave any existing subscription in place.</span>
<span class="sd">    A schedule can only be released if its status is not_started or active.</span>
<span class="sd">    If the subscription schedule is currently associated with a subscription,</span>
<span class="sd">    releasing it will remove its subscription property and set the subscriptions</span>
<span class="sd">    ID to the released_subscription property</span>
<span class="sd">    and returns the Released SubscriptionSchedule.</span>
<span class="sd">    :param api_key: The api key to use for this request.</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="n">stripe_subscription_schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">release</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription_schedule</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.SubscriptionSchedule.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Updates an existing subscription schedule
and returns the updated SubscriptionSchedule.
:param api_key: The api key to use for this request.
    Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates an existing subscription schedule</span>
<span class="sd">    and returns the updated SubscriptionSchedule.</span>
<span class="sd">    :param api_key: The api key to use for this request.</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stripe_subscription_schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_update</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">SubscriptionSchedule</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">stripe_subscription_schedule</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.TaxCode" class="doc doc-heading">
        <code>djstripe.models.billing.TaxCode</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Tax codes classify goods and services for tax purposes.</p>
<p>Stripe documentation: https://stripe.com/docs/api/tax_codes</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TaxCode</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tax codes classify goods and services for tax purposes.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/tax_codes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">TaxCode</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A short name for the tax code.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Tax Code&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_find_owner_account</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">):</span>
        <span class="c1"># Tax Codes do not belong to any Stripe Account</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.TaxCode-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxCode.metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxCode</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxCode.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxCode</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A short name for the tax code.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxCode.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxCode</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">TaxCode</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.billing.TaxCode-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.billing.TaxCode.Meta" class="doc doc-heading">
        <code>djstripe.models.billing.TaxCode.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span>.<span title="djstripe.models.base.StripeModel.Meta">Meta</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2024</span>
<span class="normal">2025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Tax Code&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.billing.TaxCode.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.billing.TaxCode.Meta.verbose_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxCode</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Tax Code&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.billing.TaxCode-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxCode.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxCode</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2027</span>
<span class="normal">2028</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxCode._find_owner_account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxCode</span><span class="o">.</span><span class="n">_find_owner_account</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_find_owner_account</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">):</span>
    <span class="c1"># Tax Codes do not belong to any Stripe Account</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.TaxId" class="doc doc-heading">
        <code>djstripe.models.billing.TaxId</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Add one or multiple tax IDs to a customer.
A customer's tax IDs are displayed on invoices and
credit notes issued for the customer.</p>
<p>Stripe documentation: https://stripe.com/docs/api/customer_tax_ids?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TaxId</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add one or multiple tax IDs to a customer.</span>
<span class="sd">    A customer&#39;s tax IDs are displayed on invoices and</span>
<span class="sd">    credit notes issued for the customer.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/customer_tax_ids?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">TaxId</span>
    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Two-letter ISO code representing the country of the tax ID.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;djstripe.customer&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;tax_ids&quot;</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">TaxIdType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of this subscription.&quot;</span>
    <span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Value of the tax ID.&quot;</span><span class="p">)</span>
    <span class="n">verification</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Tax ID verification information.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">TaxIdType</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Tax ID&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_api_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s create operation for this model.</span>

<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Customer Object ID is missing&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">Customer</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">create_tax_id</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s retrieve operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nested_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">retrieve_tax_id</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
            <span class="n">nested_id</span><span class="o">=</span><span class="n">nested_id</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
            <span class="n">expand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_fields</span><span class="p">,</span>
            <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">        :returns: an iterator over all items in the query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">list_tax_ids</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.TaxId-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.country" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Two-letter ISO code representing the country of the tax ID.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;djstripe.customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tax_ids&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">TaxId</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">TaxIdType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of this subscription.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.value" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Value of the tax ID.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxId.verification" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">verification</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Tax ID verification information.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.billing.TaxId-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.billing.TaxId.Meta" class="doc doc-heading">
        <code>djstripe.models.billing.TaxId.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span>.<span title="djstripe.models.base.StripeModel.Meta">Meta</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2065</span>
<span class="normal">2066</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Tax ID&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.billing.TaxId.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.billing.TaxId.Meta.verbose_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Tax ID&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.billing.TaxId-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxId.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2062</span>
<span class="normal">2063</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enums</span><span class="o">.</span><span class="n">TaxIdType</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxId._api_create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's create operation for this model.</p>
<p>:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_api_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s create operation for this model.</span>

<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Customer Object ID is missing&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">Customer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">Customer</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span>

    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">create_tax_id</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxId.api_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's list operation for this model.
:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
See Stripe documentation for accepted kwargs for each object.
:returns: an iterator over all items in the query</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">    :returns: an iterator over all items in the query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">list_tax_ids</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxId.api_retrieve" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxId</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's retrieve operation for this model.
:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s retrieve operation for this model.</span>
<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nested_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Customer</span><span class="o">.</span><span class="n">retrieve_tax_id</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
        <span class="n">nested_id</span><span class="o">=</span><span class="n">nested_id</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
        <span class="n">expand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_fields</span><span class="p">,</span>
        <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.TaxRate" class="doc doc-heading">
        <code>djstripe.models.billing.TaxRate</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Tax rates can be applied to invoices and subscriptions to collect tax.</p>
<p>Stripe documentation: https://stripe.com/docs/api/tax_rates?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TaxRate</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tax rates can be applied to invoices and subscriptions to collect tax.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/tax_rates?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">TaxRate</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;tax-rates&quot;</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Defaults to true. When set to false, this tax rate cannot be &quot;</span>
        <span class="s2">&quot;applied to objects in the API, but will still be applied to subscriptions &quot;</span>
        <span class="s2">&quot;and invoices that already have it set.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Two-letter country code.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The display name of the tax rates as it will appear to your &quot;</span>
        <span class="s2">&quot;customer on their receipt email, PDF, and the hosted invoice page.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">inclusive</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;This specifies if the tax rate is inclusive or exclusive.&quot;</span>
    <span class="p">)</span>
    <span class="n">jurisdiction</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The jurisdiction for the tax rate.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">percentage</span> <span class="o">=</span> <span class="n">StripePercentField</span><span class="p">(</span>
        <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">max_digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;This represents the tax rate percent out of 100.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ISO 3166-2 subdivision code, without country prefix.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tax_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The high-level tax type, such as vat, gst, sales_tax or custom.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">percentage</span><span class="si">}</span><span class="s2">%&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Tax Rate&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.TaxRate-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.active" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Defaults to true. When set to false, this tax rate cannot be applied to objects in the API, but will still be applied to subscriptions and invoices that already have it set.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.country" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Two-letter country code.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.display_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The display name of the tax rates as it will appear to your customer on their receipt email, PDF, and the hosted invoice page.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.inclusive" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">inclusive</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;This specifies if the tax rate is inclusive or exclusive.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.jurisdiction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">jurisdiction</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The jurisdiction for the tax rate.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.percentage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">percentage</span> <span class="o">=</span> <span class="n">StripePercentField</span><span class="p">(</span><span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;This represents the tax rate percent out of 100.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.state" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ISO 3166-2 subdivision code, without country prefix.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">TaxRate</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;tax-rates&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.TaxRate.tax_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">tax_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The high-level tax type, such as vat, gst, sales_tax or custom.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>
<h4 id="djstripe.models.billing.TaxRate-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="djstripe.models.billing.TaxRate.Meta" class="doc doc-heading">
        <code>djstripe.models.billing.TaxRate.Meta</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span>.<span title="djstripe.models.base.StripeModel.Meta">Meta</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2187</span>
<span class="normal">2188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">StripeModel</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
    <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Tax Rate&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h6 id="djstripe.models.billing.TaxRate.Meta-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="djstripe.models.billing.TaxRate.Meta.verbose_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Tax Rate&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="djstripe.models.billing.TaxRate-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.TaxRate.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">TaxRate</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2184</span>
<span class="normal">2185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">percentage</span><span class="si">}</span><span class="s2">%&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.UpcomingInvoice" class="doc doc-heading">
        <code>djstripe.models.billing.UpcomingInvoice</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.billing.BaseInvoice">BaseInvoice</span></code></p>

  
      <p>The preview of an upcoming invoice - does not exist in the Django database.</p>
<p>See BaseInvoice.upcoming()</p>
<p>Logically it should be set abstract, but that doesn't quite work since we
do actually want to instantiate the model and use relations.</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UpcomingInvoice</span><span class="p">(</span><span class="n">BaseInvoice</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The preview of an upcoming invoice - does not exist in the Django database.</span>

<span class="sd">    See BaseInvoice.upcoming()</span>

<span class="sd">    Logically it should be set abstract, but that doesn&#39;t quite work since we</span>
<span class="sd">    do actually want to instantiate the model and use relations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;upcoming_invoices&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment source for the invoice. &quot;</span>
        <span class="s2">&quot;It must belong to the customer associated with the invoice and be &quot;</span>
        <span class="s2">&quot;in a chargeable state. If not set, defaults to the subscription&#39;s &quot;</span>
        <span class="s2">&quot;default source, if any, or to the customer&#39;s default source.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invoiceitems</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_tax_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_tax_amounts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invoiceitems</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_invoice_items</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">InvoiceItem</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">invoice</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_default_tax_rates</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_default_tax_rates</span><span class="p">(</span>
            <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="n">total_tax_amounts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">tax_amount_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_tax_amounts&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">tax_rate_id</span> <span class="o">=</span> <span class="n">tax_amount_data</span><span class="p">[</span><span class="s2">&quot;tax_rate&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tax_rate_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">tax_rate_id</span> <span class="o">=</span> <span class="n">tax_rate_id</span><span class="p">[</span><span class="s2">&quot;tax_rate&quot;</span><span class="p">]</span>

            <span class="n">tax_rate</span> <span class="o">=</span> <span class="n">TaxRate</span><span class="o">.</span><span class="n">_get_or_retrieve</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tax_rate_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

            <span class="n">tax_amount</span> <span class="o">=</span> <span class="n">DjstripeUpcomingInvoiceTotalTaxAmount</span><span class="p">(</span>
                <span class="n">invoice</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">amount</span><span class="o">=</span><span class="n">tax_amount_data</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">],</span>
                <span class="n">inclusive</span><span class="o">=</span><span class="n">tax_amount_data</span><span class="p">[</span><span class="s2">&quot;inclusive&quot;</span><span class="p">],</span>
                <span class="n">tax_rate</span><span class="o">=</span><span class="n">tax_rate</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">total_tax_amounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tax_amount</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_total_tax_amounts</span> <span class="o">=</span> <span class="n">total_tax_amounts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">invoiceitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the invoice items associated with this upcoming invoice.</span>

<span class="sd">        This differs from normal (non-upcoming) invoices, in that upcoming</span>
<span class="sd">        invoices are in-memory and do not persist to the database. Therefore,</span>
<span class="sd">        all of the data comes from the Stripe API itself.</span>

<span class="sd">        Instead of returning a normal queryset for the invoiceitems, this will</span>
<span class="sd">        return a mock of a queryset, but with the data fetched from Stripe - It</span>
<span class="sd">        will act like a normal queryset, but mutation will silently fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">QuerySetMock</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">InvoiceItem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invoiceitems</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_tax_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the default tax rates associated with this upcoming invoice.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">QuerySetMock</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">TaxRate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_tax_rates</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_tax_amounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the total tax amounts associated with this upcoming invoice.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">QuerySetMock</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="n">DjstripeUpcomingInvoiceTotalTaxAmount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_tax_amounts</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@id</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span>  <span class="c1"># noop</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span>  <span class="c1"># noop</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.UpcomingInvoice-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UpcomingInvoice._default_tax_rates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">_default_tax_rates</span> <span class="o">=</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UpcomingInvoice._invoiceitems" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">_invoiceitems</span> <span class="o">=</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UpcomingInvoice._total_tax_amounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">_total_tax_amounts</span> <span class="o">=</span> <span class="p">[]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UpcomingInvoice.default_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">default_source</span> <span class="o">=</span> <span class="n">PaymentMethodForeignKey</span><span class="p">(</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;upcoming_invoices&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The default payment source for the invoice. It must belong to the customer associated with the invoice and be in a chargeable state. If not set, defaults to the subscription&#39;s default source, if any, or to the customer&#39;s default source.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.UpcomingInvoice-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_invoiceitems</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_default_tax_rates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_total_tax_amounts</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice._attach_objects_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">_attach_objects_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_invoiceitems</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_invoice_items</span><span class="p">(</span>
        <span class="n">target_cls</span><span class="o">=</span><span class="n">InvoiceItem</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">invoice</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice._attach_objects_post_save_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_default_tax_rates</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_stripe_object_to_default_tax_rates</span><span class="p">(</span>
        <span class="n">target_cls</span><span class="o">=</span><span class="n">TaxRate</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
    <span class="p">)</span>

    <span class="n">total_tax_amounts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">tax_amount_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_tax_amounts&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">tax_rate_id</span> <span class="o">=</span> <span class="n">tax_amount_data</span><span class="p">[</span><span class="s2">&quot;tax_rate&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tax_rate_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tax_rate_id</span> <span class="o">=</span> <span class="n">tax_rate_id</span><span class="p">[</span><span class="s2">&quot;tax_rate&quot;</span><span class="p">]</span>

        <span class="n">tax_rate</span> <span class="o">=</span> <span class="n">TaxRate</span><span class="o">.</span><span class="n">_get_or_retrieve</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tax_rate_id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

        <span class="n">tax_amount</span> <span class="o">=</span> <span class="n">DjstripeUpcomingInvoiceTotalTaxAmount</span><span class="p">(</span>
            <span class="n">invoice</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">tax_amount_data</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">],</span>
            <span class="n">inclusive</span><span class="o">=</span><span class="n">tax_amount_data</span><span class="p">[</span><span class="s2">&quot;inclusive&quot;</span><span class="p">],</span>
            <span class="n">tax_rate</span><span class="o">=</span><span class="n">tax_rate</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">total_tax_amounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tax_amount</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_total_tax_amounts</span> <span class="o">=</span> <span class="n">total_tax_amounts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.default_tax_rates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">default_tax_rates</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the default tax rates associated with this upcoming invoice.
:return:</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">default_tax_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the default tax rates associated with this upcoming invoice.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">QuerySetMock</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">TaxRate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_tax_rates</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">789</span>
<span class="normal">790</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">id</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.invoiceitems" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">invoiceitems</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the invoice items associated with this upcoming invoice.</p>
<p>This differs from normal (non-upcoming) invoices, in that upcoming
invoices are in-memory and do not persist to the database. Therefore,
all of the data comes from the Stripe API itself.</p>
<p>Instead of returning a normal queryset for the invoiceitems, this will
return a mock of a queryset, but with the data fetched from Stripe - It
will act like a normal queryset, but mutation will silently fail.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">invoiceitems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the invoice items associated with this upcoming invoice.</span>

<span class="sd">    This differs from normal (non-upcoming) invoices, in that upcoming</span>
<span class="sd">    invoices are in-memory and do not persist to the database. Therefore,</span>
<span class="sd">    all of the data comes from the Stripe API itself.</span>

<span class="sd">    Instead of returning a normal queryset for the invoiceitems, this will</span>
<span class="sd">    return a mock of a queryset, but with the data fetched from Stripe - It</span>
<span class="sd">    will act like a normal queryset, but mutation will silently fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">QuerySetMock</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">InvoiceItem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invoiceitems</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.save" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span>  <span class="c1"># noop</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UpcomingInvoice.total_tax_amounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UpcomingInvoice</span><span class="o">.</span><span class="n">total_tax_amounts</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Gets the total tax amounts associated with this upcoming invoice.
:return:</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">total_tax_amounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the total tax amounts associated with this upcoming invoice.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">QuerySetMock</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
        <span class="n">DjstripeUpcomingInvoiceTotalTaxAmount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_tax_amounts</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.UsageRecord" class="doc doc-heading">
        <code>djstripe.models.billing.UsageRecord</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Usage records allow you to continually report usage and metrics to
Stripe for metered billing of plans.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#usage_records</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UsageRecord</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage records allow you to continually report usage and metrics to</span>
<span class="sd">    Stripe for metered billing of plans.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#usage_records</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">UsageRecord</span>

    <span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The quantity of the plan to which the customer should be subscribed.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">subscription_item</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;SubscriptionItem&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;usage_records&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The subscription item this usage record contains data for.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The timestamp for the usage event. This timestamp must be within the current billing period of the subscription of the provided subscription_item.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">action</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">UsageAction</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">UsageAction</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;When using increment the specified quantity will be added to the usage at the specified timestamp. The set action will overwrite the usage quantity at that timestamp. If the subscription has billing thresholds, increment is the only allowed value.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Usage for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subscription_item</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="si">}</span><span class="s2">) is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_api_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s create operation for this model.</span>

<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;SubscriptionItem Object ID is missing&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="n">usage_stripe_data</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">create_usage_record</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="c1"># ! Hack: there is no way to retrieve a UsageRecord object from Stripe,</span>
        <span class="c1"># ! which is why we create and sync it right here</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">usage_stripe_data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">usage_stripe_data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A wrapper around _api_create() to allow one to create and sync UsageRecord Objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.UsageRecord-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.action" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">UsageAction</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">UsageAction</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;When using increment the specified quantity will be added to the usage at the specified timestamp. The set action will overwrite the usage quantity at that timestamp. If the subscription has billing thresholds, increment is the only allowed value.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.quantity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The quantity of the plan to which the customer should be subscribed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">UsageRecord</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.subscription_item" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">subscription_item</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;SubscriptionItem&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;usage_records&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The subscription item this usage record contains data for.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecord.timestamp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The timestamp for the usage event. This timestamp must be within the current billing period of the subscription of the provided subscription_item.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.UsageRecord-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UsageRecord.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2228</span>
<span class="normal">2229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Usage for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subscription_item</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="si">}</span><span class="s2">) is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UsageRecord._api_create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's create operation for this model.</p>
<p>:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_api_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s create operation for this model.</span>

<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;SubscriptionItem Object ID is missing&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span>

    <span class="n">usage_stripe_data</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">create_usage_record</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="c1"># ! Hack: there is no way to retrieve a UsageRecord object from Stripe,</span>
    <span class="c1"># ! which is why we create and sync it right here</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">usage_stripe_data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">usage_stripe_data</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UsageRecord.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecord</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>A wrapper around _api_create() to allow one to create and sync UsageRecord Objects</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper around _api_create() to allow one to create and sync UsageRecord Objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_api_create</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.billing.UsageRecordSummary" class="doc doc-heading">
        <code>djstripe.models.billing.UsageRecordSummary</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Usage record summaries provides usage information that's been summarized
from multiple usage records and over a subscription billing period
(e.g., 15 usage records in the month of September).
Since new usage records can still be added, the returned summary information for the subscription item's ID
should be seen as unstable until the subscription billing period ends.</p>
<p>Stripe documentation: https://stripe.com/docs/api/usage_records/subscription_item_summary_list?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/billing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UsageRecordSummary</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage record summaries provides usage information that&#39;s been summarized</span>
<span class="sd">    from multiple usage records and over a subscription billing period</span>
<span class="sd">    (e.g., 15 usage records in the month of September).</span>
<span class="sd">    Since new usage records can still be added, the returned summary information for the subscription item&#39;s ID</span>
<span class="sd">    should be seen as unstable until the subscription billing period ends.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/usage_records/subscription_item_summary_list?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">UsageRecordSummary</span>

    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Invoice&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;usage_record_summaries&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Subscription Billing period for the SubscriptionItem&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">period_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;End of the Subscription Billing period for the SubscriptionItem&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">period_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Start of the Subscription Billing period for the SubscriptionItem&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">total_usage</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The quantity of the plan to which the customer should be subscribed.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">subscription_item</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;SubscriptionItem&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;usage_record_summaries&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The subscription item this usage record contains data for.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Usage Summary for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subscription_item</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">invoice</span><span class="si">}</span><span class="s2">) is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_usage</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s list operation for this model.</span>

<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>

<span class="sd">        See Stripe documentation for accepted kwargs for each object.</span>

<span class="sd">        :returns: an iterator over all items in the query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;SubscriptionItem Object ID is missing&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">list_usage_record_summaries</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.billing.UsageRecordSummary-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.invoice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">invoice</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Invoice&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;usage_record_summaries&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.period" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Subscription Billing period for the SubscriptionItem&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.period_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">period_end</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;End of the Subscription Billing period for the SubscriptionItem&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.period_start" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">period_start</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Start of the Subscription Billing period for the SubscriptionItem&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">UsageRecordSummary</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.subscription_item" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">subscription_item</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;SubscriptionItem&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;usage_record_summaries&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The subscription item this usage record contains data for.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.billing.UsageRecordSummary.total_usage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">total_usage</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The quantity of the plan to which the customer should be subscribed.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.billing.UsageRecordSummary-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UsageRecordSummary.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2317</span>
<span class="normal">2318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Usage Summary for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subscription_item</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">invoice</span><span class="si">}</span><span class="s2">) is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_usage</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UsageRecordSummary._manipulate_stripe_object_hook" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">][</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.billing.UsageRecordSummary.api_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">UsageRecordSummary</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's list operation for this model.</p>
<p>:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string</p>
<p>See Stripe documentation for accepted kwargs for each object.</p>
<p>:returns: an iterator over all items in the query</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/billing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s list operation for this model.</span>

<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>

<span class="sd">    See Stripe documentation for accepted kwargs for each object.</span>

<span class="sd">    :returns: an iterator over all items in the query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;SubscriptionItem Object ID is missing&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span>

    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">SubscriptionItem</span><span class="o">.</span><span class="n">list_usage_record_summaries</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="djstripe.models.billing-functions">Functions</h2>



  </div>

  </div>

</div><h2 id="connect">Connect</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.models.account"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h2 id="djstripe.models.account-attributes">Attributes</h2>
<h2 id="djstripe.models.account-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.account.Account" class="doc doc-heading">
        <code>djstripe.models.account.Account</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>This is an object representing a Stripe account.</p>
<p>You can retrieve it to see properties on the account like its
current e-mail address or if the account is enabled yet to make live charges.</p>
<p>Stripe documentation: https://stripe.com/docs/api/accounts?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/account.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is an object representing a Stripe account.</span>

<span class="sd">    You can retrieve it to see properties on the account like its</span>
<span class="sd">    current e-mail address or if the account is enabled yet to make live charges.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/accounts?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Account</span>
    <span class="n">business_profile</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Optional information related to the business.&quot;</span>
    <span class="p">)</span>
    <span class="n">business_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BusinessType</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The business type.&quot;</span>
    <span class="p">)</span>
    <span class="n">charges_enabled</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether the account can create live charges&quot;</span>
    <span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The country of the account&quot;</span><span class="p">)</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Information about the company or business. &quot;</span>
            <span class="s2">&quot;This field is null unless business_type is set to company.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">default_currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The currency this account has chosen to use as the default&quot;</span>
    <span class="p">)</span>
    <span class="n">details_submitted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether account details have been submitted. &quot;</span>
            <span class="s2">&quot;Standard accounts cannot receive payouts before this is true.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The primary user&#39;s email address.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># TODO external_accounts = ...</span>
    <span class="n">individual</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Information about the person represented by the account. &quot;</span>
            <span class="s2">&quot;This field is null unless business_type is set to individual.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">payouts_enabled</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether Stripe can send payouts to this account&quot;</span>
    <span class="p">)</span>
    <span class="n">product_description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Internal-only description of the product sold or service provided &quot;</span>
        <span class="s2">&quot;by the business. It&#39;s used by Stripe for risk and underwriting purposes.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">requirements</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Information about the requirements for the account, &quot;</span>
        <span class="s2">&quot;including what information needs to be collected, and by when.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Account options for customizing how the account functions within Stripe.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">AccountType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The Stripe account type.&quot;</span><span class="p">)</span>
    <span class="n">tos_acceptance</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Details on the acceptance of the Stripe Services Agreement&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the stripe dashboard url for this object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://dashboard.stripe.com/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;test/&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">livemode</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">dashboard&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_default_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">livemode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">livemode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">livemode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">livemode</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">APIKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">djstripe_owner_account</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">APIKeyType</span><span class="o">.</span><span class="n">secret</span>
            <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">APIKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">djstripe_owner_account</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">APIKeyType</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">livemode</span><span class="o">=</span><span class="n">livemode</span>
            <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">api_key</span><span class="o">.</span><span class="n">secret</span>
        <span class="k">return</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">business_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The business&#39;s publicly available website.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">business_profile</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">business_profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_account</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">):</span>
        <span class="c1"># As of API version 2020-03-02, there is no permission that can allow</span>
        <span class="c1"># restricted keys to call GET /v1/account</span>
        <span class="k">if</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rk_&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">account_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_or_create_from_stripe_object</span><span class="p">(</span><span class="n">account_data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_or_retrieve_for_api_key</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
            <span class="n">apikey_instance</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">APIKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create_by_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">apikey_instance</span><span class="o">.</span><span class="n">djstripe_owner_account</span><span class="p">:</span>
                <span class="n">apikey_instance</span><span class="o">.</span><span class="n">refresh_account</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">apikey_instance</span><span class="o">.</span><span class="n">djstripe_owner_account</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">business_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">business_profile</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dashboard&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;display_name&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">business_profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_reject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s reject operation for Account model</span>

<span class="sd">        :param api_key: The api key to use for this request.</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_from_stripe_object</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the stripe_account to the id of the Account instance being created.</span>

<span class="sd">        This ensures that the foreign-key relations that may exist in stripe are</span>
<span class="sd">        fetched using the appropriate connected account ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_create_from_stripe_object</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span><span class="p">,</span>
            <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
            <span class="n">stripe_account</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span> <span class="k">else</span> <span class="n">stripe_account</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># &quot;Special&quot; handling of the icon and logo fields</span>
    <span class="c1"># Previously available as properties, they moved to</span>
    <span class="c1"># settings.branding in Stripe 2019-02-19.</span>
    <span class="c1"># Currently, they return a File ID</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">branding_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models.core</span> <span class="kn">import</span> <span class="n">File</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branding&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;icon&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">File</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="k">if</span> <span class="nb">id</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">branding_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models.core</span> <span class="kn">import</span> <span class="n">File</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branding&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logo&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">File</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="k">if</span> <span class="nb">id</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models.core</span> <span class="kn">import</span> <span class="n">File</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="c1"># set the livemode if not returned by data</span>
        <span class="k">if</span> <span class="s2">&quot;livemode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">djstripe_owner_account</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Platform Account</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">djstripe_owner_account</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">livemode</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Connected Account</span>
                <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">livemode</span> <span class="o">=</span> <span class="n">get_api_key_details_by_prefix</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="c1"># save the updates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># Retrieve and save the Files in the settings.branding object.</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="s2">&quot;logo&quot;</span><span class="p">:</span>
            <span class="n">file_upload_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branding&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">field</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">file_upload_id</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">File</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span>
                        <span class="n">File</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">file_upload_id</span><span class="p">)</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span>
                            <span class="n">stripe_account</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                        <span class="p">),</span>
                        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">PermissionError</span><span class="p">:</span>
                    <span class="c1"># No permission to retrieve the data with the key</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Cannot retrieve business branding </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> for acct </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> with the key.&quot;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">InvalidRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;a similar object exists in&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="c1"># HACK around a Stripe bug.</span>
                        <span class="c1"># See #830 and commit c09d25f52bfdcf883e9eec0bf6c25af1771a644a</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span>
                <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">AuthenticationError</span><span class="p">:</span>
                    <span class="c1"># This may happen if saving an account that has a logo, using</span>
                    <span class="c1"># a different API key to the default.</span>
                    <span class="c1"># OK, concretely, there is a chicken-and-egg problem here.</span>
                    <span class="c1"># But, the logo file object is not a particularly important thing.</span>
                    <span class="c1"># Until we have a better solution, just ignore this error.</span>
                    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.account.Account-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.business_profile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">business_profile</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Optional information related to the business.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.business_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">business_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">BusinessType</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The business type.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.charges_enabled" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">charges_enabled</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the account can create live charges&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.company" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">company</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information about the company or business. This field is null unless business_type is set to company.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.country" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The country of the account&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.default_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">default_currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The currency this account has chosen to use as the default&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.details_submitted" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">details_submitted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether account details have been submitted. Standard accounts cannot receive payouts before this is true.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.email" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The primary user&#39;s email address.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.individual" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">individual</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information about the person represented by the account. This field is null unless business_type is set to individual.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.payouts_enabled" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">payouts_enabled</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether Stripe can send payouts to this account&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.product_description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">product_description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Internal-only description of the product sold or service provided by the business. It&#39;s used by Stripe for risk and underwriting purposes.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.requirements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">requirements</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Information about the requirements for the account, including what information needs to be collected, and by when.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.settings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Account options for customizing how the account functions within Stripe.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Account</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.tos_acceptance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">tos_acceptance</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Details on the acceptance of the Stripe Services Agreement&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.account.Account.type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">AccountType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The Stripe account type.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.account.Account-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">business_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">business_profile</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dashboard&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;display_name&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">business_profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.api_reject" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">api_reject</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's reject operation for Account model</p>
<p>:param api_key: The api key to use for this request.
    Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_reject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s reject operation for Account model</span>

<span class="sd">    :param api_key: The api key to use for this request.</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.branding_icon" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">branding_icon</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">branding_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">..models.core</span> <span class="kn">import</span> <span class="n">File</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branding&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;icon&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">File</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="k">if</span> <span class="nb">id</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.branding_logo" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">branding_logo</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">branding_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">..models.core</span> <span class="kn">import</span> <span class="n">File</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branding&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logo&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">File</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="k">if</span> <span class="nb">id</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.business_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">business_url</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>The business's publicly available website.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">business_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The business&#39;s publicly available website.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">business_profile</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">business_profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.default_api_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">default_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.get_default_account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">get_default_account</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_default_account</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">):</span>
    <span class="c1"># As of API version 2020-03-02, there is no permission that can allow</span>
    <span class="c1"># restricted keys to call GET /v1/account</span>
    <span class="k">if</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rk_&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">account_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_or_create_from_stripe_object</span><span class="p">(</span><span class="n">account_data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.get_default_api_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_default_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">livemode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">livemode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">livemode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">livemode</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">APIKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">djstripe_owner_account</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">APIKeyType</span><span class="o">.</span><span class="n">secret</span>
        <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">APIKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">djstripe_owner_account</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">APIKeyType</span><span class="o">.</span><span class="n">secret</span><span class="p">,</span> <span class="n">livemode</span><span class="o">=</span><span class="n">livemode</span>
        <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">api_key</span><span class="o">.</span><span class="n">secret</span>
    <span class="k">return</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.get_or_retrieve_for_api_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">get_or_retrieve_for_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_or_retrieve_for_api_key</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
        <span class="n">apikey_instance</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">APIKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create_by_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">apikey_instance</span><span class="o">.</span><span class="n">djstripe_owner_account</span><span class="p">:</span>
            <span class="n">apikey_instance</span><span class="o">.</span><span class="n">refresh_account</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">apikey_instance</span><span class="o">.</span><span class="n">djstripe_owner_account</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.account.Account.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get the stripe dashboard url for this object.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/account.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the stripe dashboard url for this object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://dashboard.stripe.com/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;test/&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">livemode</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">dashboard&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="djstripe.models.account-functions">Functions</h2>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="djstripe.models.connect"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h2 id="djstripe.models.connect-attributes">Attributes</h2>
<h2 id="djstripe.models.connect-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.connect.ApplicationFee" class="doc doc-heading">
        <code>djstripe.models.connect.ApplicationFee</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>When you collect a transaction fee on top of a charge made for your
user (using Connect), an ApplicationFee is created in your account.</p>
<p>Please note the model field charge exists on the Stripe Connected Account
while the application_fee modelfield on Charge model exists on the Platform Account!</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#application_fees</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/connect.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ApplicationFee</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When you collect a transaction fee on top of a charge made for your</span>
<span class="sd">    user (using Connect), an ApplicationFee is created in your account.</span>

<span class="sd">    Please note the model field charge exists on the Stripe Connected Account</span>
<span class="sd">    while the application_fee modelfield on Charge model exists on the Platform Account!</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#application_fees</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">ApplicationFee</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;application_fees&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the Stripe account this fee was taken from.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount earned, in cents.&quot;</span><span class="p">)</span>
    <span class="n">amount_refunded</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount in cents refunded (can be less than the amount attribute &quot;</span>
        <span class="s2">&quot;on the fee if a partial refund was issued)&quot;</span>
    <span class="p">)</span>
    <span class="c1"># TODO application = ...</span>
    <span class="c1"># balance_transaction exists on the platform account</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your account&quot;</span>
        <span class="s2">&quot; balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># charge exists on the Stripe Connected Account and not the Platform Account</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Charge&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The charge that the application fee was taken from.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="c1"># TODO originating_transaction = ... (refs. both Charge and Transfer)</span>
    <span class="n">refunded</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;Whether the fee has been fully refunded. If the fee is only &quot;</span>
            <span class="s2">&quot;partially refunded, this attribute will still be false.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.connect.ApplicationFee-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;application_fees&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the Stripe account this fee was taken from.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount earned, in cents.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.amount_refunded" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">amount_refunded</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount in cents refunded (can be less than the amount attribute on the fee if a partial refund was issued)&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.charge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Charge&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The charge that the application fee was taken from.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.refunded" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">refunded</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether the fee has been fully refunded. If the fee is only partially refunded, this attribute will still be false.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFee.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFee</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">ApplicationFee</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.connect.ApplicationFeeRefund" class="doc doc-heading">
        <code>djstripe.models.connect.ApplicationFeeRefund</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>ApplicationFeeRefund objects allow you to refund an ApplicationFee that
has previously been created but not yet refunded.
Funds will be refunded to the Stripe account from which the fee was
originally collected.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#fee_refunds</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/connect.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ApplicationFeeRefund</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ApplicationFeeRefund objects allow you to refund an ApplicationFee that</span>
<span class="sd">    has previously been created but not yet refunded.</span>
<span class="sd">    Funds will be refunded to the Stripe account from which the fee was</span>
<span class="sd">    originally collected.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#fee_refunds</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount refunded, in cents.&quot;</span><span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your account &quot;</span>
        <span class="s2">&quot;balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">fee</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;ApplicationFee&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;refunds&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The application fee that was refunded&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.connect.ApplicationFeeRefund-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFeeRefund.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount refunded, in cents.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFeeRefund.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFeeRefund.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFeeRefund.description" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFeeRefund.fee" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span><span class="o">.</span><span class="n">fee</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;ApplicationFee&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;refunds&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The application fee that was refunded&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.ApplicationFeeRefund.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">ApplicationFeeRefund</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.connect.CountrySpec" class="doc doc-heading">
        <code>djstripe.models.connect.CountrySpec</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeBaseModel">StripeBaseModel</span></code></p>

  
      <p>Stripe documentation: https://stripe.com/docs/api?lang=python#country_specs</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/connect.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CountrySpec</span><span class="p">(</span><span class="n">StripeBaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#country_specs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">CountrySpec</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">serialize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">default_currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The default currency for this country. &quot;</span>
            <span class="s2">&quot;This applies to both payment methods and bank accounts.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">supported_bank_account_currencies</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Currencies that can be accepted in the specific country&quot;</span>
        <span class="s2">&quot; (for transfers).&quot;</span>
    <span class="p">)</span>
    <span class="n">supported_payment_currencies</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Currencies that can be accepted in the specified country&quot;</span>
        <span class="s2">&quot; (for payments).&quot;</span>
    <span class="p">)</span>
    <span class="n">supported_payment_methods</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Payment methods available in the specified country.&quot;</span>
    <span class="p">)</span>
    <span class="n">supported_transfer_countries</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Countries that can accept transfers from the specified country.&quot;</span>
    <span class="p">)</span>
    <span class="n">verification_fields</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Lists the types of verification data needed to keep an account open.&quot;</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">sync_from_stripe_data</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CountrySpec&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Syncs this object from the stripe data provided.</span>

<span class="sd">        Foreign keys will also be retrieved and synced recursively.</span>

<span class="sd">        :param data: stripe object</span>
<span class="sd">        :type data: dict</span>
<span class="sd">        :rtype: cls</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="n">supported_fields</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;default_currency&quot;</span><span class="p">,</span>
            <span class="s2">&quot;supported_bank_account_currencies&quot;</span><span class="p">,</span>
            <span class="s2">&quot;supported_payment_currencies&quot;</span><span class="p">,</span>
            <span class="s2">&quot;supported_payment_methods&quot;</span><span class="p">,</span>
            <span class="s2">&quot;supported_transfer_countries&quot;</span><span class="p">,</span>
            <span class="s2">&quot;verification_fields&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">instance</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">data_id</span><span class="p">,</span>
            <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">supported_fields</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
            <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.connect.CountrySpec-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.default_currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">default_currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The default currency for this country. This applies to both payment methods and bank accounts.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">serialize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">CountrySpec</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.supported_bank_account_currencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">supported_bank_account_currencies</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Currencies that can be accepted in the specific country (for transfers).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.supported_payment_currencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">supported_payment_currencies</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Currencies that can be accepted in the specified country (for payments).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.supported_payment_methods" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">supported_payment_methods</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Payment methods available in the specified country.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.supported_transfer_countries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">supported_transfer_countries</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Countries that can accept transfers from the specified country.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.CountrySpec.verification_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">verification_fields</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Lists the types of verification data needed to keep an account open.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.connect.CountrySpec-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.CountrySpec.api_retrieve" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
        <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.CountrySpec.sync_from_stripe_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">CountrySpec</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Syncs this object from the stripe data provided.</p>
<p>Foreign keys will also be retrieved and synced recursively.</p>
<p>:param data: stripe object
:type data: dict
:rtype: cls</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">sync_from_stripe_data</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CountrySpec&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Syncs this object from the stripe data provided.</span>

<span class="sd">    Foreign keys will also be retrieved and synced recursively.</span>

<span class="sd">    :param data: stripe object</span>
<span class="sd">    :type data: dict</span>
<span class="sd">    :rtype: cls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="n">supported_fields</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;default_currency&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supported_bank_account_currencies&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supported_payment_currencies&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supported_payment_methods&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supported_transfer_countries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;verification_fields&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">instance</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">data_id</span><span class="p">,</span>
        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">supported_fields</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.connect.Transfer" class="doc doc-heading">
        <code>djstripe.models.connect.Transfer</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>When Stripe sends you money or you initiate a transfer to a bank account,
debit card, or connected Stripe account, a transfer object will be created.</p>
<p>Stripe documentation: https://stripe.com/docs/api?lang=python#transfers</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/connect.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Transfer</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When Stripe sends you money or you initiate a transfer to a bank account,</span>
<span class="sd">    debit card, or connected Stripe account, a transfer object will be created.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#transfers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;balance_transaction&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;transfers&quot;</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">TransferManager</span><span class="p">()</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The amount transferred&quot;</span><span class="p">)</span>
    <span class="n">amount_reversed</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The amount (as decimal) reversed (can be less than the amount &quot;</span>
        <span class="s2">&quot;attribute on the transfer if a partial reversal was issued).&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your account&quot;</span>
        <span class="s2">&quot; balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>

    <span class="n">destination</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the bank account, card, or Stripe account the transfer was sent to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># todo implement payment model (for some reason py ids are showing up in the charge model)</span>
    <span class="n">destination_payment</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the destination is a Stripe account, this will be the ID of the &quot;</span>
        <span class="s2">&quot;payment that the destination account received for the transfer.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">reversed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the transfer has been fully reversed. &quot;</span>
        <span class="s2">&quot;If the transfer is only partially reversed, this attribute will still &quot;</span>
        <span class="s2">&quot;be false.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">source_transaction</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the charge (or other transaction) that was used to fund &quot;</span>
        <span class="s2">&quot;the transfer. If null, the transfer was funded from the available balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">source_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">LegacySourceType</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The source balance from which this transfer came.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">transfer_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A string that identifies this transaction as part of a group.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fee</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="o">.</span><span class="n">fee</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed</span><span class="p">:</span>
            <span class="c1"># Complete Reversal</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> Reversed&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount_reversed</span><span class="p">:</span>
            <span class="c1"># Partial Reversal</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> Partially Reversed&quot;</span>
        <span class="c1"># No Reversal</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_attach_objects_post_save_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span>
        <span class="n">pending_relations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over reversals on the Transfer object to create and/or sync</span>
<span class="sd">        TransferReversal objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_post_save_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">pending_relations</span><span class="o">=</span><span class="n">pending_relations</span>
        <span class="p">)</span>

        <span class="c1"># Transfer Reversals exist as a list on the Transfer Object</span>
        <span class="k">for</span> <span class="n">reversals_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reversals&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">():</span>
            <span class="n">TransferReversal</span><span class="o">.</span><span class="n">sync_from_stripe_data</span><span class="p">(</span><span class="n">reversals_data</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stripe_dashboard_url</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;connect/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.connect.Transfer-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The amount transferred&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.amount_reversed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">amount_reversed</span> <span class="o">=</span> <span class="n">StripeDecimalCurrencyAmountField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The amount (as decimal) reversed (can be less than the amount attribute on the transfer if a partial reversal was issued).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.destination" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the bank account, card, or Stripe account the transfer was sent to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.destination_payment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">destination_payment</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the destination is a Stripe account, this will be the ID of the payment that the destination account received for the transfer.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;balance_transaction&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.objects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">TransferManager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.reversed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">reversed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether or not the transfer has been fully reversed. If the transfer is only partially reversed, this attribute will still be false.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.source_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">source_transaction</span> <span class="o">=</span> <span class="n">StripeIdField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the charge (or other transaction) that was used to fund the transfer. If null, the transfer was funded from the available balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.source_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">source_type</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">LegacySourceType</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The source balance from which this transfer came.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;transfers&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.Transfer.transfer_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">transfer_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A string that identifies this transaction as part of a group.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.connect.Transfer-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.Transfer.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">get_friendly_currency_amount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reversed</span><span class="p">:</span>
        <span class="c1"># Complete Reversal</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> Reversed&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount_reversed</span><span class="p">:</span>
        <span class="c1"># Partial Reversal</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> Partially Reversed&quot;</span>
    <span class="c1"># No Reversal</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.Transfer.fee" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">fee</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">fee</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance_transaction</span><span class="o">.</span><span class="n">fee</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.Transfer.get_stripe_dashboard_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">get_stripe_dashboard_url</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_stripe_dashboard_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_stripe_dashboard_url</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;connect/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.connect.TransferReversal" class="doc doc-heading">
        <code>djstripe.models.connect.TransferReversal</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Stripe documentation: https://stripe.com/docs/api?lang=python#transfer_reversals</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/connect.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransferReversal</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#transfer_reversals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;balance_transaction&quot;</span><span class="p">,</span> <span class="s2">&quot;transfer&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;transfer_reversals&quot;</span>

    <span class="c1"># TransferReversal classmethods are derived from</span>
    <span class="c1"># and attached to the stripe.Transfer class</span>
    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Amount, in cents.&quot;</span><span class="p">)</span>
    <span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;BalanceTransaction&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;transfer_reversals&quot;</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Balance transaction that describes the impact on your account &quot;</span>
        <span class="s2">&quot;balance.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span>
    <span class="n">transfer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Transfer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The transfer that was reversed.&quot;</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;reversals&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_api_create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s create operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Transfer Object ID is missing&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">Transfer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">Transfer</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">create_reversal</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s retrieve operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nested_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="o">.</span><span class="n">id</span>

        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">retrieve_reversal</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
            <span class="n">nested_id</span><span class="o">=</span><span class="n">nested_id</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
            <span class="n">expand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_fields</span><span class="p">,</span>
            <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">        :returns: an iterator over all items in the query</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">list_reversals</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_valid_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether the data is a valid object for the class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;transfer_reversal&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.connect.TransferReversal-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.amount" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Amount, in cents.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.balance_transaction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">balance_transaction</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;BalanceTransaction&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;transfer_reversals&#39;</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Balance transaction that describes the impact on your account balance.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;balance_transaction&#39;</span><span class="p">,</span> <span class="s1">&#39;transfer&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;transfer_reversals&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.connect.TransferReversal.transfer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">transfer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Transfer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The transfer that was reversed.&#39;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;reversals&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.connect.TransferReversal-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.TransferReversal.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.TransferReversal.api_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">api_list</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's list operation for this model.
:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
See Stripe documentation for accepted kwargs for each object.
:returns: an iterator over all items in the query</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">api_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s list operation for this model.</span>
<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    See Stripe documentation for accepted kwargs for each object.</span>
<span class="sd">    :returns: an iterator over all items in the query</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">list_reversals</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">auto_paging_iter</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.TransferReversal.api_retrieve" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">api_retrieve</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Call the stripe API's retrieve operation for this model.
:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_retrieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the stripe API&#39;s retrieve operation for this model.</span>
<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nested_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Transfer</span><span class="o">.</span><span class="n">retrieve_reversal</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
        <span class="n">nested_id</span><span class="o">=</span><span class="n">nested_id</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span><span class="p">,</span>
        <span class="n">expand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_fields</span><span class="p">,</span>
        <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.connect.TransferReversal.is_valid_object" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">connect</span><span class="o">.</span><span class="n">TransferReversal</span><span class="o">.</span><span class="n">is_valid_object</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns whether the data is a valid object for the class</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/connect.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">is_valid_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether the data is a valid object for the class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;transfer_reversal&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="djstripe.models.connect-functions">Functions</h2>



  </div>

  </div>

</div><h2 id="fraud">Fraud</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.models.fraud"></a>
  <div class="doc doc-contents first">

  </div>

</div><h2 id="orders">Orders</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.models.orders"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h2 id="djstripe.models.orders-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.orders.Order" class="doc doc-heading">
        <code>djstripe.models.orders.Order</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>An Order describes a purchase being made by a customer,
including the products &amp; quantities being purchased, the order status,
the payment information, and the billing/shipping details.</p>
<p>Stripe documentation: https://stripe.com/docs/api/orders_v2/object?lang=python</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/orders.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Order describes a purchase being made by a customer,</span>
<span class="sd">    including the products &amp; quantities being purchased, the order status,</span>
<span class="sd">    the payment information, and the billing/shipping details.</span>

<span class="sd">    Stripe documentation: https://stripe.com/docs/api/orders_v2/object?lang=python</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Order</span>
    <span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;customer&quot;</span><span class="p">,</span> <span class="s2">&quot;line_items&quot;</span><span class="p">,</span> <span class="s2">&quot;total_details.breakdown&quot;</span><span class="p">]</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;orders&quot;</span>

    <span class="n">amount_subtotal</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Order cost before any discounts or taxes are applied. A positive integer representing the subtotal of the order in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal currency).&quot;</span>
    <span class="p">)</span>
    <span class="n">amount_total</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Total order cost after discounts and taxes are applied. A positive integer representing the cost of the order in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal currency). To submit an order, the total must be either 0 or at least $0.50 USD or equivalent in charge currency.&quot;</span>
    <span class="p">)</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the Connect application that created the Order, if any.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">automatic_tax</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Settings and latest results for automatic tax lookup for this Order.&quot;</span>
    <span class="p">)</span>
    <span class="n">billing_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Customer billing details associated with the order.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The client secret of this PaymentIntent. &quot;</span>
            <span class="s2">&quot;Used for client-side retrieval using a publishable key.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Three-letter ISO currency code, in lowercase. Must be a supported currency.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># not deleting order when customer is deleted, because order may be important for taxation and audit purposes</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Customer&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The customer which this orders belongs to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">discounts</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The discounts applied to the order.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A recent IP address of the purchaser used for tax reporting and tax location inference.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">line_items</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A list of line items the customer is ordering. Each line item includes information about the product, the quantity, and the resulting cost. There is a maximum of 100 line items.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Payment information associated with the order. Includes payment status, settings, and a PaymentIntent ID&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">payment_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;PaymentIntent&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;ID of the payment intent associated with this order. Null when the order is open.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">shipping_cost</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The details of the customer cost of shipping, including the customer chosen ShippingRate.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">shipping_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Customer shipping information associated with the order.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">OrderStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The overall status of the order.&quot;</span>
    <span class="p">)</span>
    <span class="n">tax_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Tax details about the purchaser for this order.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">total_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Tax, discount, and shipping details for the computed total amount of this order.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">canceled</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Created &quot;</span> <span class="o">+</span> <span class="n">template</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">OrderStatus</span><span class="o">.</span><span class="n">submitted</span><span class="p">,</span>
            <span class="n">OrderStatus</span><span class="o">.</span><span class="n">complete</span><span class="p">,</span>
            <span class="n">OrderStatus</span><span class="o">.</span><span class="n">processing</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Placed &quot;</span> <span class="o">+</span> <span class="n">template</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_manipulate_stripe_object_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;payment_intent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;payment&quot;</span><span class="p">][</span><span class="s2">&quot;payment_intent&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels the order as well as the payment intent if one is attached.</span>

<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">reopen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reopens a submitted order.</span>

<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submitting an Order transitions the status to processing and creates a PaymentIntent object</span>
<span class="sd">        so the order can be paid.</span>
<span class="sd">        If the Order has an amount_total of 0, no PaymentIntent object will be created.</span>
<span class="sd">        Once the order is submitted, its contents cannot be changed,</span>
<span class="sd">        unless the reopen method is called.</span>

<span class="sd">        :param api_key: The api key to use for this request. \</span>
<span class="sd">            Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">        :type api_key: string</span>
<span class="sd">        :param stripe_account: The optional connected account \</span>
<span class="sd">            for which this request is being made.</span>
<span class="sd">        :type stripe_account: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="c1"># Prefer passed in stripe_account if set.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.orders.Order-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.amount_subtotal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">amount_subtotal</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Order cost before any discounts or taxes are applied. A positive integer representing the subtotal of the order in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal currency).&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.amount_total" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">amount_total</span> <span class="o">=</span> <span class="n">StripeQuantumCurrencyAmountField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Total order cost after discounts and taxes are applied. A positive integer representing the cost of the order in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal currency). To submit an order, the total must be either 0 or at least $0.50 USD or equivalent in charge currency.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.application" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the Connect application that created the Order, if any.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.automatic_tax" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">automatic_tax</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Settings and latest results for automatic tax lookup for this Order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.billing_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">billing_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Customer billing details associated with the order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.client_secret" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The client secret of this PaymentIntent. Used for client-side retrieval using a publishable key.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.currency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">StripeCurrencyCodeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Three-letter ISO currency code, in lowercase. Must be a supported currency.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.customer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">customer</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The customer which this orders belongs to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.discounts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">discounts</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The discounts applied to the order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.expand_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">expand_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;line_items&#39;</span><span class="p">,</span> <span class="s1">&#39;total_details.breakdown&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.ip_address" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">ip_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A recent IP address of the purchaser used for tax reporting and tax location inference.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.line_items" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">line_items</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A list of line items the customer is ordering. Each line item includes information about the product, the quantity, and the resulting cost. There is a maximum of 100 line items.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.payment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">payment</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Payment information associated with the order. Includes payment status, settings, and a PaymentIntent ID&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.payment_intent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">payment_intent</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;PaymentIntent&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;ID of the payment intent associated with this order. Null when the order is open.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.shipping_cost" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">shipping_cost</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The details of the customer cost of shipping, including the customer chosen ShippingRate.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.shipping_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">shipping_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Customer shipping information associated with the order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">OrderStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The overall status of the order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Order</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;orders&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.tax_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">tax_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Tax details about the purchaser for this order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.orders.Order.total_details" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">total_details</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Tax, discount, and shipping details for the computed total amount of this order.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.orders.Order-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.orders.Order.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/orders.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">open</span><span class="p">,</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">canceled</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Created &quot;</span> <span class="o">+</span> <span class="n">template</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">OrderStatus</span><span class="o">.</span><span class="n">submitted</span><span class="p">,</span>
        <span class="n">OrderStatus</span><span class="o">.</span><span class="n">complete</span><span class="p">,</span>
        <span class="n">OrderStatus</span><span class="o">.</span><span class="n">processing</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Placed &quot;</span> <span class="o">+</span> <span class="n">template</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.orders.Order.cancel" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Cancels the order as well as the payment intent if one is attached.</p>
<p>:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/orders.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cancels the order as well as the payment intent if one is attached.</span>

<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.orders.Order.reopen" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Reopens a submitted order.</p>
<p>:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/orders.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reopen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reopens a submitted order.</span>

<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.orders.Order.submit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">orders</span><span class="o">.</span><span class="n">Order</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Submitting an Order transitions the status to processing and creates a PaymentIntent object
so the order can be paid.
If the Order has an amount_total of 0, no PaymentIntent object will be created.
Once the order is submitted, its contents cannot be changed,
unless the reopen method is called.</p>
<p>:param api_key: The api key to use for this request.             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
:type api_key: string
:param stripe_account: The optional connected account             for which this request is being made.
:type stripe_account: string</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/orders.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submitting an Order transitions the status to processing and creates a PaymentIntent object</span>
<span class="sd">    so the order can be paid.</span>
<span class="sd">    If the Order has an amount_total of 0, no PaymentIntent object will be created.</span>
<span class="sd">    Once the order is submitted, its contents cannot be changed,</span>
<span class="sd">    unless the reopen method is called.</span>

<span class="sd">    :param api_key: The api key to use for this request. \</span>
<span class="sd">        Defaults to djstripe_settings.STRIPE_SECRET_KEY.</span>
<span class="sd">    :type api_key: string</span>
<span class="sd">    :param stripe_account: The optional connected account \</span>
<span class="sd">        for which this request is being made.</span>
<span class="sd">    :type stripe_account: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_api_key</span>
    <span class="c1"># Prefer passed in stripe_account if set.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stripe_account</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stripe_account_id</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">stripe_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="sigma">Sigma</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.models.sigma"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h2 id="djstripe.models.sigma-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.sigma.ScheduledQueryRun" class="doc doc-heading">
        <code>djstripe.models.sigma.ScheduledQueryRun</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>

  
      <p>Stripe documentation: https://stripe.com/docs/api?lang=python#scheduled_queries</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/sigma.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ScheduledQueryRun</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stripe documentation: https://stripe.com/docs/api?lang=python#scheduled_queries</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span>

    <span class="n">data_load_time</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;When the query was run, Sigma contained a snapshot of your &quot;</span>
        <span class="s2">&quot;Stripe data at this time.&quot;</span>
    <span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;If the query run was not succeesful, contains information &quot;</span>
        <span class="s2">&quot;about the failure.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;file&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The file object representing the results of the query.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">result_available_until</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Time at which the result expires and is no longer available &quot;</span>
        <span class="s2">&quot;for download.&quot;</span>
    <span class="p">)</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;SQL for the query.&quot;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ScheduledQueryRunStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The query&#39;s execution status.&quot;</span>
    <span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Title of the query.&quot;</span><span class="p">)</span>

    <span class="c1"># TODO Write corresponding test</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.sigma.ScheduledQueryRun-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.data_load_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">data_load_time</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;When the query was run, Sigma contained a snapshot of your Stripe data at this time.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;If the query run was not succeesful, contains information about the failure.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The file object representing the results of the query.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.result_available_until" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">result_available_until</span> <span class="o">=</span> <span class="n">StripeDateTimeField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Time at which the result expires and is no longer available for download.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.sql" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">sql</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;SQL for the query.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">enums</span><span class="o">.</span><span class="n">ScheduledQueryRunStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The query&#39;s execution status.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.title" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Title of the query.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.sigma.ScheduledQueryRun-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.sigma.ScheduledQueryRun.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">ScheduledQueryRun</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/sigma.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="webhooks">Webhooks</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.models.webhooks"></a>
  <div class="doc doc-contents first">
  
      <p>Module for dj-stripe Webhook models</p>

  

  <div class="doc doc-children">





<h2 id="djstripe.models.webhooks-attributes">Attributes</h2>
<h2 id="djstripe.models.webhooks-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.webhooks.WebhookEndpoint" class="doc doc-heading">
        <code>djstripe.models.webhooks.WebhookEndpoint</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="djstripe.models.base.StripeModel">StripeModel</span></code></p>



        <details class="quote">
          <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WebhookEndpoint</span><span class="p">(</span><span class="n">StripeModel</span><span class="p">):</span>
    <span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">WebhookEndpoint</span>
    <span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s2">&quot;webhooks&quot;</span>

    <span class="n">api_version</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The API version events are rendered as for this webhook endpoint. Defaults to the configured Stripe API Version.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">enabled_events</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;The list of events to enable for this endpoint. &quot;</span>
            <span class="s2">&quot;[&#39;*&#39;] indicates that all events are enabled, except those that require explicit selection.&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The endpoint&#39;s secret, used to generate webhook signatures.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span>
        <span class="n">enum</span><span class="o">=</span><span class="n">WebhookEndpointStatus</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The status of the webhook. It can be enabled or disabled.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The URL of the webhook endpoint.&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The ID of the associated Connect application.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">djstripe_uuid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">uuid4</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;A UUID specific to dj-stripe generated for the endpoint&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">djstripe_uuid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_objects_hook</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets called by this object&#39;s create and sync methods just before save.</span>
<span class="sd">        Use this to populate fields before the model is saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_objects_hook</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">current_ids</span><span class="o">=</span><span class="n">current_ids</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">djstripe_uuid</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;djstripe_uuid&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.webhooks.WebhookEndpoint-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.api_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">api_version</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The API version events are rendered as for this webhook endpoint. Defaults to the configured Stripe API Version.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.application" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The ID of the associated Connect application.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.djstripe_uuid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">djstripe_uuid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid4</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;A UUID specific to dj-stripe generated for the endpoint&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.enabled_events" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">enabled_events</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The list of events to enable for this endpoint. [&#39;*&#39;] indicates that all events are enabled, except those that require explicit selection.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.secret" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The endpoint&#39;s secret, used to generate webhook signatures.&quot;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">StripeEnumField</span><span class="p">(</span><span class="n">enum</span><span class="o">=</span><span class="n">WebhookEndpointStatus</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The status of the webhook. It can be enabled or disabled.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.stripe_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">stripe_class</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">WebhookEndpoint</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.stripe_dashboard_item_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">stripe_dashboard_item_name</span> <span class="o">=</span> <span class="s1">&#39;webhooks&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The URL of the webhook endpoint.&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.webhooks.WebhookEndpoint-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEndpoint.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEndpoint</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">djstripe_uuid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="djstripe.models.webhooks.WebhookEventTrigger" class="doc doc-heading">
        <code>djstripe.models.webhooks.WebhookEventTrigger</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="django.db.models">models</span>.<span title="django.db.models.Model">Model</span></code></p>

  
      <p>An instance of a request that reached the server endpoint for Stripe webhooks.</p>
<p>Webhook Events are initially <strong>UNTRUSTED</strong>, as it is possible for any web entity to
post any data to our webhook url. Data posted may be valid Stripe information,
garbage, or even malicious.
The 'valid' flag in this model monitors this.</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WebhookEventTrigger</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An instance of a request that reached the server endpoint for Stripe webhooks.</span>

<span class="sd">    Webhook Events are initially **UNTRUSTED**, as it is possible for any web entity to</span>
<span class="sd">    post any data to our webhook url. Data posted may be valid Stripe information,</span>
<span class="sd">    garbage, or even malicious.</span>
<span class="sd">    The &#39;valid&#39; flag in this model monitors this.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigAutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">remote_ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;IP address of the request client.&quot;</span>
    <span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the webhook event has passed validation&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Whether or not the webhook event has been successfully processed&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">exception</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">traceback</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Traceback if an exception was thrown during processing&quot;</span>
    <span class="p">)</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;Event&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Event object contained in the (valid) Webhook&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">djstripe_version</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">_get_version</span><span class="p">,</span>  <span class="c1"># Needs to be a callable, otherwise it&#39;s a db default.</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The version of dj-stripe when the webhook was received&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">stripe_trigger_account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;djstripe.Account&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">to_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The Stripe Account this object belongs to.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">webhook_endpoint</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span>
        <span class="s2">&quot;WebhookEndpoint&quot;</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;The endpoint this webhook was received on&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, valid=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="si">}</span><span class="s2">, processed=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">processed</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_request</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">webhook_endpoint</span><span class="p">:</span> <span class="n">WebhookEndpoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create, validate and process a WebhookEventTrigger given a Django</span>
<span class="sd">        request object.</span>

<span class="sd">        The process is three-fold:</span>
<span class="sd">        1. Create a WebhookEventTrigger object from a Django request.</span>
<span class="sd">        2. Validate the WebhookEventTrigger as a Stripe event using the API.</span>
<span class="sd">        3. If valid, process it into an Event object (and child resource).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;(error decoding body)&quot;</span>

        <span class="n">ip</span> <span class="o">=</span> <span class="n">get_remote_ip</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">webhook_endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="n">StripeModel</span><span class="o">.</span><span class="n">_find_owner_account</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">secret</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_SECRET</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stripe_account</span> <span class="o">=</span> <span class="n">webhook_endpoint</span><span class="o">.</span><span class="n">djstripe_owner_account</span>
            <span class="n">secret</span> <span class="o">=</span> <span class="n">webhook_endpoint</span><span class="o">.</span><span class="n">secret</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">headers</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
            <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
            <span class="n">remote_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">stripe_trigger_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
            <span class="n">webhook_endpoint</span><span class="o">=</span><span class="n">webhook_endpoint</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">stripe_account</span><span class="o">.</span><span class="n">default_api_key</span>
            <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">livemode</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate the webhook first</span>
            <span class="n">signals</span><span class="o">.</span><span class="n">webhook_pre_validate</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="n">secret</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">signals</span><span class="o">.</span><span class="n">webhook_post_validate</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">valid</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
                <span class="n">signals</span><span class="o">.</span><span class="n">webhook_pre_process</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                    <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_EVENT_CALLBACK</span><span class="p">:</span>
                    <span class="c1"># If WEBHOOK_EVENT_CALLBACK, pass it for processing</span>
                    <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_EVENT_CALLBACK</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Process the item (do not save it, it&#39;ll get saved below)</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
                <span class="n">signals</span><span class="o">.</span><span class="n">webhook_post_process</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                    <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">max_length</span> <span class="o">=</span> <span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s2">&quot;exception&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_length</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="n">max_length</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">format_exc</span><span class="p">()</span>

            <span class="c1"># Send the exception as the webhook_processing_error signal</span>
            <span class="n">signals</span><span class="o">.</span><span class="n">webhook_processing_error</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span>
                <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
                <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;http_body&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># re-raise the exception so Django sees it</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">json_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_test_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">event_id</span> <span class="ow">and</span> <span class="n">event_id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_00000000000000&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">verify_signature</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot verify event signature without a secret&quot;</span><span class="p">)</span>

        <span class="c1"># HTTP headers are case-insensitive, but we store them as a dict.</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">CaseInsensitiveMapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stripe-signature&quot;</span><span class="p">)</span>
        <span class="n">local_cli_signing_secret</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x-djstripe-webhook-secret&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># check if the x-djstripe-webhook-secret Custom Header exists</span>
            <span class="k">if</span> <span class="n">local_cli_signing_secret</span><span class="p">:</span>
                <span class="c1"># Set Endpoint Signing Secret to the output of Stripe CLI</span>
                <span class="c1"># for signature verification</span>
                <span class="n">secret</span> <span class="o">=</span> <span class="n">local_cli_signing_secret</span>

            <span class="n">stripe</span><span class="o">.</span><span class="n">WebhookSignature</span><span class="o">.</span><span class="n">verify_header</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">tolerance</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">SignatureVerificationError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to verify header&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_SECRET</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span><span class="p">,</span>
        <span class="n">validation_method</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_VALIDATION</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The original contents of the Event message must be confirmed by</span>
<span class="sd">        refetching it and comparing the fetched data with the original data.</span>

<span class="sd">        This function makes an API call to Stripe to redownload the Event data</span>
<span class="sd">        and returns whether or not it matches the WebhookEventTrigger data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">local_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_body</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_data</span> <span class="ow">or</span> <span class="s2">&quot;livemode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_data</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;&quot;id&quot; not in json body or &quot;livemode&quot; not in json body(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">local_data</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_test_event</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test webhook received and discarded: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">local_data</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">validation_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># validation disabled</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;WEBHOOK VALIDATION is disabled.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">validation_method</span> <span class="o">==</span> <span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_signature</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="n">secret</span><span class="p">)</span>

        <span class="n">livemode</span> <span class="o">=</span> <span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;livemode&quot;</span><span class="p">]</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="p">)</span>

        <span class="c1"># Retrieve the event using the api_version specified in itself</span>
        <span class="k">with</span> <span class="n">stripe_temporary_api_version</span><span class="p">(</span><span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;api_version&quot;</span><span class="p">],</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">remote_data</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">remote_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Reset traceback and exception in case of reprocessing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_body</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.models.webhooks.WebhookEventTrigger-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.body" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.created" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.djstripe_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">djstripe_version</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_get_version</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The version of dj-stripe when the webhook was received&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.event" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;Event&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Event object contained in the (valid) Webhook&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.exception" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.headers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigAutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.processed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">processed</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether or not the webhook event has been successfully processed&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.remote_ip" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">remote_ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;IP address of the request client.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.stripe_trigger_account" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">stripe_trigger_account</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;djstripe.Account&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The Stripe Account this object belongs to.&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.traceback" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Traceback if an exception was thrown during processing&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.updated" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.valid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Whether or not the webhook event has passed validation&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.webhook_endpoint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">webhook_endpoint</span> <span class="o">=</span> <span class="n">StripeForeignKey</span><span class="p">(</span><span class="s1">&#39;WebhookEndpoint&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;The endpoint this webhook was received on&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.models.webhooks.WebhookEventTrigger-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.__str__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, valid=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="si">}</span><span class="s2">, processed=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">processed</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.from_request" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">from_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">webhook_endpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Create, validate and process a WebhookEventTrigger given a Django
request object.</p>
<p>The process is three-fold:
1. Create a WebhookEventTrigger object from a Django request.
2. Validate the WebhookEventTrigger as a Stripe event using the API.
3. If valid, process it into an Event object (and child resource).</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_request</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">webhook_endpoint</span><span class="p">:</span> <span class="n">WebhookEndpoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create, validate and process a WebhookEventTrigger given a Django</span>
<span class="sd">    request object.</span>

<span class="sd">    The process is three-fold:</span>
<span class="sd">    1. Create a WebhookEventTrigger object from a Django request.</span>
<span class="sd">    2. Validate the WebhookEventTrigger as a Stripe event using the API.</span>
<span class="sd">    3. If valid, process it into an Event object (and child resource).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;(error decoding body)&quot;</span>

    <span class="n">ip</span> <span class="o">=</span> <span class="n">get_remote_ip</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">webhook_endpoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="n">StripeModel</span><span class="o">.</span><span class="n">_find_owner_account</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_SECRET</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stripe_account</span> <span class="o">=</span> <span class="n">webhook_endpoint</span><span class="o">.</span><span class="n">djstripe_owner_account</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="n">webhook_endpoint</span><span class="o">.</span><span class="n">secret</span>

    <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">headers</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">),</span>
        <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
        <span class="n">remote_ip</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
        <span class="n">stripe_trigger_account</span><span class="o">=</span><span class="n">stripe_account</span><span class="p">,</span>
        <span class="n">webhook_endpoint</span><span class="o">=</span><span class="n">webhook_endpoint</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">stripe_account</span><span class="o">.</span><span class="n">default_api_key</span>
        <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">livemode</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate the webhook first</span>
        <span class="n">signals</span><span class="o">.</span><span class="n">webhook_pre_validate</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="n">secret</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
        <span class="n">signals</span><span class="o">.</span><span class="n">webhook_post_validate</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
            <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">valid</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">signals</span><span class="o">.</span><span class="n">webhook_pre_process</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_EVENT_CALLBACK</span><span class="p">:</span>
                <span class="c1"># If WEBHOOK_EVENT_CALLBACK, pass it for processing</span>
                <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_EVENT_CALLBACK</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Process the item (do not save it, it&#39;ll get saved below)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
            <span class="n">signals</span><span class="o">.</span><span class="n">webhook_post_process</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">max_length</span> <span class="o">=</span> <span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s2">&quot;exception&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_length</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)[:</span><span class="n">max_length</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">format_exc</span><span class="p">()</span>

        <span class="c1"># Send the exception as the webhook_processing_error signal</span>
        <span class="n">signals</span><span class="o">.</span><span class="n">webhook_processing_error</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
            <span class="n">sender</span><span class="o">=</span><span class="n">WebhookEventTrigger</span><span class="p">,</span>
            <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
            <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;http_body&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># re-raise the exception so Django sees it</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.is_test_event" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">is_test_event</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">is_test_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">event_id</span> <span class="ow">and</span> <span class="n">event_id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_00000000000000&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.json_body" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">json_body</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cached_property</span>
<span class="k">def</span> <span class="nf">json_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.process" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Reset traceback and exception in case of reprocessing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exception</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_body</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.validate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_SECRET</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span><span class="p">,</span> <span class="n">validation_method</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_VALIDATION</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>The original contents of the Event message must be confirmed by
refetching it and comparing the fetched data with the original data.</p>
<p>This function makes an API call to Stripe to redownload the Event data
and returns whether or not it matches the WebhookEventTrigger data.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_SECRET</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span><span class="p">,</span>
    <span class="n">validation_method</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_VALIDATION</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The original contents of the Event message must be confirmed by</span>
<span class="sd">    refetching it and comparing the fetched data with the original data.</span>

<span class="sd">    This function makes an API call to Stripe to redownload the Event data</span>
<span class="sd">    and returns whether or not it matches the WebhookEventTrigger data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">local_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_body</span>
    <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_data</span> <span class="ow">or</span> <span class="s2">&quot;livemode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_data</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;&quot;id&quot; not in json body or &quot;livemode&quot; not in json body(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">local_data</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_test_event</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test webhook received and discarded: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">local_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">validation_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># validation disabled</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;WEBHOOK VALIDATION is disabled.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">validation_method</span> <span class="o">==</span> <span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_signature</span><span class="p">(</span><span class="n">secret</span><span class="o">=</span><span class="n">secret</span><span class="p">)</span>

    <span class="n">livemode</span> <span class="o">=</span> <span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;livemode&quot;</span><span class="p">]</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span> <span class="ow">or</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="p">)</span>

    <span class="c1"># Retrieve the event using the api_version specified in itself</span>
    <span class="k">with</span> <span class="n">stripe_temporary_api_version</span><span class="p">(</span><span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;api_version&quot;</span><span class="p">],</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">remote_data</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">stripe_class</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">local_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">remote_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.models.webhooks.WebhookEventTrigger.verify_signature" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">verify_signature</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify_signature</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">djstripe_settings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot verify event signature without a secret&quot;</span><span class="p">)</span>

    <span class="c1"># HTTP headers are case-insensitive, but we store them as a dict.</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">CaseInsensitiveMapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stripe-signature&quot;</span><span class="p">)</span>
    <span class="n">local_cli_signing_secret</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x-djstripe-webhook-secret&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># check if the x-djstripe-webhook-secret Custom Header exists</span>
        <span class="k">if</span> <span class="n">local_cli_signing_secret</span><span class="p">:</span>
            <span class="c1"># Set Endpoint Signing Secret to the output of Stripe CLI</span>
            <span class="c1"># for signature verification</span>
            <span class="n">secret</span> <span class="o">=</span> <span class="n">local_cli_signing_secret</span>

        <span class="n">stripe</span><span class="o">.</span><span class="n">WebhookSignature</span><span class="o">.</span><span class="n">verify_header</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">tolerance</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">SignatureVerificationError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to verify header&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="djstripe.models.webhooks-functions">Functions</h2>

<div class="doc doc-object doc-function">



<h3 id="djstripe.models.webhooks.get_remote_ip" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">webhooks</span><span class="o">.</span><span class="n">get_remote_ip</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Given the HTTPRequest object return the IP Address of the client</p>
<p>:param request: client request
:type request: HTTPRequest</p>
<p>:Returns: the client ip address</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/models/webhooks.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_remote_ip</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given the HTTPRequest object return the IP Address of the client</span>

<span class="sd">    :param request: client request</span>
<span class="sd">    :type request: HTTPRequest</span>

<span class="sd">    :Returns: the client ip address</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># HTTP_X_FORWARDED_FOR is relevant for django running behind a proxy</span>
    <span class="n">x_forwarded_for</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_forwarded_for</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">x_forwarded_for</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;REMOTE_ADDR&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ip</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Could not determine remote IP (missing REMOTE_ADDR). &quot;</span>
            <span class="s2">&quot;This is likely an issue with your wsgi/server setup.&quot;</span>
        <span class="p">)</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span>

    <span class="k">return</span> <span class="n">ip</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../managers/" class="btn btn-neutral float-left" title="Managers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../settings/" class="btn btn-neutral float-right" title="Settings">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/dj-stripe/dj-stripe/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../managers/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../settings/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
      <script src="../../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
